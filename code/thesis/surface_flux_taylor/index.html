
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../surface_energy_budget/">
      
      
        <link rel="next" href="../../utils/base/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Surface Flux Taylor - Isca</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#isca_tools.thesis.surface_flux_taylor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Isca" class="md-header__button md-logo" aria-label="Isca" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Isca
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Surface Flux Taylor
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jduffield65/Isca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jduffield65/Isca
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hpc_basics/kennedy/" class="md-tabs__link">
          
  
  
    
  
  HPC Basics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Isca/getting_started/" class="md-tabs__link">
          
  
  
    
  
  Isca

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../namelists/" class="md-tabs__link">
          
  
  
    
  
  Namelists

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CESM/" class="md-tabs__link">
          
  
  
    
  
  CESM

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../cesm/base/" class="md-tabs__link">
          
  
  
    
  
  Code

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Isca" class="md-nav__button md-logo" aria-label="Isca" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    Isca
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jduffield65/Isca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jduffield65/Isca
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    HPC Basics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    HPC Basics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/kennedy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kennedy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/shell_scripting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shell Scripting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Slurm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/pycharm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pycharm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Isca
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Isca
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/time_series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Series
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/socrates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOCRATES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Namelists
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Namelists
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/main/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Main
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Main
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/experiment_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Experiment Details
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/atmosphere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atmosphere
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/held_suarez/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Held Suarez
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/idealized_moist_physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Idealized Moist Physics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/spectral_dynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spectral Dynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/convection/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Convection
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Convection
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/qe_moist_convection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quasi Equilibrium Moist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/betts_miller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Betts-Miller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/ras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relaxed Arakawa Schubert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/dry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dry Convection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/condensation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Condensation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Condensation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/condensation/lscale_cond/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large Scale Condensation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/condensation/sat_vapor_pres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Saturation Vapor Pressure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Radiation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Radiation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/two_stream_gray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/rrtm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RRTM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/socrates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOCRATES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Surface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Surface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/mixed_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mixed Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/surface_flux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Flux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/topography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Topography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/damping/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Damping
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Damping
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Turbulence
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Turbulence
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/turbulence/vert_turb_driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vertical Turbulence Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/turbulence/diffusivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diffusivity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../CESM/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CESM
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CESM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/first_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    CESM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    CESM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cesm/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cesm/load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Convection
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Convection
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../convection/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../convection/simple_betts_miller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple Betts-Miller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    ERA5
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ERA5
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_1" >
        
          
          <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Get Jasmin ERA5
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get Jasmin ERA5
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../era5/get_jasmin_era5/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../era5/get_jasmin_era5/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    JASMIN
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    JASMIN
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jasmin/run/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Land
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../land/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../land/mountains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mountains
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Papers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Papers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../papers/byrne_2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Byrne 2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../papers/miyawaki_2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Miyawaki 2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Plot
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plot
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/spin_up/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spin Up
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Run
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Run
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/cmip_time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cmip Time
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/create_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create Files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_9" checked>
        
          
          <label class="md-nav__link" for="__nav_6_9" id="__nav_6_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Thesis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Thesis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adiabat_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adiabat Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adiabat_theory2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adiabat Theory 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aquaplanet_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aquaplanet Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extrop_land_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extratropics Land Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lapse_integral_simple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lapse Integration (Simple)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lapse_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lapse Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mod_parcel_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mod Parcel Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile_fitting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Profile Fitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../surface_energy_budget/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Energy Budget
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Surface Flux Taylor
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Flux Taylor
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor" class="md-nav__link">
    <span class="md-ellipsis">
      
        surface_flux_taylor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.first_non_none_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_non_none_key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_latent_heat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_latent_heat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_lwup_sfc_net" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lwup_sfc_net
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensible_heat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensible_heat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_lh" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_lh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_lw" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_lw
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_sh" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_sh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_temp_rad" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_rad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_flux" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_flux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_lh" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_lh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_lw" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_lw
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_sh" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_sh
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utils
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calculus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/circulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Circulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/ds_slicing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Slicing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debug
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/decomposition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decomposition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/fourier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fourier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/moist_physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Moist Physics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/numerical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Numerical
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/radiation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Radiation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Statistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/xarray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Xarray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor" class="md-nav__link">
    <span class="md-ellipsis">
      
        surface_flux_taylor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.first_non_none_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_non_none_key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_latent_heat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_latent_heat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_lwup_sfc_net" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lwup_sfc_net
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensible_heat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensible_heat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_lh" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_lh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_lw" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_lw
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_sensitivity_sh" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_sensitivity_sh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.get_temp_rad" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_rad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_flux" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_flux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_lh" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_lh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_lw" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_lw
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.surface_flux_taylor.reconstruct_sh" class="md-nav__link">
    <span class="md-ellipsis">
      
        reconstruct_sh
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Surface Flux Taylor</h1>

<div class="doc doc-object doc-module">



<a id="isca_tools.thesis.surface_flux_taylor"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.first_non_none_key" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">first_non_none_key</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return key of the first non-None value in <code>d</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to find first non-None key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>key</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First non-None key.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">first_non_none_key</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return key of the first non-None value in `d`.</span>

<span class="sd">    Args:</span>
<span class="sd">        d: Dictionary to find first non-None key.</span>

<span class="sd">    Returns:</span>
<span class="sd">        key: First non-None key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All dict values are None&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_latent_heat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_latent_heat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">rh_atm</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">,</span> <span class="n">evap_prefactor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the surface latent heat flux using a bulk aerodynamic formula.
This function uses the bulk exchange estimate:</p>
<div class="arithmatex">\[
LH = \beta\, L_v\, C_E\, \rho\, U\, \left(q_s^* - q_a\right).
\]</div>
<p>Here, the near-surface atmospheric state is diagnosed as: <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>
and the near-surface atmospheric specific humidity is computed from relative
humidity, <span class="arithmatex">\(r_a\)</span>: <span class="arithmatex">\(q_a = r_a q^*(T_a, p_a)\)</span>, while the surface saturation specific humidity is <span class="arithmatex">\(q_s^* = q^*(T_s, p_s)\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair temperature disequilibrium, <span class="arithmatex">\(T_{dq}\)</span> (K), used
in <span class="arithmatex">\(T_a = T_s - T_{diseqb}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface relative humidity, <span class="arithmatex">\(r_a\)</span> (unitless, 01)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bulk exchange coefficient, <span class="arithmatex">\(C_E\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface atmospheric pressure, <span class="arithmatex">\(p_a\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evap_prefactor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaporation prefactor, <span class="arithmatex">\(\beta\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>flux_lh</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latent heat flux, <span class="arithmatex">\(LH\)</span> (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_latent_heat</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">rh_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">w_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">evap_prefactor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the surface latent heat flux using a bulk aerodynamic formula.</span>
<span class="sd">    This function uses the bulk exchange estimate:</span>

<span class="sd">    $$</span>
<span class="sd">    LH = \\beta\\, L_v\\, C_E\\, \\rho\\, U\\, \\left(q_s^* - q_a\\right).</span>
<span class="sd">    $$</span>

<span class="sd">    Here, the near-surface atmospheric state is diagnosed as: $T_a = T_s - T_{dq}$</span>
<span class="sd">    and the near-surface atmospheric specific humidity is computed from relative</span>
<span class="sd">    humidity, $r_a$: $q_a = r_a q^*(T_a, p_a)$, while the surface saturation specific humidity is $q_s^* = q^*(T_s, p_s)$.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair temperature disequilibrium, $T_{dq}$ (K), used</span>
<span class="sd">            in $T_a = T_s - T_{diseqb}$</span>
<span class="sd">        rh_atm: Near-surface relative humidity, $r_a$ (unitless, 01)</span>
<span class="sd">        w_atm: Near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef: Bulk exchange coefficient, $C_E$ (unitless)</span>
<span class="sd">        p_surf: Surface pressure, $p_s$ (Pa)</span>
<span class="sd">        p_atm: Near-surface atmospheric pressure, $p_a$ (Pa)</span>
<span class="sd">        evap_prefactor: Evaporation prefactor, $\\beta$ (unitless)</span>

<span class="sd">    Returns:</span>
<span class="sd">        flux_lh: Latent heat flux, $LH$ (W m$^{-2}$)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_atm</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span>
    <span class="n">rho_atm</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">q_atm</span> <span class="o">=</span> <span class="n">rh_atm</span> <span class="o">*</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">q_surf</span> <span class="o">=</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">)</span>  <span class="c1"># sat specific humidity at surface</span>
    <span class="k">return</span> <span class="n">evap_prefactor</span> <span class="o">*</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">drag_coef</span> <span class="o">*</span> <span class="n">rho_atm</span> <span class="o">*</span> <span class="n">w_atm</span> <span class="o">*</span> <span class="p">(</span><span class="n">q_surf</span> <span class="o">-</span> <span class="n">q_atm</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_lwup_sfc_net" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lwup_sfc_net</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">temp_diseqb_r</span><span class="p">,</span> <span class="n">odp_surf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute net upward longwave flux at the surface in a gray-gas model.</p>
<p>This implements a simple gray-gas surface longwave budget with an imposed
surface optical depth. The net upward longwave at the surface is written as:</p>
<p><span class="arithmatex">\(LW^{\uparrow}_{net} = \sigma\left[T_s^4 - LW^{\downarrow}(\tau_s)/\sigma\right]\)</span>,</p>
<p>where the downwelling longwave is approximated as gray atmospheric emission
from an effective radiating temperature <span class="arithmatex">\(T_{rad}\)</span> with emissivity
<span class="arithmatex">\(\epsilon = 1 - e^{-\tau_{s}}\)</span>:</p>
<p><span class="arithmatex">\(LW^{\downarrow}(\tau_s) = \sigma\, \epsilon\, T_{rad}^4
= \sigma\left(1 - e^{-\tau_{s}}\right)T_{rad}^4\)</span>.</p>
<p>In this function, the effective radiating temperature is diagnosed from the
surface temperature using two disequilibrium offsets:
<span class="arithmatex">\(T_{rad} = T_s - T_{dq} - T_{dq,r}\)</span>.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>The implementation below returns
<span class="arithmatex">\(\sigma\left[T_s^4 + \left(1-e^{-\tau_{s}}\right)T_{rad}^4\right]\)</span>.
This corresponds to treating the atmospheric contribution as an <em>added</em>
upward term; if you intend <span class="arithmatex">\(LW^{\uparrow}_{net} = LW^{\uparrow}(\tau_s) - LW^{\downarrow}(\tau_s)\)</span>,
then the second term typically enters with a minus sign. Keep this sign
convention consistent with how you define net upward elsewhere.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair disequilibrium temperature, <span class="arithmatex">\(T_{dq}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_r</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional radiative disequilibrium offset, <span class="arithmatex">\(T_{dq,r}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>odp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Imposed gray optical depth seen from the surface, <span class="arithmatex">\(\tau_{s}\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lwup_surf_net</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Net upward longwave flux at the surface, <span class="arithmatex">\(LW^{\uparrow}_{net}\)</span>
(W m<span class="arithmatex">\(^{-2}\)</span>), with the same type/shape as the inputs (float, NumPy array,
or xarray DataArray), assuming consistent broadcasting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_lwup_sfc_net</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb_r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">odp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute net upward longwave flux at the surface in a gray-gas model.</span>

<span class="sd">    This implements a simple gray-gas surface longwave budget with an imposed</span>
<span class="sd">    surface optical depth. The net upward longwave at the surface is written as:</span>

<span class="sd">    $LW^{\\uparrow}_{net} = \\sigma\\left[T_s^4 - LW^{\\downarrow}(\\tau_s)/\\sigma\\right]$,</span>

<span class="sd">    where the downwelling longwave is approximated as gray atmospheric emission</span>
<span class="sd">    from an effective radiating temperature $T_{rad}$ with emissivity</span>
<span class="sd">    $\\epsilon = 1 - e^{-\\tau_{s}}$:</span>

<span class="sd">    $LW^{\\downarrow}(\\tau_s) = \\sigma\\, \\epsilon\\, T_{rad}^4</span>
<span class="sd">    = \\sigma\\left(1 - e^{-\\tau_{s}}\\right)T_{rad}^4$.</span>

<span class="sd">    In this function, the effective radiating temperature is diagnosed from the</span>
<span class="sd">    surface temperature using two disequilibrium offsets:</span>
<span class="sd">    $T_{rad} = T_s - T_{dq} - T_{dq,r}$.</span>

<span class="sd">    Note:</span>
<span class="sd">        The implementation below returns</span>
<span class="sd">        $\\sigma\\left[T_s^4 + \\left(1-e^{-\\tau_{s}}\\right)T_{rad}^4\\right]$.</span>
<span class="sd">        This corresponds to treating the atmospheric contribution as an *added*</span>
<span class="sd">        upward term; if you intend $LW^{\\uparrow}_{net} = LW^{\\uparrow}(\\tau_s) - LW^{\\downarrow}(\\tau_s)$,</span>
<span class="sd">        then the second term typically enters with a minus sign. Keep this sign</span>
<span class="sd">        convention consistent with how you define net upward elsewhere.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair disequilibrium temperature, $T_{dq}$ (K)</span>
<span class="sd">        temp_diseqb_r: Additional radiative disequilibrium offset, $T_{dq,r}$ (K)</span>
<span class="sd">        odp_surf: Imposed gray optical depth seen from the surface, $\\tau_{s}$ (unitless)</span>

<span class="sd">    Returns:</span>
<span class="sd">        lwup_surf_net: Net upward longwave flux at the surface, $LW^{\\uparrow}_{net}$</span>
<span class="sd">            (W m$^{-2}$), with the same type/shape as the inputs (float, NumPy array,</span>
<span class="sd">            or xarray DataArray), assuming consistent broadcasting.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Effective atmospheric radiating temperature used for gray downwelling LW</span>
    <span class="n">temp_rad</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span> <span class="o">-</span> <span class="n">temp_diseqb_r</span>
    <span class="c1"># Gray-gas emissivity for optical depth tau_sfc: epsilon = 1 - exp(-tau_sfc)</span>
    <span class="c1"># Downwelling LW at surface would be sigma * epsilon * T_rad^4</span>
    <span class="c1"># Surface upwelling LW is sigma * T_s^4</span>
    <span class="n">emiss_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">odp_surf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_surf</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">emiss_factor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_sensible_heat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sensible_heat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the surface sensible heat flux using a bulk aerodynamic formula.</p>
<p>Uses a bulk exchange estimate with near-surface atmospheric temperature
diagnosed as <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>. Air density is computed at
<span class="arithmatex">\((T_a, p_a)\)</span> and the near-surface atmospheric temperature is converted to a
potential temperature, <span class="arithmatex">\(\theta_a\)</span>.</p>
<p>The flux returned by this function is:
<span class="arithmatex">\(SH = c_p C_H \rho_a U (T_s - \theta_a)\)</span>,
where <span class="arithmatex">\(c_p\)</span> is the specific heat of air at constant pressure, <span class="arithmatex">\(C_H\)</span> is a bulk
transfer coefficient (here <code>drag_coef</code>), <span class="arithmatex">\(\rho_a\)</span> is near-surface air density,
and <span class="arithmatex">\(U\)</span> is near-surface wind speed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair temperature disequilibrium, <span class="arithmatex">\(T_{dq}\)</span> (K),
used in <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bulk transfer coefficient for sensible heat, <span class="arithmatex">\(C_H\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa), used as the reference pressure for
potential temperature</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface atmospheric pressure, <span class="arithmatex">\(p_a\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>flux_sh</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sensible heat flux, <span class="arithmatex">\(SH\)</span> (W m<span class="arithmatex">\(^{-2}\)</span>), with the same type/shape as the
inputs (float, NumPy array, or xarray DataArray), assuming consistent
broadcasting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sensible_heat</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">w_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the surface sensible heat flux using a bulk aerodynamic formula.</span>

<span class="sd">    Uses a bulk exchange estimate with near-surface atmospheric temperature</span>
<span class="sd">    diagnosed as $T_a = T_s - T_{dq}$. Air density is computed at</span>
<span class="sd">    $(T_a, p_a)$ and the near-surface atmospheric temperature is converted to a</span>
<span class="sd">    potential temperature, $\\theta_a$.</span>

<span class="sd">    The flux returned by this function is:</span>
<span class="sd">    $SH = c_p C_H \\rho_a U (T_s - \\theta_a)$,</span>
<span class="sd">    where $c_p$ is the specific heat of air at constant pressure, $C_H$ is a bulk</span>
<span class="sd">    transfer coefficient (here `drag_coef`), $\\rho_a$ is near-surface air density,</span>
<span class="sd">    and $U$ is near-surface wind speed.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair temperature disequilibrium, $T_{dq}$ (K),</span>
<span class="sd">            used in $T_a = T_s - T_{dq}$</span>
<span class="sd">        w_atm: Near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef: Bulk transfer coefficient for sensible heat, $C_H$ (unitless)</span>
<span class="sd">        p_surf: Surface pressure, $p_s$ (Pa), used as the reference pressure for</span>
<span class="sd">            potential temperature</span>
<span class="sd">        p_atm: Near-surface atmospheric pressure, $p_a$ (Pa)</span>

<span class="sd">    Returns:</span>
<span class="sd">        flux_sh: Sensible heat flux, $SH$ (W m$^{-2}$), with the same type/shape as the</span>
<span class="sd">            inputs (float, NumPy array, or xarray DataArray), assuming consistent</span>
<span class="sd">            broadcasting.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_atm</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span>
    <span class="n">rho_atm</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">temp_pot_atm</span> <span class="o">=</span> <span class="n">potential_temp</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c_p</span> <span class="o">*</span> <span class="n">drag_coef</span> <span class="o">*</span> <span class="n">rho_atm</span> <span class="o">*</span> <span class="n">w_atm</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_pot_atm</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_sensitivity_lh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sensitivity_lh</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">rh_atm</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">,</span> <span class="n">evap_prefactor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute sensitivities of latent heat flux to bulk-exchange parameters.</p>
<p>Uses the bulk aerodynamic latent heat flux <span class="arithmatex">\(LH = \beta L_v C_E \rho_a U (q_s^* - q_a)\)</span>,
with <span class="arithmatex">\(p_a = \sigma_a p_s\)</span> and <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>.</p>
<p>Returns a dictionary containing (i) first-order partial derivatives of <span class="arithmatex">\(LH\)</span>
with respect to each input parameter (holding the others fixed) and (ii)
selected second-order / mixed nonlinear terms used in a Taylor-series
decomposition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair temperature disequilibrium, <span class="arithmatex">\(T_{dq}\)</span> (K),
used in <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface relative humidity, <span class="arithmatex">\(RH\)</span> (unitless, 01)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bulk exchange coefficient, <span class="arithmatex">\(C_E\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma_atm</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sigma coordinate for the near-surface atmosphere, <span class="arithmatex">\(\sigma_a\)</span> (unitless),
used to set <span class="arithmatex">\(p_a = \sigma_a p_s\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evap_prefactor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaporation prefactor, <span class="arithmatex">\(\beta\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sensitivity_factors</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of sensitivities and nonlinear terms. Values have the same
type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</p>
<p>First-order terms (partials):</p>
<ul>
<li>evap_prefactor: <span class="arithmatex">\(\partial LH / \partial \beta\)</span></li>
<li>drag_coef: <span class="arithmatex">\(\partial LH / \partial C_E\)</span></li>
<li>w_atm: <span class="arithmatex">\(\partial LH / \partial U\)</span></li>
<li>p_surf: <span class="arithmatex">\(\partial LH / \partial p_s\)</span> (set to 0 here)</li>
<li>rh_atm: <span class="arithmatex">\(\partial LH / \partial r_a\)</span></li>
<li>temp_diseqb: <span class="arithmatex">\(\partial LH / \partial T_{dq}\)</span></li>
<li>temp_surf: <span class="arithmatex">\(\partial LH / \partial T_s\)</span></li>
</ul>
<p>Nonlinear / interaction terms:</p>
<ul>
<li>nl_temp_surf_square: quadratic term in <span class="arithmatex">\(T_s\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_temp_surf_<key>: mixed terms between <span class="arithmatex">\(T_s\)</span> and each of <span class="arithmatex">\(\alpha\)</span>, <span class="arithmatex">\(C_E\)</span>, <span class="arithmatex">\(U\)</span>, <span class="arithmatex">\(p_s\)</span></li>
<li>nl_temp_surf_rh_atm: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(RH\)</span></li>
<li>nl_temp_surf_temp_diseqb: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(T_{dq}\)</span></li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sensitivity_lh</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">rh_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">w_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">sigma_atm</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">evap_prefactor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute sensitivities of latent heat flux to bulk-exchange parameters.</span>

<span class="sd">    Uses the bulk aerodynamic latent heat flux $LH = \\beta L_v C_E \\rho_a U (q_s^* - q_a)$,</span>
<span class="sd">    with $p_a = \\sigma_a p_s$ and $T_a = T_s - T_{dq}$.</span>

<span class="sd">    Returns a dictionary containing (i) first-order partial derivatives of $LH$</span>
<span class="sd">    with respect to each input parameter (holding the others fixed) and (ii)</span>
<span class="sd">    selected second-order / mixed nonlinear terms used in a Taylor-series</span>
<span class="sd">    decomposition.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair temperature disequilibrium, $T_{dq}$ (K),</span>
<span class="sd">            used in $T_a = T_s - T_{dq}$</span>
<span class="sd">        rh_atm: Near-surface relative humidity, $RH$ (unitless, 01)</span>
<span class="sd">        w_atm: Near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef: Bulk exchange coefficient, $C_E$ (unitless)</span>
<span class="sd">        p_surf: Surface pressure, $p_s$ (Pa)</span>
<span class="sd">        sigma_atm: Sigma coordinate for the near-surface atmosphere, $\\sigma_a$ (unitless),</span>
<span class="sd">            used to set $p_a = \\sigma_a p_s$</span>
<span class="sd">        evap_prefactor: Evaporation prefactor, $\\beta$ (unitless)</span>

<span class="sd">    Returns:</span>
<span class="sd">        sensitivity_factors: Dictionary of sensitivities and nonlinear terms. Values have the same</span>
<span class="sd">            type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</span>

<span class="sd">            First-order terms (partials):</span>

<span class="sd">            - evap_prefactor: $\\partial LH / \\partial \\beta$</span>
<span class="sd">            - drag_coef: $\\partial LH / \\partial C_E$</span>
<span class="sd">            - w_atm: $\\partial LH / \\partial U$</span>
<span class="sd">            - p_surf: $\\partial LH / \\partial p_s$ (set to 0 here)</span>
<span class="sd">            - rh_atm: $\\partial LH / \\partial r_a$</span>
<span class="sd">            - temp_diseqb: $\\partial LH / \\partial T_{dq}$</span>
<span class="sd">            - temp_surf: $\\partial LH / \\partial T_s$</span>

<span class="sd">            Nonlinear / interaction terms:</span>

<span class="sd">            - nl_temp_surf_square: quadratic term in $T_s$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_temp_surf_&lt;key&gt;: mixed terms between $T_s$ and each of $\\alpha$, $C_E$, $U$, $p_s$</span>
<span class="sd">            - nl_temp_surf_rh_atm: mixed term between $T_s$ and $RH$</span>
<span class="sd">            - nl_temp_surf_temp_diseqb: mixed term between $T_s$ and $T_{dq}$</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_atm</span> <span class="o">=</span> <span class="n">p_surf</span> <span class="o">*</span> <span class="n">sigma_atm</span>
    <span class="n">temp_atm</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span>
    <span class="n">alpha_surf</span> <span class="o">=</span> <span class="n">clausius_clapeyron_factor</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">)</span>
    <span class="n">alpha_atm</span> <span class="o">=</span> <span class="n">clausius_clapeyron_factor</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">q_atm_sat</span> <span class="o">=</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">q_atm</span> <span class="o">=</span> <span class="n">rh_atm</span> <span class="o">*</span> <span class="n">q_atm_sat</span>
    <span class="n">rho_atm</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">lh</span> <span class="o">=</span> <span class="n">get_latent_heat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">rh_atm</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">,</span> <span class="n">evap_prefactor</span><span class="p">)</span>
    <span class="n">lh_prefactor</span> <span class="o">=</span> <span class="n">evap_prefactor</span> <span class="o">*</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">drag_coef</span> <span class="o">*</span> <span class="n">w_atm</span> <span class="o">*</span> <span class="n">rho_atm</span>

    <span class="c1"># Differential of lh wrt each param - same order as input args</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">alpha_surf</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">temp_atm</span><span class="p">)</span> <span class="o">*</span> <span class="n">lh</span> <span class="o">+</span> <span class="n">lh_prefactor</span> <span class="o">*</span> <span class="n">q_atm</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_surf</span> <span class="o">-</span> <span class="n">alpha_atm</span><span class="p">),</span>
                <span class="s1">&#39;temp_diseqb&#39;</span><span class="p">:</span> <span class="n">lh</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">+</span> <span class="n">lh_prefactor</span> <span class="o">*</span> <span class="n">q_atm</span> <span class="o">*</span> <span class="n">alpha_atm</span><span class="p">,</span>
                <span class="s1">&#39;rh_atm&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">lh_prefactor</span> <span class="o">*</span> <span class="n">q_atm_sat</span><span class="p">,</span>
                <span class="s1">&#39;w_atm&#39;</span><span class="p">:</span> <span class="n">lh</span> <span class="o">/</span> <span class="n">w_atm</span><span class="p">,</span>
                <span class="s1">&#39;drag_coef&#39;</span><span class="p">:</span> <span class="n">lh</span> <span class="o">/</span> <span class="n">drag_coef</span><span class="p">,</span>
                <span class="s1">&#39;p_surf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;evap_prefactor&#39;</span><span class="p">:</span> <span class="n">lh</span> <span class="o">/</span> <span class="n">evap_prefactor</span>
                <span class="p">}</span>

    <span class="c1"># Nonlinear contributions - only temp_surf as this dominates</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> \
        <span class="p">(</span><span class="n">alpha_surf</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">temp_atm</span><span class="p">)</span> <span class="o">*</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">]</span> <span class="o">+</span> \
        <span class="n">lh</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">alpha_surf</span> <span class="o">/</span> <span class="n">temp_surf</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">lh_prefactor</span> <span class="o">*</span> <span class="n">q_atm</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha_atm</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">-</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="n">alpha_surf</span> <span class="o">/</span> <span class="n">temp_surf</span> <span class="o">+</span> <span class="n">alpha_atm</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_surf</span> <span class="o">-</span> <span class="n">alpha_atm</span><span class="p">))</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># to match the taylor series coef</span>

    <span class="c1"># Mechanism combinations</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">lh</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">+</span> \
                                                    <span class="n">lh_prefactor</span> <span class="o">*</span> <span class="n">q_atm</span> <span class="o">*</span> <span class="n">alpha_atm</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_atm</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">temp_atm</span><span class="p">)</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;rh_atm&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lh_prefactor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">temp_atm</span> <span class="o">-</span> <span class="n">alpha_atm</span><span class="p">)</span> <span class="o">*</span> <span class="n">q_atm_sat</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;w_atm&#39;</span><span class="p">,</span> <span class="s1">&#39;drag_coef&#39;</span><span class="p">,</span> <span class="s1">&#39;p_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;evap_prefactor&#39;</span><span class="p">]:</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">lh</span>
    <span class="k">return</span> <span class="n">out_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_sensitivity_lw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sensitivity_lw</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">temp_diseqb_r</span><span class="p">,</span> <span class="n">odp_surf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute sensitivities of net upward surface longwave to gray-gas parameters.</p>
<p>This function returns first-order partial derivatives and selected second-order
/ mixed nonlinear terms for a gray-gas surface longwave flux with imposed
surface optical depth.</p>
<p>The effective radiating temperature is diagnosed as <span class="arithmatex">\(T_{rad} = T_s - T_{dq} - T_{dq,r}\)</span>,
and the gray emissivity factor is <span class="arithmatex">\(\epsilon = 1 - e^{-\tau_s}\)</span>, where
<span class="arithmatex">\(\tau_s\)</span> is the imposed optical depth (<code>odp_surf</code>).</p>
<p>The sensitivity factors returned here are intended for use in a Taylor-series
reconstruction in the same style as <code>get_sensitivity_sh</code> (via <code>name_square</code>
and <code>name_nl</code> keys).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair disequilibrium temperature, <span class="arithmatex">\(T_{dq}\)</span> (K), used in
<span class="arithmatex">\(T_{rad} = T_s - T_{dq} - T_{dq,r}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_r</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional radiative disequilibrium offset, <span class="arithmatex">\(T_{dq,r}\)</span> (K),
used in <span class="arithmatex">\(T_{rad} = T_s - T_{dq} - T_{dq,r}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>odp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Imposed gray optical depth at the surface, <span class="arithmatex">\(\tau_s\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sensitivity_factors</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of sensitivities and nonlinear terms. Values have the same
type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</p>
<p>First-order terms (partials):</p>
<ul>
<li>temp_surf: <span class="arithmatex">\(\partial LW_{net,sfc}^{\uparrow} / \partial T_s\)</span></li>
<li>temp_diseqb: <span class="arithmatex">\(\partial LW_{net,sfc}^{\uparrow} / \partial T_{dq}\)</span></li>
<li>temp_diseqb_r: <span class="arithmatex">\(\partial LW_{net,sfc}^{\uparrow} / \partial T_{dq,r}\)</span></li>
<li>odp_surf: <span class="arithmatex">\(\partial LW_{net,sfc}^{\uparrow} / \partial \tau_s\)</span></li>
</ul>
<p>Nonlinear / interaction terms (as included in <code>out_dict</code>):</p>
<ul>
<li>nl_temp_surf_square: quadratic term in <span class="arithmatex">\(T_s\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_temp_diseqb_square: quadratic term in <span class="arithmatex">\(T_{dq}\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_temp_diseqb_r_square: quadratic term in <span class="arithmatex">\(T_{dq,r}\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_odp_surf_square: quadratic term in <span class="arithmatex">\(\tau_s\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_temp_surf_temp_diseqb: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(T_{dq}\)</span></li>
<li>nl_temp_surf_temp_diseqb_r: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(T_{dq,r}\)</span></li>
<li>nl_temp_surf_odp_surf: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(\tau_s\)</span></li>
<li>nl_temp_diseqb_temp_diseqb_r: mixed term between <span class="arithmatex">\(T_{dq}\)</span> and <span class="arithmatex">\(T_{dq,r}\)</span></li>
<li>nl_temp_diseqb_odp_surf: mixed term between <span class="arithmatex">\(T_{dq}\)</span> and <span class="arithmatex">\(\tau_s\)</span></li>
<li>nl_temp_diseqb_r_odp_surf: mixed term between <span class="arithmatex">\(T_{dq,r}\)</span> and <span class="arithmatex">\(\tau_s\)</span></li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This function assumes the same sign convention as the corresponding flux
function used in your reconstruction (e.g. <code>get_lwup_sfc_net</code>). Ensure the
definition of net upward longwave used there matches how you interpret
the derivatives here.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sensitivity_lw</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb_r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">odp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute sensitivities of net upward surface longwave to gray-gas parameters.</span>

<span class="sd">    This function returns first-order partial derivatives and selected second-order</span>
<span class="sd">    / mixed nonlinear terms for a gray-gas surface longwave flux with imposed</span>
<span class="sd">    surface optical depth.</span>

<span class="sd">    The effective radiating temperature is diagnosed as $T_{rad} = T_s - T_{dq} - T_{dq,r}$,</span>
<span class="sd">    and the gray emissivity factor is $\\epsilon = 1 - e^{-\\tau_s}$, where</span>
<span class="sd">    $\\tau_s$ is the imposed optical depth (`odp_surf`).</span>

<span class="sd">    The sensitivity factors returned here are intended for use in a Taylor-series</span>
<span class="sd">    reconstruction in the same style as `get_sensitivity_sh` (via `name_square`</span>
<span class="sd">    and `name_nl` keys).</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair disequilibrium temperature, $T_{dq}$ (K), used in</span>
<span class="sd">            $T_{rad} = T_s - T_{dq} - T_{dq,r}$</span>
<span class="sd">        temp_diseqb_r: Additional radiative disequilibrium offset, $T_{dq,r}$ (K),</span>
<span class="sd">            used in $T_{rad} = T_s - T_{dq} - T_{dq,r}$</span>
<span class="sd">        odp_surf: Imposed gray optical depth at the surface, $\\tau_s$ (unitless)</span>

<span class="sd">    Returns:</span>
<span class="sd">        sensitivity_factors: Dictionary of sensitivities and nonlinear terms. Values have the same</span>
<span class="sd">            type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</span>

<span class="sd">            First-order terms (partials):</span>

<span class="sd">            - temp_surf: $\\partial LW_{net,sfc}^{\\uparrow} / \\partial T_s$</span>
<span class="sd">            - temp_diseqb: $\\partial LW_{net,sfc}^{\\uparrow} / \\partial T_{dq}$</span>
<span class="sd">            - temp_diseqb_r: $\\partial LW_{net,sfc}^{\\uparrow} / \\partial T_{dq,r}$</span>
<span class="sd">            - odp_surf: $\\partial LW_{net,sfc}^{\\uparrow} / \\partial \\tau_s$</span>

<span class="sd">            Nonlinear / interaction terms (as included in `out_dict`):</span>

<span class="sd">            - nl_temp_surf_square: quadratic term in $T_s$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_temp_diseqb_square: quadratic term in $T_{dq}$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_temp_diseqb_r_square: quadratic term in $T_{dq,r}$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_odp_surf_square: quadratic term in $\\tau_s$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_temp_surf_temp_diseqb: mixed term between $T_s$ and $T_{dq}$</span>
<span class="sd">            - nl_temp_surf_temp_diseqb_r: mixed term between $T_s$ and $T_{dq,r}$</span>
<span class="sd">            - nl_temp_surf_odp_surf: mixed term between $T_s$ and $\\tau_s$</span>
<span class="sd">            - nl_temp_diseqb_temp_diseqb_r: mixed term between $T_{dq}$ and $T_{dq,r}$</span>
<span class="sd">            - nl_temp_diseqb_odp_surf: mixed term between $T_{dq}$ and $\\tau_s$</span>
<span class="sd">            - nl_temp_diseqb_r_odp_surf: mixed term between $T_{dq,r}$ and $\\tau_s$</span>

<span class="sd">    Notes:</span>
<span class="sd">        This function assumes the same sign convention as the corresponding flux</span>
<span class="sd">        function used in your reconstruction (e.g. `get_lwup_sfc_net`). Ensure the</span>
<span class="sd">        definition of net upward longwave used there matches how you interpret</span>
<span class="sd">        the derivatives here.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_rad</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span> <span class="o">-</span> <span class="n">temp_diseqb_r</span>
    <span class="n">emiss_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">odp_surf</span><span class="p">)</span>

    <span class="c1"># Differential of sh wrt each param - same order as input args</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_surf</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">emiss_factor</span><span class="p">),</span>
                <span class="s1">&#39;temp_diseqb&#39;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">emiss_factor</span><span class="p">,</span>
                <span class="s1">&#39;temp_diseqb_r&#39;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">emiss_factor</span><span class="p">,</span>
                <span class="s1">&#39;odp_surf&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">odp_surf</span><span class="p">),</span>
                <span class="p">}</span>

    <span class="c1"># Nonlinear contributions</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_surf</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">emiss_factor</span><span class="p">)</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># to match the taylor series coef</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb_r&#39;</span><span class="p">]:</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">12</span> <span class="o">*</span> <span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">emiss_factor</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># to match the taylor series coef</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;odp_surf&#39;</span><span class="p">]</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">0.5</span>     <span class="c1"># to match the taylor series coef</span>

    <span class="c1"># Combination of mechanisms - all possible permutations</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb_r&#39;</span><span class="p">]:</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">emiss_factor</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">Stefan_Boltzmann</span> <span class="o">*</span> <span class="n">temp_rad</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">odp_surf</span><span class="p">)</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb_r&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb_r&#39;</span><span class="p">]:</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;odp_surf&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">out_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_sensitivity_sh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sensitivity_sh</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute sensitivities of sensible heat flux to bulk-exchange parameters.</p>
<p>Uses the bulk aerodynamic sensible heat flux <span class="arithmatex">\(SH = c_p C_H \rho_a U (T_s - \theta_a)\)</span>,
with <span class="arithmatex">\(p_a = \sigma_a p_s\)</span> and <span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>, where <span class="arithmatex">\(\theta_a\)</span> is the
near-surface atmospheric potential temperature referenced to <span class="arithmatex">\(p_s\)</span> (as in
<code>potential_temp(temp_atm, p_atm, p_surf)</code> within <code>get_sensible_heat</code>).</p>
<p>Returns a dictionary containing (i) first-order partial derivatives of <span class="arithmatex">\(SH\)</span>
with respect to each input parameter (holding the others fixed) and (ii)
selected second-order / mixed nonlinear terms used in a Taylor-series
decomposition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surfaceair temperature disequilibrium, <span class="arithmatex">\(T_{dq}\)</span> (K), used in
<span class="arithmatex">\(T_a = T_s - T_{dq}\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bulk transfer coefficient for sensible heat, <span class="arithmatex">\(C_H\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma_atm</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sigma coordinate for the near-surface atmosphere, <span class="arithmatex">\(\sigma_a\)</span> (unitless),
used to set <span class="arithmatex">\(p_a = \sigma_a p_s\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sensitivity_factors</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of sensitivities and nonlinear terms. Values have the same
type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</p>
<p>First-order terms (partials):</p>
<ul>
<li>temp_surf: <span class="arithmatex">\(\partial SH / \partial T_s\)</span></li>
<li>temp_diseqb: <span class="arithmatex">\(\partial SH / \partial T_{dq}\)</span></li>
<li>w_atm: <span class="arithmatex">\(\partial SH / \partial U\)</span></li>
<li>drag_coef: <span class="arithmatex">\(\partial SH / \partial C_H\)</span></li>
<li>p_surf: <span class="arithmatex">\(\partial SH / \partial p_s\)</span></li>
</ul>
<p>Nonlinear / interaction terms:</p>
<ul>
<li>nl_temp_diseqb_square: quadratic term in <span class="arithmatex">\(T_{dq}\)</span> (includes the <span class="arithmatex">\(1/2\)</span> factor)</li>
<li>nl_temp_surf_temp_diseqb: mixed term between <span class="arithmatex">\(T_s\)</span> and <span class="arithmatex">\(T_{dq}\)</span></li>
<li>nl_temp_diseqb_<key>: mixed terms between <span class="arithmatex">\(T_{dq}\)</span> and each of <span class="arithmatex">\(U\)</span>, <span class="arithmatex">\(C_H\)</span>, <span class="arithmatex">\(p_s\)</span></li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sensitivity_sh</span><span class="p">(</span>
        <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">w_atm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">p_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">sigma_atm</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute sensitivities of sensible heat flux to bulk-exchange parameters.</span>

<span class="sd">    Uses the bulk aerodynamic sensible heat flux $SH = c_p C_H \\rho_a U (T_s - \\theta_a)$,</span>
<span class="sd">    with $p_a = \\sigma_a p_s$ and $T_a = T_s - T_{dq}$, where $\\theta_a$ is the</span>
<span class="sd">    near-surface atmospheric potential temperature referenced to $p_s$ (as in</span>
<span class="sd">    `potential_temp(temp_atm, p_atm, p_surf)` within `get_sensible_heat`).</span>

<span class="sd">    Returns a dictionary containing (i) first-order partial derivatives of $SH$</span>
<span class="sd">    with respect to each input parameter (holding the others fixed) and (ii)</span>
<span class="sd">    selected second-order / mixed nonlinear terms used in a Taylor-series</span>
<span class="sd">    decomposition.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: Surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb: Surfaceair temperature disequilibrium, $T_{dq}$ (K), used in</span>
<span class="sd">            $T_a = T_s - T_{dq}$</span>
<span class="sd">        w_atm: Near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef: Bulk transfer coefficient for sensible heat, $C_H$ (unitless)</span>
<span class="sd">        p_surf: Surface pressure, $p_s$ (Pa)</span>
<span class="sd">        sigma_atm: Sigma coordinate for the near-surface atmosphere, $\\sigma_a$ (unitless),</span>
<span class="sd">            used to set $p_a = \\sigma_a p_s$</span>

<span class="sd">    Returns:</span>
<span class="sd">        sensitivity_factors: Dictionary of sensitivities and nonlinear terms. Values have the same</span>
<span class="sd">            type/shape as the broadcasted inputs (float, NumPy array, or xarray DataArray).</span>

<span class="sd">            First-order terms (partials):</span>

<span class="sd">            - temp_surf: $\\partial SH / \\partial T_s$</span>
<span class="sd">            - temp_diseqb: $\\partial SH / \\partial T_{dq}$</span>
<span class="sd">            - w_atm: $\\partial SH / \\partial U$</span>
<span class="sd">            - drag_coef: $\\partial SH / \\partial C_H$</span>
<span class="sd">            - p_surf: $\\partial SH / \\partial p_s$</span>

<span class="sd">            Nonlinear / interaction terms:</span>

<span class="sd">            - nl_temp_diseqb_square: quadratic term in $T_{dq}$ (includes the $1/2$ factor)</span>
<span class="sd">            - nl_temp_surf_temp_diseqb: mixed term between $T_s$ and $T_{dq}$</span>
<span class="sd">            - nl_temp_diseqb_&lt;key&gt;: mixed terms between $T_{dq}$ and each of $U$, $C_H$, $p_s$</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_atm</span> <span class="o">=</span> <span class="n">p_surf</span> <span class="o">*</span> <span class="n">sigma_atm</span>
    <span class="n">temp_atm</span> <span class="o">=</span> <span class="n">temp_surf</span> <span class="o">-</span> <span class="n">temp_diseqb</span>
    <span class="n">rho_atm</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">temp_atm</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">get_sensible_heat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">,</span> <span class="n">drag_coef</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">,</span> <span class="n">p_atm</span><span class="p">)</span>
    <span class="n">sh_prefactor</span> <span class="o">=</span> <span class="n">c_p</span> <span class="o">*</span> <span class="n">drag_coef</span> <span class="o">*</span> <span class="n">w_atm</span> <span class="o">*</span> <span class="n">rho_atm</span>

    <span class="c1"># Differential of sh wrt each param - same order as input args</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">:</span> <span class="n">sh_prefactor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">temp_surf</span> <span class="o">/</span> <span class="n">temp_atm</span><span class="p">),</span>
                <span class="s1">&#39;temp_diseqb&#39;</span><span class="p">:</span> <span class="n">sh_prefactor</span> <span class="o">*</span> <span class="n">temp_surf</span> <span class="o">/</span> <span class="n">temp_atm</span><span class="p">,</span>
                <span class="s1">&#39;w_atm&#39;</span><span class="p">:</span> <span class="n">sh</span> <span class="o">/</span> <span class="n">w_atm</span><span class="p">,</span>
                <span class="s1">&#39;drag_coef&#39;</span><span class="p">:</span> <span class="n">sh</span> <span class="o">/</span> <span class="n">drag_coef</span><span class="p">,</span>
                <span class="s1">&#39;p_surf&#39;</span><span class="p">:</span> <span class="n">sh</span> <span class="o">/</span> <span class="n">p_surf</span><span class="p">,</span>
                <span class="p">}</span>
    <span class="c1"># Nonlinear contributions - only temp_diseqb as this dominates</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">temp_atm</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">0.5</span>  <span class="c1"># to match the taylor series coef</span>

    <span class="c1"># Combination of mechanisms</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_surf&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diseqb&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sh_prefactor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">temp_surf</span> <span class="o">/</span> <span class="n">temp_atm</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;w_atm&#39;</span><span class="p">,</span> <span class="s1">&#39;drag_coef&#39;</span><span class="p">,</span> <span class="s1">&#39;p_surf&#39;</span><span class="p">]:</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;temp_diseqb&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sh</span>

    <span class="k">return</span> <span class="n">out_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.get_temp_rad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_rad</span><span class="p">(</span><span class="n">lwdn_surf</span><span class="p">,</span> <span class="n">odp_surf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the (effective) radiative temperature T_r associated with the
<em>downward</em> longwave flux at the surface in a
<a href="https://execlim.github.io/Isca/modules/two_stream_gray_rad.html">gray two-stream framework</a>.</p>
<p>This function inverts the isothermal-atmosphere form of the two-stream
solution for the downward flux at the surface:</p>
<div class="arithmatex">\[I_-(_s) =  T_r^4 (1 - e^{-_s})\]</div>
<p>where:</p>
<ul>
<li><span class="arithmatex">\(I_-(_s)\)</span> is the downward longwave flux at the surface (W m^-2),</li>
<li><span class="arithmatex">\(_s\)</span> is the longwave optical depth from TOA to the surface,</li>
<li><span class="arithmatex">\(\)</span> is the StefanBoltzmann constant,</li>
<li><span class="arithmatex">\(T_r\)</span> is the effective radiative temperature (K) that, if the atmosphere
  were isothermal at T_r, would yield the same surface downward flux.</li>
</ul>
<p>More generally, if temperature varies with optical depth , the exact
two-stream solution can be written as:</p>
<div class="arithmatex">\[I_-(_s) =  e^{-_s} _0^{_s} e^{'} T(')^4 d'\]</div>
<p>and defining <span class="arithmatex">\(T_r\)</span> by <span class="arithmatex">\(I_-(_s) =  T_r^4 (1 - e^{-_s})\)</span> gives the integral
expression:</p>
<div class="arithmatex">\[(e^{\tau_s} - 1)T_r^4 = _0^{_s} e^{'} T(')^4 d'\]</div>
<p>Notes:</p>
<pre><code>- This implementation uses only $I_-(_s)$ and $_s$, so it returns the
  effective $T_r$ implied by the flux, not the profile-weighted integral
  unless you separately compute that integral from T().
- For small $_s$, $(1 - e^{-_s})  _s$, so take care with $_s$  0 to avoid
  numerical issues.
</code></pre>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lwdn_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downward longwave radiation at the surface, <span class="arithmatex">\(I_-(_s)\)</span> (W m^-2).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>odp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longwave optical depth at the surface, <span class="arithmatex">\(_s\)</span> (dimensionless).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>temp_rad</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>, <span title="xarray.DataArray">DataArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radiative temperature <span class="arithmatex">\(T_r\)</span> (K), computed from:
<code>temp_rad**4 = lwdn_sfc / [ (1 - e^{-opd_sfc})]</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_rad</span><span class="p">(</span><span class="n">lwdn_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
                 <span class="n">odp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the (effective) radiative temperature T_r associated with the</span>
<span class="sd">    *downward* longwave flux at the surface in a</span>
<span class="sd">    [gray two-stream framework](https://execlim.github.io/Isca/modules/two_stream_gray_rad.html).</span>

<span class="sd">    This function inverts the isothermal-atmosphere form of the two-stream</span>
<span class="sd">    solution for the downward flux at the surface:</span>

<span class="sd">    $$I_-(_s) =  T_r^4 (1 - e^{-_s})$$</span>

<span class="sd">    where:</span>

<span class="sd">    - $I_-(_s)$ is the downward longwave flux at the surface (W m^-2),</span>
<span class="sd">    - $_s$ is the longwave optical depth from TOA to the surface,</span>
<span class="sd">    - $$ is the StefanBoltzmann constant,</span>
<span class="sd">    - $T_r$ is the effective radiative temperature (K) that, if the atmosphere</span>
<span class="sd">      were isothermal at T_r, would yield the same surface downward flux.</span>

<span class="sd">    More generally, if temperature varies with optical depth , the exact</span>
<span class="sd">    two-stream solution can be written as:</span>

<span class="sd">    $$I_-(_s) =  e^{-_s} _0^{_s} e^{&#39;} T(&#39;)^4 d&#39;$$</span>

<span class="sd">    and defining $T_r$ by $I_-(_s) =  T_r^4 (1 - e^{-_s})$ gives the integral</span>
<span class="sd">    expression:</span>

<span class="sd">    $$(e^{\\tau_s} - 1)T_r^4 = _0^{_s} e^{&#39;} T(&#39;)^4 d&#39;$$</span>

<span class="sd">    Notes:</span>

<span class="sd">        - This implementation uses only $I_-(_s)$ and $_s$, so it returns the</span>
<span class="sd">          effective $T_r$ implied by the flux, not the profile-weighted integral</span>
<span class="sd">          unless you separately compute that integral from T().</span>
<span class="sd">        - For small $_s$, $(1 - e^{-_s})  _s$, so take care with $_s$  0 to avoid</span>
<span class="sd">          numerical issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        lwdn_surf:</span>
<span class="sd">            Downward longwave radiation at the surface, $I_-(_s)$ (W m^-2).</span>
<span class="sd">        odp_surf:</span>
<span class="sd">            Longwave optical depth at the surface, $_s$ (dimensionless).</span>

<span class="sd">    Returns:</span>
<span class="sd">        temp_rad: Radiative temperature $T_r$ (K), computed from:</span>
<span class="sd">            `temp_rad**4 = lwdn_sfc / [ (1 - e^{-opd_sfc})]`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Returns radiative temperature, T_r, such that LW_down = sigma T_r^4 (1 - e^{-opd})</span>
    <span class="n">emission_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">odp_surf</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">lwdn_surf</span> <span class="o">/</span> <span class="n">emission_factor</span> <span class="o">/</span> <span class="n">Stefan_Boltzmann</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.reconstruct_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_flux</span><span class="p">(</span><span class="n">var_dict</span><span class="p">,</span> <span class="n">func_flux</span><span class="p">,</span> <span class="n">func_sensitivity</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numerical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reconstruct bulk flux anomalies from a reference state (generic helper).</p>
<p>This is the general implementation used by <code>reconstruct_lh</code> (and can be reused
for other bulk fluxes such as sensible heat). It takes a dictionary containing
reference scalars (with names ending in <code>"_ref"</code>) plus optional mechanism
arrays (without <code>"_ref"</code>), then reconstructs the flux anomaly relative to the
reference either:</p>
<ul>
<li>Numerically: by re-evaluating <code>func_flux</code> after substituting one mechanism
  at a time (linear terms) and two mechanisms at a time (pairwise nonlinear
  interaction terms)</li>
<li>Analytically: by using sensitivity factors from <code>func_sensitivity</code> to build
  a Taylor-series reconstruction (including any square and cross terms present
  in the returned sensitivity dictionary)</li>
</ul>
<p>The near-surface atmospheric pressure is diagnosed with a sigma level:
<span class="arithmatex">\(p_a = \sigma_a p_s\)</span>.</p>
<p>Input conventions:</p>
<ul>
<li>Reference values must appear in <code>var_dict</code> with the suffix <code>"_ref"</code>, e.g.
  <code>"temp_surf_ref"</code>, <code>"p_surf_ref"</code></li>
<li>Mechanism perturbations must appear in <code>var_dict</code> without the suffix, e.g.
  <code>"temp_surf"</code>, <code>"p_surf"</code>, and can be <code>None</code> or a NumPy array</li>
<li>Any mechanism value that is <code>None</code> is filled with its reference value,
  broadcast to the size of the first provided mechanism array. All provided
  mechanism arrays must have the same <code>.size</code></li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of variables, typically <code>locals()</code> from a wrapper
such as <code>reconstruct_lh</code>. Must include <code>"&lt;name&gt;_ref"</code> entries for each
mechanism. May include optional mechanism arrays under <code>"&lt;name&gt;"</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func_flux</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable that computes the flux. Must accept the reference
mechanisms as keyword arguments, and must accept <code>p_atm</code> as a keyword
argument. Example: <code>get_latent_heat</code> or <code>get_sensible_heat</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func_sensitivity</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable returning sensitivity factors used for the
analytical reconstruction. Must accept the reference mechanisms as
keyword arguments and <code>sigma_atm</code> as a keyword argument. Example:
<code>get_sensitivity_lh</code> or <code>get_sensitivity_sh</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma_atm</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sigma coordinate for the near-surface atmosphere, <span class="arithmatex">\(\sigma_a\)</span>
(unitless), used to set <span class="arithmatex">\(p_a = \sigma_a p_s\)</span>. Not required for LW</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute contributions by explicit re-evaluation of
<code>func_flux</code>. If False, compute contributions using <code>func_sensitivity</code>
(Taylor-series reconstruction).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>flux_ref</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference flux evaluated at the reference state (units depend on
<code>func_flux</code>, e.g. W m<span class="arithmatex">\(^{-2}\)</span>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>flux_anom_linear</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear contributions to the flux anomaly (same
units as <code>flux_ref</code>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>flux_anom_nl</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear plus nonlinear contributions included in the
reconstruction (same units as <code>flux_ref</code>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of individual contributions by mechanism and
interaction term. Always includes <code>residual</code>, defined as the
difference between the full flux anomaly computed from <code>vals</code> and the
reconstructed anomaly.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no mechanism arrays are provided (so a broadcast size
cannot be inferred), if provided mechanism arrays have inconsistent
<code>.size</code>, or if the expected key sets do not match in the analytical
pathway (<code>gamma</code> vs <code>info_cont</code>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_flux</span><span class="p">(</span><span class="n">var_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">func_flux</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">func_sensitivity</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                     <span class="n">sigma_atm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">numerical</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct bulk flux anomalies from a reference state (generic helper).</span>

<span class="sd">    This is the general implementation used by `reconstruct_lh` (and can be reused</span>
<span class="sd">    for other bulk fluxes such as sensible heat). It takes a dictionary containing</span>
<span class="sd">    reference scalars (with names ending in `&quot;_ref&quot;`) plus optional mechanism</span>
<span class="sd">    arrays (without `&quot;_ref&quot;`), then reconstructs the flux anomaly relative to the</span>
<span class="sd">    reference either:</span>

<span class="sd">    - Numerically: by re-evaluating `func_flux` after substituting one mechanism</span>
<span class="sd">      at a time (linear terms) and two mechanisms at a time (pairwise nonlinear</span>
<span class="sd">      interaction terms)</span>
<span class="sd">    - Analytically: by using sensitivity factors from `func_sensitivity` to build</span>
<span class="sd">      a Taylor-series reconstruction (including any square and cross terms present</span>
<span class="sd">      in the returned sensitivity dictionary)</span>

<span class="sd">    The near-surface atmospheric pressure is diagnosed with a sigma level:</span>
<span class="sd">    $p_a = \\sigma_a p_s$.</span>

<span class="sd">    Input conventions:</span>

<span class="sd">    - Reference values must appear in `var_dict` with the suffix `&quot;_ref&quot;`, e.g.</span>
<span class="sd">      `&quot;temp_surf_ref&quot;`, `&quot;p_surf_ref&quot;`</span>
<span class="sd">    - Mechanism perturbations must appear in `var_dict` without the suffix, e.g.</span>
<span class="sd">      `&quot;temp_surf&quot;`, `&quot;p_surf&quot;`, and can be `None` or a NumPy array</span>
<span class="sd">    - Any mechanism value that is `None` is filled with its reference value,</span>
<span class="sd">      broadcast to the size of the first provided mechanism array. All provided</span>
<span class="sd">      mechanism arrays must have the same `.size`</span>

<span class="sd">    Args:</span>
<span class="sd">        var_dict: Dictionary of variables, typically `locals()` from a wrapper</span>
<span class="sd">            such as `reconstruct_lh`. Must include `&quot;&lt;name&gt;_ref&quot;` entries for each</span>
<span class="sd">            mechanism. May include optional mechanism arrays under `&quot;&lt;name&gt;&quot;`.</span>
<span class="sd">        func_flux: Callable that computes the flux. Must accept the reference</span>
<span class="sd">            mechanisms as keyword arguments, and must accept `p_atm` as a keyword</span>
<span class="sd">            argument. Example: `get_latent_heat` or `get_sensible_heat`.</span>
<span class="sd">        func_sensitivity: Callable returning sensitivity factors used for the</span>
<span class="sd">            analytical reconstruction. Must accept the reference mechanisms as</span>
<span class="sd">            keyword arguments and `sigma_atm` as a keyword argument. Example:</span>
<span class="sd">            `get_sensitivity_lh` or `get_sensitivity_sh`.</span>
<span class="sd">        sigma_atm: Sigma coordinate for the near-surface atmosphere, $\\sigma_a$</span>
<span class="sd">            (unitless), used to set $p_a = \\sigma_a p_s$. Not required for LW</span>
<span class="sd">        numerical: If True, compute contributions by explicit re-evaluation of</span>
<span class="sd">            `func_flux`. If False, compute contributions using `func_sensitivity`</span>
<span class="sd">            (Taylor-series reconstruction).</span>

<span class="sd">    Returns:</span>
<span class="sd">        flux_ref: Reference flux evaluated at the reference state (units depend on</span>
<span class="sd">            `func_flux`, e.g. W m$^{-2}$).</span>
<span class="sd">        flux_anom_linear: Sum of linear contributions to the flux anomaly (same</span>
<span class="sd">            units as `flux_ref`).</span>
<span class="sd">        flux_anom_nl: Sum of linear plus nonlinear contributions included in the</span>
<span class="sd">            reconstruction (same units as `flux_ref`).</span>
<span class="sd">        info_cont: Dictionary of individual contributions by mechanism and</span>
<span class="sd">            interaction term. Always includes `residual`, defined as the</span>
<span class="sd">            difference between the full flux anomaly computed from `vals` and the</span>
<span class="sd">            reconstructed anomaly.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no mechanism arrays are provided (so a broadcast size</span>
<span class="sd">            cannot be inferred), if provided mechanism arrays have inconsistent</span>
<span class="sd">            `.size`, or if the expected key sets do not match in the analytical</span>
<span class="sd">            pathway (`gamma` vs `info_cont`).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vals_ref</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_ref&quot;</span><span class="p">)}</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">vals_ref</span><span class="p">}</span>

    <span class="c1"># If no val specified, set to ref value</span>
    <span class="n">key_numpy</span> <span class="o">=</span> <span class="n">first_non_none_key</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>  <span class="c1"># first key of numpy array</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">key_numpy</span><span class="p">],</span> <span class="n">vals_ref</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">vals</span><span class="p">[</span><span class="n">key_numpy</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size mismatch: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not the same as </span><span class="si">{</span><span class="n">key_numpy</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sigma_atm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flux_ref</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals_ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flux_ref</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals_ref</span><span class="p">,</span> <span class="n">p_atm</span><span class="o">=</span><span class="n">sigma_atm</span> <span class="o">*</span> <span class="n">vals_ref</span><span class="p">[</span><span class="s1">&#39;p_surf&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">numerical</span><span class="p">:</span>
        <span class="n">info_cont</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Linear contribution of each val</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">vals_use</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">vals_ref</span><span class="p">)</span>
            <span class="n">vals_use</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sigma_atm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals_use</span><span class="p">[</span><span class="s1">&#39;p_atm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_atm</span> <span class="o">*</span> <span class="n">vals_use</span><span class="p">[</span><span class="s1">&#39;p_surf&#39;</span><span class="p">]</span>
            <span class="n">info_cont</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals_use</span><span class="p">)</span> <span class="o">-</span> <span class="n">flux_ref</span>

        <span class="c1"># Get non-linear contributions where only two mechanisms are active - include all permutations</span>
        <span class="k">for</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">vals_use</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">vals_ref</span><span class="p">)</span>
            <span class="n">vals_use</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">vals_use</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sigma_atm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals_use</span><span class="p">[</span><span class="s1">&#39;p_atm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_atm</span> <span class="o">*</span> <span class="n">vals_use</span><span class="p">[</span><span class="s1">&#39;p_surf&#39;</span><span class="p">]</span>
            <span class="n">info_cont</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals_use</span><span class="p">)</span> <span class="o">-</span> <span class="n">flux_ref</span>
            <span class="c1"># Subtract the contribution from the linear mechanisms, so only non-linear contribution remains</span>
            <span class="n">info_cont</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">info_cont</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">+</span> <span class="n">info_cont</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sigma_atm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">func_sensitivity</span><span class="p">(</span><span class="o">**</span><span class="n">vals_ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">func_sensitivity</span><span class="p">(</span><span class="o">**</span><span class="n">vals_ref</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="o">=</span><span class="n">sigma_atm</span><span class="p">)</span>
        <span class="n">vals_anom</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals_ref</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">}</span>

        <span class="c1"># linear contributions</span>
        <span class="n">info_cont</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">vals_anom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">}</span>

        <span class="c1"># Adds Squared contribution of individual mechanisms that are in gamma</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
                <span class="n">info_cont</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">[</span><span class="n">name_square</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vals_anom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="c1"># Adds a nonlinear combination of mechanisms that are included in gamma</span>
        <span class="k">for</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name_nl</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
                <span class="n">info_cont</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">[</span><span class="n">name_nl</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vals_anom</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vals_anom</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">gamma</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">info_cont</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gamma has keys:</span><span class="se">\n</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">gamma</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="se">\n</span><span class="s2">info_cont has keys:</span><span class="se">\n</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">info_cont</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">final_answer_linear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">info_cont</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">info_cont</span> <span class="k">if</span> <span class="s1">&#39;nl&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]))</span>
    <span class="n">final_answer_nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">info_cont</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">info_cont</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">sigma_atm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info_cont</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals</span><span class="p">)</span> <span class="o">-</span> <span class="n">flux_ref</span> <span class="o">-</span> <span class="n">final_answer_nl</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info_cont</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func_flux</span><span class="p">(</span><span class="o">**</span><span class="n">vals</span><span class="p">,</span> <span class="n">p_atm</span><span class="o">=</span><span class="n">sigma_atm</span> <span class="o">*</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;p_surf&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">flux_ref</span> <span class="o">-</span> <span class="n">final_answer_nl</span>
    <span class="k">return</span> <span class="n">flux_ref</span><span class="p">,</span> <span class="n">final_answer_linear</span><span class="p">,</span> <span class="n">final_answer_nl</span><span class="p">,</span> <span class="n">info_cont</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.reconstruct_lh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_lh</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">,</span> <span class="n">rh_atm_ref</span><span class="p">,</span> <span class="n">w_atm_ref</span><span class="p">,</span> <span class="n">drag_coef_ref</span><span class="p">,</span> <span class="n">p_surf_ref</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">,</span> <span class="n">evap_prefactor_ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rh_atm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_atm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drag_coef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evap_prefactor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numerical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reconstruct latent heat flux anomalies from a reference state.</p>
<p>This function computes a reference latent heat flux <span class="arithmatex">\(LH_{ref}\)</span> at a scalar
reference state, then reconstructs anomalies relative to that reference either
(i) numerically by swapping one (or two) mechanisms at a time into the bulk
formula or (ii) analytically using a Taylor expansion based on sensitivities
returned by <code>get_sensitivity_lh</code>.</p>
<p>The near-surface atmospheric pressure is diagnosed with a sigma level:
<span class="arithmatex">\(p_a = \sigma_a p_s\)</span>.</p>
<p>The near-surface atmospheric temperature is diagnosed using a surfaceair
disequilibrium temperature <span class="arithmatex">\(T_{dq}\)</span>:
<span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>.</p>
<p>Optional mechanism arrays (e.g. <code>temp_surf</code>) are interpreted as alternative
states to compare against the reference. If an optional mechanism is not
provided, it is filled with the reference value broadcast to the size of the
first provided mechanism array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference disequilibrium temperature, <span class="arithmatex">\(T_{dq}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_atm_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference near-surface relative humidity, <span class="arithmatex">\(r_a\)</span> (unitless, 01)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference bulk exchange coefficient, <span class="arithmatex">\(C_E\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma_atm</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sigma coordinate for the near-surface atmosphere, <span class="arithmatex">\(\sigma_a\)</span>
(unitless), used to compute <span class="arithmatex">\(p_a = \sigma_a p_s\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evap_prefactor_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference evaporation prefactor, <span class="arithmatex">\(\beta\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative surface temperature <span class="arithmatex">\(T_s\)</span> (K). If None, uses
<code>temp_surf_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative disequilibrium temperature <span class="arithmatex">\(T_{dq}\)</span> (K). If None,
uses <code>temp_diseqb_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_atm</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative relative humidity <span class="arithmatex">\(RH\)</span> (unitless, 01). If None, uses
<code>rh_atm_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative wind speed <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>). If None, uses <code>w_atm_ref</code>
broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative bulk exchange coefficient <span class="arithmatex">\(C_E\)</span> (unitless). If None,
uses <code>drag_coef_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative surface pressure <span class="arithmatex">\(p_s\)</span> (Pa). If None, uses <code>p_surf_ref</code>
broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evap_prefactor</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative evaporation prefactor <span class="arithmatex">\(\alpha\)</span> (unitless). If
None, uses <code>evap_prefactor_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute contributions by explicitly evaluating
<code>get_latent_heat</code> with one- and two-mechanism substitutions relative to
the reference. If False, use sensitivities from <code>get_sensitivity_lh</code>
to build a Taylor-series reconstruction (including selected nonlinear
terms if present in <code>gamma</code>)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lh_ref</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference latent heat flux <span class="arithmatex">\(LH_{ref}\)</span> (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lh_anom_linear</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear contributions to the latent heat anomaly
(W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lh_anom_nl</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear plus nonlinear contributions included in the
reconstruction (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of individual contributions by mechanism and
interaction term. Always includes <code>residual</code>, defined as the
difference between the full bulk flux anomaly and the reconstructed
anomaly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided optional arrays do not all have the same <code>.size</code>
as the first provided mechanism array, or if the expected key sets do
not match in the analytical pathway</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_lh</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">rh_atm_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">w_atm_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">drag_coef_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">p_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">evap_prefactor_ref</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">rh_atm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">w_atm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">evap_prefactor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">numerical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct latent heat flux anomalies from a reference state.</span>

<span class="sd">    This function computes a reference latent heat flux $LH_{ref}$ at a scalar</span>
<span class="sd">    reference state, then reconstructs anomalies relative to that reference either</span>
<span class="sd">    (i) numerically by swapping one (or two) mechanisms at a time into the bulk</span>
<span class="sd">    formula or (ii) analytically using a Taylor expansion based on sensitivities</span>
<span class="sd">    returned by `get_sensitivity_lh`.</span>

<span class="sd">    The near-surface atmospheric pressure is diagnosed with a sigma level:</span>
<span class="sd">    $p_a = \\sigma_a p_s$.</span>

<span class="sd">    The near-surface atmospheric temperature is diagnosed using a surfaceair</span>
<span class="sd">    disequilibrium temperature $T_{dq}$:</span>
<span class="sd">    $T_a = T_s - T_{dq}$.</span>

<span class="sd">    Optional mechanism arrays (e.g. `temp_surf`) are interpreted as alternative</span>
<span class="sd">    states to compare against the reference. If an optional mechanism is not</span>
<span class="sd">    provided, it is filled with the reference value broadcast to the size of the</span>
<span class="sd">    first provided mechanism array.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_ref: Reference surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb_ref: Reference disequilibrium temperature, $T_{dq}$ (K)</span>
<span class="sd">        rh_atm_ref: Reference near-surface relative humidity, $r_a$ (unitless, 01)</span>
<span class="sd">        w_atm_ref: Reference near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef_ref: Reference bulk exchange coefficient, $C_E$ (unitless)</span>
<span class="sd">        p_surf_ref: Reference surface pressure, $p_s$ (Pa)</span>
<span class="sd">        sigma_atm: Sigma coordinate for the near-surface atmosphere, $\\sigma_a$</span>
<span class="sd">            (unitless), used to compute $p_a = \\sigma_a p_s$</span>
<span class="sd">        evap_prefactor_ref: Reference evaporation prefactor, $\\beta$ (unitless)</span>
<span class="sd">        temp_surf: Alternative surface temperature $T_s$ (K). If None, uses</span>
<span class="sd">            `temp_surf_ref` broadcast to the working array size</span>
<span class="sd">        temp_diseqb: Alternative disequilibrium temperature $T_{dq}$ (K). If None,</span>
<span class="sd">            uses `temp_diseqb_ref` broadcast to the working array size</span>
<span class="sd">        rh_atm: Alternative relative humidity $RH$ (unitless, 01). If None, uses</span>
<span class="sd">            `rh_atm_ref` broadcast to the working array size</span>
<span class="sd">        w_atm: Alternative wind speed $U$ (m s$^{-1}$). If None, uses `w_atm_ref`</span>
<span class="sd">            broadcast to the working array size</span>
<span class="sd">        drag_coef: Alternative bulk exchange coefficient $C_E$ (unitless). If None,</span>
<span class="sd">            uses `drag_coef_ref` broadcast to the working array size</span>
<span class="sd">        p_surf: Alternative surface pressure $p_s$ (Pa). If None, uses `p_surf_ref`</span>
<span class="sd">            broadcast to the working array size</span>
<span class="sd">        evap_prefactor: Alternative evaporation prefactor $\\alpha$ (unitless). If</span>
<span class="sd">            None, uses `evap_prefactor_ref` broadcast to the working array size</span>
<span class="sd">        numerical: If True, compute contributions by explicitly evaluating</span>
<span class="sd">            `get_latent_heat` with one- and two-mechanism substitutions relative to</span>
<span class="sd">            the reference. If False, use sensitivities from `get_sensitivity_lh`</span>
<span class="sd">            to build a Taylor-series reconstruction (including selected nonlinear</span>
<span class="sd">            terms if present in `gamma`)</span>

<span class="sd">    Returns:</span>
<span class="sd">        lh_ref: Reference latent heat flux $LH_{ref}$ (W m$^{-2}$)</span>
<span class="sd">        lh_anom_linear: Sum of linear contributions to the latent heat anomaly</span>
<span class="sd">            (W m$^{-2}$)</span>
<span class="sd">        lh_anom_nl: Sum of linear plus nonlinear contributions included in the</span>
<span class="sd">            reconstruction (W m$^{-2}$)</span>
<span class="sd">        info_cont: Dictionary of individual contributions by mechanism and</span>
<span class="sd">            interaction term. Always includes `residual`, defined as the</span>
<span class="sd">            difference between the full bulk flux anomaly and the reconstructed</span>
<span class="sd">            anomaly</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If provided optional arrays do not all have the same `.size`</span>
<span class="sd">            as the first provided mechanism array, or if the expected key sets do</span>
<span class="sd">            not match in the analytical pathway</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">reconstruct_flux</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">get_latent_heat</span><span class="p">,</span> <span class="n">get_sensitivity_lh</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">,</span> <span class="n">numerical</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.reconstruct_lw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_lw</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">,</span> <span class="n">temp_diseqb_r_ref</span><span class="p">,</span> <span class="n">odp_surf_ref</span><span class="p">,</span> <span class="n">temp_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">odp_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numerical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reconstruct net upward surface longwave anomalies from a reference state.</p>
<p>This function computes a reference net upward surface longwave flux
<span class="arithmatex">\(LW^{\uparrow}_{net,sfc,ref}\)</span> at a scalar reference state, then reconstructs
anomalies relative to that reference either (i) numerically by swapping one
(or two) mechanisms at a time into the gray-gas flux formula or (ii)
analytically using a Taylor expansion based on sensitivities returned by
<code>get_sensitivity_lw</code>.</p>
<p>The gray-gas optical depth at the surface is denoted <span class="arithmatex">\(\tau_s\)</span> (argument
<code>odp_surf</code>). The effective radiating temperature used by the gray-gas
parameterization is diagnosed via
<span class="arithmatex">\(T_{rad} = T_s - T_{dq} - T_{dq,r}\)</span>.</p>
<p>Optional mechanism arrays (e.g. <code>temp_surf</code>) are interpreted as alternative
states to compare against the reference. If an optional mechanism is not
provided, it is filled with the reference value broadcast to the size of the
first provided mechanism array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surfaceair disequilibrium temperature, <span class="arithmatex">\(T_{dq}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_r_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference additional radiative disequilibrium offset,
<span class="arithmatex">\(T_{dq,r}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>odp_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference imposed gray optical depth, <span class="arithmatex">\(\tau_s\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative surface temperature <span class="arithmatex">\(T_s\)</span> (K). If None, uses
<code>temp_surf_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative disequilibrium temperature <span class="arithmatex">\(T_{dq}\)</span> (K). If None,
uses <code>temp_diseqb_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_r</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative radiative disequilibrium offset <span class="arithmatex">\(T_{dq,r}\)</span> (K).
If None, uses <code>temp_diseqb_r_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>odp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative optical depth <span class="arithmatex">\(\tau_s\)</span> (unitless). If None, uses
<code>odp_surf_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute contributions by explicitly evaluating
<code>get_lwup_sfc_net</code> with one- and two-mechanism substitutions relative
to the reference. If False, use sensitivities from <code>get_sensitivity_lw</code>
to build a Taylor-series reconstruction (including selected nonlinear
terms if present in <code>gamma</code>)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lw_ref</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference net upward surface longwave flux,
<span class="arithmatex">\(LW^{\uparrow}_{net,sfc,ref}\)</span> (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lw_anom_linear</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear contributions to the longwave anomaly
(W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lw_anom_nl</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear plus nonlinear contributions included in the
reconstruction (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of individual contributions by mechanism and
interaction term. Always includes <code>residual</code>, defined as the
difference between the full gray-gas flux anomaly and the
reconstructed anomaly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided optional arrays do not all have the same <code>.size</code>
as the first provided mechanism array, or if the expected key sets do
not match in the analytical pathway</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This wrapper delegates the full computation to <code>reconstruct_flux</code>.
Ensure <code>reconstruct_flux</code> is called with the appropriate signature for
your implementation (e.g. whether it requires <code>sigma_atm</code> or passes
additional keywords to the flux function).</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_lw</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">temp_diseqb_r_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">odp_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">temp_diseqb_r</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">odp_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">numerical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct net upward surface longwave anomalies from a reference state.</span>

<span class="sd">    This function computes a reference net upward surface longwave flux</span>
<span class="sd">    $LW^{\\uparrow}_{net,sfc,ref}$ at a scalar reference state, then reconstructs</span>
<span class="sd">    anomalies relative to that reference either (i) numerically by swapping one</span>
<span class="sd">    (or two) mechanisms at a time into the gray-gas flux formula or (ii)</span>
<span class="sd">    analytically using a Taylor expansion based on sensitivities returned by</span>
<span class="sd">    `get_sensitivity_lw`.</span>

<span class="sd">    The gray-gas optical depth at the surface is denoted $\\tau_s$ (argument</span>
<span class="sd">    `odp_surf`). The effective radiating temperature used by the gray-gas</span>
<span class="sd">    parameterization is diagnosed via</span>
<span class="sd">    $T_{rad} = T_s - T_{dq} - T_{dq,r}$.</span>

<span class="sd">    Optional mechanism arrays (e.g. `temp_surf`) are interpreted as alternative</span>
<span class="sd">    states to compare against the reference. If an optional mechanism is not</span>
<span class="sd">    provided, it is filled with the reference value broadcast to the size of the</span>
<span class="sd">    first provided mechanism array.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_ref: Reference surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb_ref: Reference surfaceair disequilibrium temperature, $T_{dq}$ (K)</span>
<span class="sd">        temp_diseqb_r_ref: Reference additional radiative disequilibrium offset,</span>
<span class="sd">            $T_{dq,r}$ (K)</span>
<span class="sd">        odp_surf_ref: Reference imposed gray optical depth, $\\tau_s$ (unitless)</span>
<span class="sd">        temp_surf: Alternative surface temperature $T_s$ (K). If None, uses</span>
<span class="sd">            `temp_surf_ref` broadcast to the working array size</span>
<span class="sd">        temp_diseqb: Alternative disequilibrium temperature $T_{dq}$ (K). If None,</span>
<span class="sd">            uses `temp_diseqb_ref` broadcast to the working array size</span>
<span class="sd">        temp_diseqb_r: Alternative radiative disequilibrium offset $T_{dq,r}$ (K).</span>
<span class="sd">            If None, uses `temp_diseqb_r_ref` broadcast to the working array size</span>
<span class="sd">        odp_surf: Alternative optical depth $\\tau_s$ (unitless). If None, uses</span>
<span class="sd">            `odp_surf_ref` broadcast to the working array size</span>
<span class="sd">        numerical: If True, compute contributions by explicitly evaluating</span>
<span class="sd">            `get_lwup_sfc_net` with one- and two-mechanism substitutions relative</span>
<span class="sd">            to the reference. If False, use sensitivities from `get_sensitivity_lw`</span>
<span class="sd">            to build a Taylor-series reconstruction (including selected nonlinear</span>
<span class="sd">            terms if present in `gamma`)</span>

<span class="sd">    Returns:</span>
<span class="sd">        lw_ref: Reference net upward surface longwave flux,</span>
<span class="sd">            $LW^{\\uparrow}_{net,sfc,ref}$ (W m$^{-2}$)</span>
<span class="sd">        lw_anom_linear: Sum of linear contributions to the longwave anomaly</span>
<span class="sd">            (W m$^{-2}$)</span>
<span class="sd">        lw_anom_nl: Sum of linear plus nonlinear contributions included in the</span>
<span class="sd">            reconstruction (W m$^{-2}$)</span>
<span class="sd">        info_cont: Dictionary of individual contributions by mechanism and</span>
<span class="sd">            interaction term. Always includes `residual`, defined as the</span>
<span class="sd">            difference between the full gray-gas flux anomaly and the</span>
<span class="sd">            reconstructed anomaly</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If provided optional arrays do not all have the same `.size`</span>
<span class="sd">            as the first provided mechanism array, or if the expected key sets do</span>
<span class="sd">            not match in the analytical pathway</span>

<span class="sd">    Notes:</span>
<span class="sd">        This wrapper delegates the full computation to `reconstruct_flux`.</span>
<span class="sd">        Ensure `reconstruct_flux` is called with the appropriate signature for</span>
<span class="sd">        your implementation (e.g. whether it requires `sigma_atm` or passes</span>
<span class="sd">        additional keywords to the flux function).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">reconstruct_flux</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">get_lwup_sfc_net</span><span class="p">,</span> <span class="n">get_sensitivity_lw</span><span class="p">,</span> <span class="n">numerical</span><span class="o">=</span><span class="n">numerical</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.surface_flux_taylor.reconstruct_sh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_sh</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">,</span> <span class="n">w_atm_ref</span><span class="p">,</span> <span class="n">drag_coef_ref</span><span class="p">,</span> <span class="n">p_surf_ref</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">,</span> <span class="n">temp_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_atm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drag_coef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_surf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numerical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reconstruct sensible heat flux anomalies from a reference state.</p>
<p>This function computes a reference sensible heat flux <span class="arithmatex">\(SH_{ref}\)</span> at a scalar
reference state, then reconstructs anomalies relative to that reference either
(i) numerically by swapping one (or two) mechanisms at a time into the bulk
formula or (ii) analytically using a Taylor expansion based on sensitivities
returned by <code>get_sensitivity_sh</code>.</p>
<p>The near-surface atmospheric pressure is diagnosed with a sigma level:
<span class="arithmatex">\(p_a = \sigma_a p_s\)</span>.</p>
<p>The near-surface atmospheric temperature is diagnosed using a surfaceair
disequilibrium temperature <span class="arithmatex">\(T_{dq}\)</span>:
<span class="arithmatex">\(T_a = T_s - T_{dq}\)</span>.</p>
<p>Optional mechanism arrays (e.g. <code>temp_surf</code>) are interpreted as alternative
states to compare against the reference. If an optional mechanism is not
provided, it is filled with the reference value broadcast to the size of the
first provided mechanism array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surface temperature, <span class="arithmatex">\(T_s\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference disequilibrium temperature, <span class="arithmatex">\(T_{dq}\)</span> (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference near-surface wind speed, <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference bulk transfer coefficient for sensible heat,
<span class="arithmatex">\(C_H\)</span> (unitless)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf_ref</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference surface pressure, <span class="arithmatex">\(p_s\)</span> (Pa)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma_atm</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sigma coordinate for the near-surface atmosphere, <span class="arithmatex">\(\sigma_a\)</span>
(unitless), used to compute <span class="arithmatex">\(p_a = \sigma_a p_s\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative surface temperature <span class="arithmatex">\(T_s\)</span> (K). If None, uses
<code>temp_surf_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_diseqb</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative disequilibrium temperature <span class="arithmatex">\(T_{dq}\)</span> (K). If None,
uses <code>temp_diseqb_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_atm</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative wind speed <span class="arithmatex">\(U\)</span> (m s<span class="arithmatex">\(^{-1}\)</span>). If None, uses <code>w_atm_ref</code>
broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drag_coef</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative bulk transfer coefficient <span class="arithmatex">\(C_H\)</span> (unitless). If None,
uses <code>drag_coef_ref</code> broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p_surf</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alternative surface pressure <span class="arithmatex">\(p_s\)</span> (Pa). If None, uses <code>p_surf_ref</code>
broadcast to the working array size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute contributions by explicitly evaluating
<code>get_sensible_heat</code> with one- and two-mechanism substitutions relative
to the reference. If False, use sensitivities from <code>get_sensitivity_sh</code>
to build a Taylor-series reconstruction (including selected nonlinear
terms if present in <code>gamma</code>)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sh_ref</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference sensible heat flux <span class="arithmatex">\(SH_{ref}\)</span> (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>sh_anom_linear</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear contributions to the sensible heat anomaly
(W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>sh_anom_nl</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of linear plus nonlinear contributions included in the
reconstruction (W m<span class="arithmatex">\(^{-2}\)</span>)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of individual contributions by mechanism and
interaction term. Always includes <code>residual</code>, defined as the
difference between the full bulk flux anomaly and the reconstructed
anomaly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided optional arrays do not all have the same <code>.size</code>
as the first provided mechanism array, or if the expected key sets do
not match in the analytical pathway</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/surface_flux_taylor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_sh</span><span class="p">(</span><span class="n">temp_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_diseqb_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">w_atm_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">drag_coef_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">p_surf_ref</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">temp_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">temp_diseqb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">w_atm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">drag_coef</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p_surf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">numerical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct sensible heat flux anomalies from a reference state.</span>

<span class="sd">    This function computes a reference sensible heat flux $SH_{ref}$ at a scalar</span>
<span class="sd">    reference state, then reconstructs anomalies relative to that reference either</span>
<span class="sd">    (i) numerically by swapping one (or two) mechanisms at a time into the bulk</span>
<span class="sd">    formula or (ii) analytically using a Taylor expansion based on sensitivities</span>
<span class="sd">    returned by `get_sensitivity_sh`.</span>

<span class="sd">    The near-surface atmospheric pressure is diagnosed with a sigma level:</span>
<span class="sd">    $p_a = \\sigma_a p_s$.</span>

<span class="sd">    The near-surface atmospheric temperature is diagnosed using a surfaceair</span>
<span class="sd">    disequilibrium temperature $T_{dq}$:</span>
<span class="sd">    $T_a = T_s - T_{dq}$.</span>

<span class="sd">    Optional mechanism arrays (e.g. `temp_surf`) are interpreted as alternative</span>
<span class="sd">    states to compare against the reference. If an optional mechanism is not</span>
<span class="sd">    provided, it is filled with the reference value broadcast to the size of the</span>
<span class="sd">    first provided mechanism array.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_ref: Reference surface temperature, $T_s$ (K)</span>
<span class="sd">        temp_diseqb_ref: Reference disequilibrium temperature, $T_{dq}$ (K)</span>
<span class="sd">        w_atm_ref: Reference near-surface wind speed, $U$ (m s$^{-1}$)</span>
<span class="sd">        drag_coef_ref: Reference bulk transfer coefficient for sensible heat,</span>
<span class="sd">            $C_H$ (unitless)</span>
<span class="sd">        p_surf_ref: Reference surface pressure, $p_s$ (Pa)</span>
<span class="sd">        sigma_atm: Sigma coordinate for the near-surface atmosphere, $\\sigma_a$</span>
<span class="sd">            (unitless), used to compute $p_a = \\sigma_a p_s$</span>
<span class="sd">        temp_surf: Alternative surface temperature $T_s$ (K). If None, uses</span>
<span class="sd">            `temp_surf_ref` broadcast to the working array size</span>
<span class="sd">        temp_diseqb: Alternative disequilibrium temperature $T_{dq}$ (K). If None,</span>
<span class="sd">            uses `temp_diseqb_ref` broadcast to the working array size</span>
<span class="sd">        w_atm: Alternative wind speed $U$ (m s$^{-1}$). If None, uses `w_atm_ref`</span>
<span class="sd">            broadcast to the working array size</span>
<span class="sd">        drag_coef: Alternative bulk transfer coefficient $C_H$ (unitless). If None,</span>
<span class="sd">            uses `drag_coef_ref` broadcast to the working array size</span>
<span class="sd">        p_surf: Alternative surface pressure $p_s$ (Pa). If None, uses `p_surf_ref`</span>
<span class="sd">            broadcast to the working array size</span>
<span class="sd">        numerical: If True, compute contributions by explicitly evaluating</span>
<span class="sd">            `get_sensible_heat` with one- and two-mechanism substitutions relative</span>
<span class="sd">            to the reference. If False, use sensitivities from `get_sensitivity_sh`</span>
<span class="sd">            to build a Taylor-series reconstruction (including selected nonlinear</span>
<span class="sd">            terms if present in `gamma`)</span>

<span class="sd">    Returns:</span>
<span class="sd">        sh_ref: Reference sensible heat flux $SH_{ref}$ (W m$^{-2}$)</span>
<span class="sd">        sh_anom_linear: Sum of linear contributions to the sensible heat anomaly</span>
<span class="sd">            (W m$^{-2}$)</span>
<span class="sd">        sh_anom_nl: Sum of linear plus nonlinear contributions included in the</span>
<span class="sd">            reconstruction (W m$^{-2}$)</span>
<span class="sd">        info_cont: Dictionary of individual contributions by mechanism and</span>
<span class="sd">            interaction term. Always includes `residual`, defined as the</span>
<span class="sd">            difference between the full bulk flux anomaly and the reconstructed</span>
<span class="sd">            anomaly</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If provided optional arrays do not all have the same `.size`</span>
<span class="sd">            as the first provided mechanism array, or if the expected key sets do</span>
<span class="sd">            not match in the analytical pathway</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">reconstruct_flux</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">get_sensible_heat</span><span class="p">,</span> <span class="n">get_sensitivity_sh</span><span class="p">,</span> <span class="n">sigma_atm</span><span class="p">,</span> <span class="n">numerical</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/jduffield65/Isca" target="_blank" rel="noopener" title="Github Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.expand", "content.tabs.link", "navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>