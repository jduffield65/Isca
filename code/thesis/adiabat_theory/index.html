
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../run/create_files/">
      
      
        <link rel="next" href="../adiabat_theory2/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Adiabat Theory - Isca</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#isca_tools.thesis.adiabat_theory" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Isca" class="md-header__button md-logo" aria-label="Isca" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Isca
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adiabat Theory
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jduffield65/Isca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jduffield65/Isca
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hpc_basics/kennedy/" class="md-tabs__link">
          
  
  
    
  
  HPC Basics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Isca/getting_started/" class="md-tabs__link">
          
  
  
    
  
  Isca

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../namelists/" class="md-tabs__link">
          
  
  
    
  
  Namelists

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CESM/" class="md-tabs__link">
          
  
  
    
  
  CESM

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../cesm/base/" class="md-tabs__link">
          
  
  
    
  
  Code

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Isca" class="md-nav__button md-logo" aria-label="Isca" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    Isca
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jduffield65/Isca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jduffield65/Isca
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    HPC Basics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    HPC Basics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/kennedy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kennedy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/shell_scripting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shell Scripting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Slurm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc_basics/pycharm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pycharm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Isca
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Isca
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/time_series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Series
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Isca/socrates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOCRATES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Namelists
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Namelists
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/main/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Main
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Main
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/experiment_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Experiment Details
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/atmosphere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atmosphere
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/held_suarez/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Held Suarez
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/idealized_moist_physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Idealized Moist Physics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/main/spectral_dynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spectral Dynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/convection/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Convection
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Convection
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/qe_moist_convection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quasi Equilibrium Moist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/betts_miller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Betts-Miller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/ras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relaxed Arakawa Schubert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/convection/dry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dry Convection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/condensation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Condensation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Condensation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/condensation/lscale_cond/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large Scale Condensation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/condensation/sat_vapor_pres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Saturation Vapor Pressure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Radiation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Radiation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/two_stream_gray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/rrtm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RRTM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/radiation/socrates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOCRATES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Surface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Surface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/mixed_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mixed Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/surface_flux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Flux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/surface/topography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Topography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../namelists/damping/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Damping
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Damping
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Turbulence
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Turbulence
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/turbulence/vert_turb_driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vertical Turbulence Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../namelists/turbulence/diffusivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diffusivity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../CESM/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CESM
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CESM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CESM/first_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    CESM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    CESM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cesm/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cesm/load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Convection
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Convection
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../convection/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../convection/simple_betts_miller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple Betts-Miller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    ERA5
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ERA5
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3_1" >
        
          
          <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Get Jasmin ERA5
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get Jasmin ERA5
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../era5/get_jasmin_era5/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../era5/get_jasmin_era5/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    JASMIN
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    JASMIN
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jasmin/run/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Land
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../land/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../land/mountains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mountains
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Papers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Papers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../papers/byrne_2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Byrne 2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../papers/miyawaki_2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Miyawaki 2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Plot
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plot
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/spin_up/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spin Up
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Run
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Run
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/cmip_time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cmip Time
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/create_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create Files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_9" checked>
        
          
          <label class="md-nav__link" for="__nav_6_9" id="__nav_6_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Thesis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Thesis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Adiabat Theory
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Adiabat Theory
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory" class="md-nav__link">
    <span class="md-ellipsis">
      
        adiabat_theory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.decompose_temp_adiabat_anomaly" class="md-nav__link">
    <span class="md-ellipsis">
      
        decompose_temp_adiabat_anomaly
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.decompose_temp_ft_anom_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        decompose_temp_ft_anom_change
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_gamma_factors" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_gamma_factors
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_p_x" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_p_x
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_scaling_factor_theory" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scaling_factor_theory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_temp_adiabat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_adiabat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_temp_adiabat_surf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_adiabat_surf
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_theory_prefactor_terms" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_theory_prefactor_terms
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_z_ft_approx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_z_ft_approx
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.mse_mod_anom_change_ft_expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        mse_mod_anom_change_ft_expansion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.mse_mod_change_surf_expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        mse_mod_change_surf_expansion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.temp_adiabat_fit_func" class="md-nav__link">
    <span class="md-ellipsis">
      
        temp_adiabat_fit_func
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.temp_adiabat_surf_fit_func" class="md-nav__link">
    <span class="md-ellipsis">
      
        temp_adiabat_surf_fit_func
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adiabat_theory2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adiabat Theory 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aquaplanet_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aquaplanet Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extrop_land_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extratropics Land Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lapse_integral_simple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lapse Integration (Simple)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lapse_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lapse Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mod_parcel_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mod Parcel Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile_fitting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Profile Fitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../surface_energy_budget/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Energy Budget
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../surface_flux_taylor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Flux Taylor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utils
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calculus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/circulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Circulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/ds_slicing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Slicing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debug
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/decomposition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decomposition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/fourier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fourier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/land/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Land
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/moist_physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Moist Physics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/numerical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Numerical
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/radiation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Radiation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Statistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/xarray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Xarray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory" class="md-nav__link">
    <span class="md-ellipsis">
      
        adiabat_theory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.decompose_temp_adiabat_anomaly" class="md-nav__link">
    <span class="md-ellipsis">
      
        decompose_temp_adiabat_anomaly
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.decompose_temp_ft_anom_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        decompose_temp_ft_anom_change
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_gamma_factors" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_gamma_factors
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_p_x" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_p_x
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_scaling_factor_theory" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_scaling_factor_theory
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_temp_adiabat" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_adiabat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_temp_adiabat_surf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temp_adiabat_surf
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_theory_prefactor_terms" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_theory_prefactor_terms
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.get_z_ft_approx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_z_ft_approx
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.mse_mod_anom_change_ft_expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        mse_mod_anom_change_ft_expansion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.mse_mod_change_surf_expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        mse_mod_change_surf_expansion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.temp_adiabat_fit_func" class="md-nav__link">
    <span class="md-ellipsis">
      
        temp_adiabat_fit_func
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isca_tools.thesis.adiabat_theory.temp_adiabat_surf_fit_func" class="md-nav__link">
    <span class="md-ellipsis">
      
        temp_adiabat_surf_fit_func
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Adiabat Theory</h1>

<div class="doc doc-object doc-module">



<a id="isca_tools.thesis.adiabat_theory"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.decompose_temp_adiabat_anomaly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decompose_temp_adiabat_anomaly</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">,</span> <span class="n">temp_surf_quant</span><span class="p">,</span> <span class="n">sphum_mean</span><span class="p">,</span> <span class="n">sphum_quant</span><span class="p">,</span> <span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>The theory for <span class="arithmatex">\(\delta T(x)\)</span> involves the adiabatic temperature anomaly, <span class="arithmatex">\(\Delta T_A\)</span>. This can be decomposed
into more physically meaningful quantities:</p>
<div class="arithmatex">\[\Delta T_A(x) = T_A(x) - \overline{T_A} = \overline{T_{CE}} - T_{CE}(x) + \Delta T_{FT}(x)\]</div>
<p>where:</p>
<ul>
<li><span class="arithmatex">\(\overline{T_{CE}} = \overline{T_{FT}} - \overline{T_A}\)</span> represents the deviation of the mean free tropospheric
temperature from the adiabatic temperature. If at convective equilibrium, this would be zero. If the mean day had
CAPE, this would be negative, as the lapse rate would be steeper than that expected by convection.</li>
<li><span class="arithmatex">\(T_{CE}(x) = T_{FT}(x) - T_A(x)\)</span> represents the deviation of the free tropospheric
temperature from the adiabatic temperature conditioned on percentile <span class="arithmatex">\(x\)</span> of near-surface temperature.</li>
<li><span class="arithmatex">\(\Delta T_{FT}(x) = T_{FT}(x) - \overline{T_{FT}}\)</span> represents the gradient of the free tropospheric temperature.
Near the tropics, we expect a weak temperature gradient (WTG) so this term would be small.</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average near surface temperature of each simulation, corresponding to a different
optical depth, <span class="arithmatex">\(\kappa\)</span>. Units: <em>K</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>temp_surf_quant[i, j]</code> is the percentile <code>quant_use[j]</code> of near surface temperature of
experiment <code>i</code>. Units: <em>K</em>.</br>
Note that <code>quant_use</code> is not provided as not needed by this function, but is likely to be
<code>np.arange(1, 100)</code> - leave out <code>x=0</code> as doesn't really make sense to consider <span class="arithmatex">\(0^{th}\)</span> percentile
of a quantity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average near surface specific humidity of each simulation. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>sphum_quant[i, j]</code> is near-surface specific humidity, averaged over all days with near-surface temperature
 corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>temp_ft_quant[i, j]</code> is temperature at <code>pressure_ft</code>, averaged over all days with near-surface temperature
 corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>temp_adiabat_anom</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
Adiabatic temperature anomaly at <code>pressure_ft</code>, <span class="arithmatex">\(\Delta T_A(x) = T_A(x) - \overline{T_A}\)</span>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>temp_ce_mean</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Deviation of mean temperature at <code>pressure_ft</code> from mean adiabatic temperature:
<span class="arithmatex">\(\overline{T_{CE}} = \overline{T_{FT}} - \overline{T_A}\)</span>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>temp_ce_quant</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
Deviation of temperature at <code>pressure_ft</code> from adiabatic temperature: <span class="arithmatex">\(T_{CE}(x) = T_{FT}(x) - T_A(x)\)</span>.
Conditioned on percentile of near-surface temperature.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>temp_ft_anom</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
Temperature anomaly at <code>pressure_ft</code>, <span class="arithmatex">\(\Delta T_{FT}(x) = T_{FT}(x) - \overline{T_{FT}}\)</span>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decompose_temp_adiabat_anomaly</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_surf_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sphum_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                   <span class="n">sphum_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                   <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span>
                                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The theory for $\delta T(x)$ involves the adiabatic temperature anomaly, $\Delta T_A$. This can be decomposed</span>
<span class="sd">    into more physically meaningful quantities:</span>

<span class="sd">    $$\Delta T_A(x) = T_A(x) - \overline{T_A} = \overline{T_{CE}} - T_{CE}(x) + \Delta T_{FT}(x)$$</span>

<span class="sd">    where:</span>

<span class="sd">    * $\overline{T_{CE}} = \overline{T_{FT}} - \overline{T_A}$ represents the deviation of the mean free tropospheric</span>
<span class="sd">    temperature from the adiabatic temperature. If at convective equilibrium, this would be zero. If the mean day had</span>
<span class="sd">    CAPE, this would be negative, as the lapse rate would be steeper than that expected by convection.</span>
<span class="sd">    * $T_{CE}(x) = T_{FT}(x) - T_A(x)$ represents the deviation of the free tropospheric</span>
<span class="sd">    temperature from the adiabatic temperature conditioned on percentile $x$ of near-surface temperature.</span>
<span class="sd">    * $\Delta T_{FT}(x) = T_{FT}(x) - \overline{T_{FT}}$ represents the gradient of the free tropospheric temperature.</span>
<span class="sd">    Near the tropics, we expect a weak temperature gradient (WTG) so this term would be small.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average near surface temperature of each simulation, corresponding to a different</span>
<span class="sd">            optical depth, $\kappa$. Units: *K*.</span>
<span class="sd">        temp_surf_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `temp_surf_quant[i, j]` is the percentile `quant_use[j]` of near surface temperature of</span>
<span class="sd">            experiment `i`. Units: *K*.&lt;/br&gt;</span>
<span class="sd">            Note that `quant_use` is not provided as not needed by this function, but is likely to be</span>
<span class="sd">            `np.arange(1, 100)` - leave out `x=0` as doesn&#39;t really make sense to consider $0^{th}$ percentile</span>
<span class="sd">            of a quantity.</span>
<span class="sd">        sphum_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average near surface specific humidity of each simulation. Units: *kg/kg*.</span>
<span class="sd">        sphum_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `sphum_quant[i, j]` is near-surface specific humidity, averaged over all days with near-surface temperature</span>
<span class="sd">             corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *kg/kg*.</span>
<span class="sd">        temp_ft_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        temp_ft_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `temp_ft_quant[i, j]` is temperature at `pressure_ft`, averaged over all days with near-surface temperature</span>
<span class="sd">             corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *kg/kg*.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        temp_adiabat_anom: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            Adiabatic temperature anomaly at `pressure_ft`, $\Delta T_A(x) = T_A(x) - \overline{T_A}$.</span>
<span class="sd">        temp_ce_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Deviation of mean temperature at `pressure_ft` from mean adiabatic temperature:</span>
<span class="sd">            $\overline{T_{CE}} = \overline{T_{FT}} - \overline{T_A}$.</span>
<span class="sd">        temp_ce_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            Deviation of temperature at `pressure_ft` from adiabatic temperature: $T_{CE}(x) = T_{FT}(x) - T_A(x)$.</span>
<span class="sd">            Conditioned on percentile of near-surface temperature.</span>
<span class="sd">        temp_ft_anom: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            Temperature anomaly at `pressure_ft`, $\Delta T_{FT}(x) = T_{FT}(x) - \overline{T_{FT}}$.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_exp</span><span class="p">,</span> <span class="n">n_quant</span> <span class="o">=</span> <span class="n">temp_surf_quant</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">temp_adiabat_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">)</span>
    <span class="n">temp_adiabat_quant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temp_surf_quant</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_exp</span><span class="p">):</span>
        <span class="n">temp_adiabat_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_temp_adiabat</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sphum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_quant</span><span class="p">):</span>
            <span class="n">temp_adiabat_quant</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_temp_adiabat</span><span class="p">(</span><span class="n">temp_surf_quant</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sphum_quant</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span>
                                                        <span class="n">pressure_ft</span><span class="p">)</span>
    <span class="n">temp_adiabat_anom</span> <span class="o">=</span> <span class="n">temp_adiabat_quant</span> <span class="o">-</span> <span class="n">temp_adiabat_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">temp_ce_quant</span> <span class="o">=</span> <span class="n">temp_ft_quant</span> <span class="o">-</span> <span class="n">temp_adiabat_quant</span>
    <span class="n">temp_ce_mean</span> <span class="o">=</span> <span class="n">temp_ft_mean</span> <span class="o">-</span> <span class="n">temp_adiabat_mean</span>
    <span class="n">temp_ft_anom</span> <span class="o">=</span> <span class="n">temp_ft_quant</span> <span class="o">-</span> <span class="n">temp_ft_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">temp_adiabat_anom</span><span class="p">,</span> <span class="n">temp_ce_mean</span><span class="p">,</span> <span class="n">temp_ce_quant</span><span class="p">,</span> <span class="n">temp_ft_anom</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.decompose_temp_ft_anom_change" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decompose_temp_ft_anom_change</span><span class="p">(</span><span class="n">temp_ft_av</span><span class="p">,</span> <span class="n">temp_ft_x</span><span class="p">,</span> <span class="n">temp_ft_p</span><span class="p">,</span> <span class="n">quant_p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>We can decompose the change in free tropospheric temperature anomaly, conditioned on near-surface temperature
percentile <span class="arithmatex">\(x\)</span> into the change in the corresponding free tropospheric temperature percentile <span class="arithmatex">\(p_x\)</span>, byt accounting
for how <span class="arithmatex">\(p_x\)</span> changes with warming:</p>
<p><span class="arithmatex">\(\delta \Delta T_{FT}(x) \approx \delta \Delta T_{FT}[p_x] + \overline{\eta}\delta \Delta p_x +
\Delta \eta(p_x) \delta \overline{p} + \Delta \eta(p_x)\delta \Delta p_x + \Delta (\delta \eta(p_x) \delta p_x)\)</span></p>
<p>where:</p>
<ul>
<li><span class="arithmatex">\(p_x\)</span> is defined such that <span class="arithmatex">\(T_{FT}(x) = T_{FT}[p_x]\)</span> and <span class="arithmatex">\(\overline{p}\)</span> such that
<span class="arithmatex">\(\overline{T_{FT}} = T_{FT}[\overline{p}]\)</span>.</li>
<li><span class="arithmatex">\(\eta(p_x) = \frac{\partial T_{FT}}{\partial p}\bigg|_{p_x}\)</span>;
<span class="arithmatex">\(\overline{\eta} = \frac{\partial T_{FT}}{\partial p}\bigg|_{\overline{p}}\)</span> and
<span class="arithmatex">\(\Delta \eta(p_x) = \eta(p_x) - \overline{\eta}\)</span>.</li>
<li><span class="arithmatex">\(\delta \Delta p_x = \delta (p_x - \overline{p})\)</span></li>
<li><span class="arithmatex">\(\delta \Delta T_{FT}[p_x] = \delta (T_{FT}[p_x] - T_{FT}[\overline{p}])\)</span> keeping <span class="arithmatex">\(p_x\)</span> and <span class="arithmatex">\(\overline{p}\)</span>
constant.</li>
<li><span class="arithmatex">\(\Delta (\delta \eta(p_x) \delta p_x) = \delta \eta(p_x) \delta p_x - \delta \overline{\eta}\delta \overline{p}\)</span></li>
</ul>
<p>The only approximation in the above is saying that <span class="arithmatex">\(\eta(p)\)</span> is constant between <span class="arithmatex">\(p=p_x\)</span> and <span class="arithmatex">\(p=p_x+\delta p_x\)</span>.
Keeping only the first two terms on the RHS, also provides a good approximation.
This is achieved by setting <code>simple=True</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_av</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average free tropospheric temperature for each experiment, likely to be <span class="arithmatex">\(T_{FT}(x=50)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant_x]</code></br>
Free tropospheric temperature conditioned on near-surface temperature percentile, <span class="arithmatex">\(x\)</span>, for each
experiment: <span class="arithmatex">\(T_{FT}(x)\)</span>. <span class="arithmatex">\(x\)</span> can differ from <code>quant_px</code>, but likely to be the same: <code>np.arange(100)</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_p</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant_p]</code></br>
<code>temp_ft_p[i, j]</code> is the <span class="arithmatex">\(p=\)</span><code>quant_p[j]</code><span class="arithmatex">\(^{th}\)</span> percentile of free tropospheric temperature for
experiment <code>i</code>: <span class="arithmatex">\(T_{FT}[p]\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quant_p</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant_p]</code></br>
Corresponding quantiles to <code>temp_ft_p</code>.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.arange">arange</span>(100, dtype=<span title="int">int</span>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simple</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, <code>temp_ft_change_theory</code> will be
<span class="arithmatex">\(\delta \Delta T_{FT}[p_x] + \overline{\eta}\delta \Delta p_x\)</span>. If <code>False</code>, will also include
<span class="arithmatex">\(\Delta \eta(p_x) \delta \overline{p} + \Delta \eta(p_x)\Delta p_x + \Delta (\delta \eta(p_x) \delta p_x)\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>temp_ft_change</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant_x]</code></br>
Simulated <span class="arithmatex">\(\delta \Delta T_{FT}(x)\)</span></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>temp_ft_change_theory</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant_x]</code></br>
Theoretical <span class="arithmatex">\(\delta \Delta T_{FT}(x)\)</span></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>temp_ft_change_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary recording the five terms in the theory for <span class="arithmatex">\(\delta \Delta T_{FT}(x)\)</span>.
The key name indicates which variable is causing the <span class="arithmatex">\(x\)</span> variation:</p>
<ul>
<li><code>ft_dist</code>: <span class="arithmatex">\(\delta \Delta T_{FT}[p_x]\)</span></li>
<li><code>p_x</code>: <span class="arithmatex">\(\overline{\eta}\delta \Delta p_x\)</span></li>
<li><code>eta0</code>: <span class="arithmatex">\(\Delta \eta(p_x) \delta \overline{p}\)</span></li>
<li><code>eta0_p_x</code>: <span class="arithmatex">\(\Delta \eta(p_x)\delta \Delta p_x\)</span></li>
<li><code>eta_p_x</code>: <span class="arithmatex">\(\Delta (\delta \eta(p_x) \delta p_x)\)</span></li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decompose_temp_ft_anom_change</span><span class="p">(</span><span class="n">temp_ft_av</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                  <span class="n">quant_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">simple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We can decompose the change in free tropospheric temperature anomaly, conditioned on near-surface temperature</span>
<span class="sd">    percentile $x$ into the change in the corresponding free tropospheric temperature percentile $p_x$, byt accounting</span>
<span class="sd">    for how $p_x$ changes with warming:</span>

<span class="sd">    $\delta \Delta T_{FT}(x) \\approx \delta \Delta T_{FT}[p_x] + \overline{\eta}\delta \Delta p_x +</span>
<span class="sd">    \Delta \eta(p_x) \delta \overline{p} + \Delta \eta(p_x)\delta \Delta p_x + \Delta (\delta \eta(p_x) \delta p_x)$</span>

<span class="sd">    where:</span>

<span class="sd">    * $p_x$ is defined such that $T_{FT}(x) = T_{FT}[p_x]$ and $\overline{p}$ such that</span>
<span class="sd">    $\overline{T_{FT}} = T_{FT}[\overline{p}]$.</span>
<span class="sd">    * $\eta(p_x) = \\frac{\\partial T_{FT}}{\\partial p}\\bigg|_{p_x}$;</span>
<span class="sd">    $\overline{\eta} = \\frac{\\partial T_{FT}}{\\partial p}\\bigg|_{\overline{p}}$ and</span>
<span class="sd">    $\Delta \eta(p_x) = \eta(p_x) - \overline{\eta}$.</span>
<span class="sd">    * $\delta \Delta p_x = \delta (p_x - \overline{p})$</span>
<span class="sd">    * $\delta \Delta T_{FT}[p_x] = \delta (T_{FT}[p_x] - T_{FT}[\overline{p}])$ keeping $p_x$ and $\overline{p}$</span>
<span class="sd">    constant.</span>
<span class="sd">    * $\Delta (\delta \eta(p_x) \delta p_x) = \delta \eta(p_x) \delta p_x - \delta \overline{\eta}\delta \overline{p}$</span>

<span class="sd">    The only approximation in the above is saying that $\eta(p)$ is constant between $p=p_x$ and $p=p_x+\delta p_x$.</span>
<span class="sd">    Keeping only the first two terms on the RHS, also provides a good approximation.</span>
<span class="sd">    This is achieved by setting `simple=True`.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_ft_av: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average free tropospheric temperature for each experiment, likely to be $T_{FT}(x=50)$.</span>
<span class="sd">        temp_ft_x: `float [n_exp, n_quant_x]`&lt;/br&gt;</span>
<span class="sd">            Free tropospheric temperature conditioned on near-surface temperature percentile, $x$, for each</span>
<span class="sd">            experiment: $T_{FT}(x)$. $x$ can differ from `quant_px`, but likely to be the same: `np.arange(100)`.</span>
<span class="sd">        temp_ft_p: `float [n_exp, n_quant_p]`&lt;/br&gt;</span>
<span class="sd">            `temp_ft_p[i, j]` is the $p=$`quant_p[j]`$^{th}$ percentile of free tropospheric temperature for</span>
<span class="sd">            experiment `i`: $T_{FT}[p]$.</span>
<span class="sd">        quant_p: `float [n_quant_p]`&lt;/br&gt;</span>
<span class="sd">            Corresponding quantiles to `temp_ft_p`.</span>
<span class="sd">        simple: If `True`, `temp_ft_change_theory` will be</span>
<span class="sd">            $\delta \Delta T_{FT}[p_x] + \overline{\eta}\delta \Delta p_x$. If `False`, will also include</span>
<span class="sd">            $\Delta \eta(p_x) \delta \overline{p} + \Delta \eta(p_x)\Delta p_x + \Delta (\delta \eta(p_x) \delta p_x)$.</span>

<span class="sd">    Returns:</span>
<span class="sd">        temp_ft_change: `float [n_quant_x]`&lt;/br&gt;</span>
<span class="sd">            Simulated $\delta \Delta T_{FT}(x)$</span>
<span class="sd">        temp_ft_change_theory: `float [n_quant_x]`&lt;/br&gt;</span>
<span class="sd">            Theoretical $\delta \Delta T_{FT}(x)$</span>
<span class="sd">        temp_ft_change_cont: Dictionary recording the five terms in the theory for $\delta \Delta T_{FT}(x)$.</span>
<span class="sd">            The key name indicates which variable is causing the $x$ variation:</span>

<span class="sd">            * `ft_dist`: $\delta \Delta T_{FT}[p_x]$</span>
<span class="sd">            * `p_x`: $\overline{\eta}\delta \Delta p_x$</span>
<span class="sd">            * `eta0`: $\Delta \eta(p_x) \delta \overline{p}$</span>
<span class="sd">            * `eta0_p_x`: $\Delta \eta(p_x)\delta \Delta p_x$</span>
<span class="sd">            * `eta_p_x`: $\Delta (\delta \eta(p_x) \delta p_x)$</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_exp</span><span class="p">,</span> <span class="n">n_quant_x</span> <span class="o">=</span> <span class="n">temp_ft_x</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Get FT percentile corresponding to each FT temperature conditioned on near-surface percentile</span>
    <span class="n">p_av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_exp</span><span class="p">)</span>
    <span class="n">p_av_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_exp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_exp</span><span class="p">,</span> <span class="n">n_quant_x</span><span class="p">))</span>
    <span class="n">p_x_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_exp</span><span class="p">,</span> <span class="n">n_quant_x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_exp</span><span class="p">):</span>
        <span class="n">p_av</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p_av_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_p_x</span><span class="p">(</span><span class="n">temp_ft_av</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">temp_ft_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">quant_p</span><span class="p">)</span>
        <span class="n">p_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p_x_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_p_x</span><span class="p">(</span><span class="n">temp_ft_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">temp_ft_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">quant_p</span><span class="p">)</span>

    <span class="c1"># Get eta on corresponding to p_x in the reference (coldest) simulation</span>
    <span class="n">eta_av0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_exp</span><span class="p">)</span>
    <span class="n">eta_px0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_exp</span><span class="p">,</span> <span class="n">n_quant_x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_exp</span><span class="p">):</span>
        <span class="n">eta_use</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">temp_ft_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">quant_p</span><span class="p">)</span>
        <span class="n">eta_av0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eta_use</span><span class="p">[</span><span class="n">p_av_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_quant_x</span><span class="p">):</span>
            <span class="n">eta_px0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">eta_use</span><span class="p">[</span><span class="n">p_x_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>

    <span class="c1"># Isolate x dependence into different terms</span>
    <span class="n">p_x_anom</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">-</span> <span class="n">p_av</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">eta_px0_anom</span> <span class="o">=</span> <span class="n">eta_px0</span> <span class="o">-</span> <span class="n">eta_av0</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">temp_ft_change</span> <span class="o">=</span> <span class="n">temp_ft_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_ft_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">temp_ft_av</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_ft_av</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">temp_ft_change_cont</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ft_dist&#39;</span><span class="p">:</span> <span class="n">temp_ft_p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_x_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">temp_ft_p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_x_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span>
                                      <span class="p">(</span><span class="n">temp_ft_p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_av_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">temp_ft_p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_av_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span>
                           <span class="s1">&#39;p_x&#39;</span><span class="p">:</span> <span class="n">eta_av0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_x_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_x_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="s1">&#39;eta0&#39;</span><span class="p">:</span> <span class="n">eta_px0_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_av</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_av</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="s1">&#39;eta0_p_x&#39;</span><span class="p">:</span> <span class="n">eta_px0_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_x_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_x_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="s1">&#39;eta_p_x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">eta_px0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eta_px0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span>
                                      <span class="p">(</span><span class="n">eta_av0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eta_av0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_av</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_av</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>

    <span class="c1"># Theory is sum of these terms</span>
    <span class="c1"># not exact because we approximate an integral by taking out assuming integrand constant.</span>
    <span class="n">temp_ft_change_theory</span> <span class="o">=</span> <span class="n">temp_ft_change_cont</span><span class="p">[</span><span class="s1">&#39;ft_dist&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp_ft_change_cont</span><span class="p">[</span><span class="s1">&#39;p_x&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">simple</span><span class="p">:</span>
        <span class="n">temp_ft_change_theory</span> <span class="o">=</span> <span class="n">temp_ft_change_theory</span> <span class="o">+</span> <span class="n">temp_ft_change_cont</span><span class="p">[</span><span class="s1">&#39;eta0&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="n">temp_ft_change_cont</span><span class="p">[</span><span class="s1">&#39;eta0_p_x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp_ft_change_cont</span><span class="p">[</span><span class="s1">&#39;eta_p_x&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">temp_ft_change</span><span class="p">,</span> <span class="n">temp_ft_change_theory</span><span class="p">,</span> <span class="n">temp_ft_change_cont</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_gamma_factors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_gamma_factors</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculates the sensitivity <span class="arithmatex">\(\gamma\)</span> parameters such that the theoretical scaling factor is given by:</p>
<div class="arithmatex">\[
\begin{align}
\begin{split}
&amp;\left(1 + \mu(x)\frac{\delta r_s(x)}{r_s(x)}\right)\frac{\delta T_s(x)}{\overline{\delta T_s}} \approx
1 + \overline{\mu} \frac{\delta \overline{r_s}}{\overline{r_s}} + \\
&amp;\left[\gamma_{T}\frac{\Delta T_s(x)}{\overline{T_s}} -
\gamma_{Tr}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
- \gamma_{r} \frac{\Delta r_s(x)}{\overline{r_s}}-
\gamma_{\epsilon} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\left(1 + \overline{\mu} \frac{\delta \overline{r_s}}{\overline{r_s}}\right) +\\
&amp;\left[-\gamma_{T\delta r}\frac{\Delta T_s(x)}{\overline{T_s}} +
\gamma_{Tr\delta r}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
+ \gamma_{r\delta r} \frac{\Delta r_s(x)}{\overline{r_s}}-
\gamma_{\epsilon \delta r} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\frac{\delta \overline{r_s}}{\delta \overline{T_s}} +\\
&amp;\left[-\gamma_{T\delta \epsilon}\frac{\Delta T_s(x)}{\overline{T_s}} -
\gamma_{Tr\delta \epsilon}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
- \gamma_{r\delta \epsilon} \frac{\Delta r_s(x)}{\overline{r_s}}+
\gamma_{\epsilon \delta \epsilon} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}} +\\
&amp;- \gamma_{\delta \Delta r} \frac{\delta \Delta r_s(x)}{\delta \overline{T_s}} -
\gamma_{T \delta \Delta r} \frac{\Delta T_s(x)}{\overline{T_s}}\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}
+ \gamma_{FT} \frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}} +     \gamma_{\delta \Delta \epsilon} \frac{\delta \Delta \epsilon(x)}{\delta \overline{T_s}}
\end{split}
\end{align}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature at <code>pressure_surf</code> in <em>K</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific humidity at <code>pressure_surf</code> in <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature at <code>pressure_ft</code> in <em>K</em>. Can also use adiabatic temperature here (computed from <code>temp_surf</code> and
<code>sphum</code>), if want <span class="arithmatex">\(\gamma\)</span> factors to be independent of free tropospheric temperature
(i.e. depend on two not three quantities).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface, <span class="arithmatex">\(p_s\)</span> in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level, <span class="arithmatex">\(p_{FT}\)</span> in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>gamma</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The theory (ignoring <span class="arithmatex">\(\mu\)</span> factors) is a sum of 16 terms. The first four <span class="arithmatex">\(\gamma\)</span> factors multiply
a climatological anomaly term (<span class="arithmatex">\(\Delta\)</span>) but not a change
(<span class="arithmatex">\(\delta\)</span>) term, these are recorded in <code>gamma['temp_mean_change']</code> with the keys
<code>t0</code>, <code>t0_r0</code>, <code>r0</code> and <code>e0</code>, They are all dimensionless.</p>
<p>The next four preceed <span class="arithmatex">\(\frac{\delta \overline{r_s}}{\delta \overline{T_s}}\)</span> as well as a <span class="arithmatex">\(\Delta\)</span> term.
These are recorded in <code>gamma['r_mean_change']</code>. Again they have keys <code>t0</code>, <code>t0_r0</code>, <code>r0</code> and <code>e0</code>.
These all have units of <span class="arithmatex">\(K\)</span>.</p>
<p>The next four preceed <span class="arithmatex">\(\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}\)</span>, as well as a <span class="arithmatex">\(\Delta\)</span>
term. These are recorded in <code>gamma['e_mean_change']</code>. Again they have keys <code>t0</code>, <code>t0_r0</code>, <code>r0</code> and <code>e0</code>.
These all have units of <span class="arithmatex">\(K kg J^{-1}\)</span>.</p>
<p>The final four all preceed <span class="arithmatex">\(\delta \Delta\)</span> quantities and are recorded in <code>gamma['anomaly_change']</code>.
They have keys <code>r</code>, <code>t0_r</code>, <code>ft</code> and <code>e</code>. They have units of <span class="arithmatex">\(K\)</span>, <span class="arithmatex">\(K\)</span>, dimensionless and  <span class="arithmatex">\(K kg J^{-1}\)</span>
respectively.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_gamma_factors</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sphum</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                      <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the sensitivity $\gamma$ parameters such that the theoretical scaling factor is given by:</span>

<span class="sd">    $$</span>
<span class="sd">    \\begin{align}</span>
<span class="sd">    \\begin{split}</span>
<span class="sd">    &amp;\\left(1 + \mu(x)\\frac{\delta r_s(x)}{r_s(x)}\\right)\\frac{\delta T_s(x)}{\overline{\delta T_s}} \\approx</span>
<span class="sd">    1 + \overline{\mu} \\frac{\delta \overline{r_s}}{\overline{r_s}} + \\\\</span>
<span class="sd">    &amp;\\left[\gamma_{T}\\frac{\Delta T_s(x)}{\overline{T_s}} -</span>
<span class="sd">    \gamma_{Tr}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    - \gamma_{r} \\frac{\Delta r_s(x)}{\overline{r_s}}-</span>
<span class="sd">    \gamma_{\epsilon} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\left(1 + \overline{\mu} \\frac{\delta \overline{r_s}}{\overline{r_s}}\\right) +\\\\</span>
<span class="sd">    &amp;\\left[-\gamma_{T\delta r}\\frac{\Delta T_s(x)}{\overline{T_s}} +</span>
<span class="sd">    \gamma_{Tr\delta r}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    + \gamma_{r\delta r} \\frac{\Delta r_s(x)}{\overline{r_s}}-</span>
<span class="sd">    \gamma_{\epsilon \delta r} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\frac{\delta \overline{r_s}}{\delta \overline{T_s}} +\\\\</span>
<span class="sd">    &amp;\\left[-\gamma_{T\delta \epsilon}\\frac{\Delta T_s(x)}{\overline{T_s}} -</span>
<span class="sd">    \gamma_{Tr\delta \epsilon}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    - \gamma_{r\delta \epsilon} \\frac{\Delta r_s(x)}{\overline{r_s}}+</span>
<span class="sd">    \gamma_{\epsilon \delta \epsilon} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}} +\\\\</span>
<span class="sd">    &amp;- \gamma_{\delta \Delta r} \\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}} -</span>
<span class="sd">    \gamma_{T \delta \Delta r} \\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}</span>
<span class="sd">    + \gamma_{FT} \\frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}} + \</span>
<span class="sd">    \gamma_{\delta \Delta \epsilon} \\frac{\delta \Delta \epsilon(x)}{\delta \overline{T_s}}</span>
<span class="sd">    \\end{split}</span>
<span class="sd">    \\end{align}</span>
<span class="sd">    $$</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf:</span>
<span class="sd">            Temperature at `pressure_surf` in *K*.</span>
<span class="sd">        sphum:</span>
<span class="sd">            Specific humidity at `pressure_surf` in *kg/kg*.</span>
<span class="sd">        temp_ft:</span>
<span class="sd">            Temperature at `pressure_ft` in *K*. Can also use adiabatic temperature here (computed from `temp_surf` and</span>
<span class="sd">            `sphum`), if want $\gamma$ factors to be independent of free tropospheric temperature</span>
<span class="sd">            (i.e. depend on two not three quantities).</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface, $p_s$ in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level, $p_{FT}$ in *Pa*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        gamma:</span>
<span class="sd">            The theory (ignoring $\mu$ factors) is a sum of 16 terms. The first four $\gamma$ factors multiply</span>
<span class="sd">            a climatological anomaly term ($\Delta$) but not a change</span>
<span class="sd">            ($\delta$) term, these are recorded in `gamma[&#39;temp_mean_change&#39;]` with the keys</span>
<span class="sd">            `t0`, `t0_r0`, `r0` and `e0`, They are all dimensionless.</span>

<span class="sd">            The next four preceed $\\frac{\delta \overline{r_s}}{\delta \overline{T_s}}$ as well as a $\Delta$ term.</span>
<span class="sd">            These are recorded in `gamma[&#39;r_mean_change&#39;]`. Again they have keys `t0`, `t0_r0`, `r0` and `e0`.</span>
<span class="sd">            These all have units of $K$.</span>

<span class="sd">            The next four preceed $\\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}$, as well as a $\Delta$</span>
<span class="sd">            term. These are recorded in `gamma[&#39;e_mean_change&#39;]`. Again they have keys `t0`, `t0_r0`, `r0` and `e0`.</span>
<span class="sd">            These all have units of $K kg J^{-1}$.</span>

<span class="sd">            The final four all preceed $\delta \Delta$ quantities and are recorded in `gamma[&#39;anomaly_change&#39;]`.</span>
<span class="sd">            They have keys `r`, `t0_r`, `ft` and `e`. They have units of $K$, $K$, dimensionless and  $K kg J^{-1}$</span>
<span class="sd">            respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get parameters required for prefactors in the theory</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">beta_ft1</span><span class="p">,</span> <span class="n">beta_ft2</span><span class="p">,</span> <span class="n">beta_ft3</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">q_sat_surf</span><span class="p">,</span> <span class="n">alpha_s</span><span class="p">,</span> <span class="n">beta_s1</span><span class="p">,</span> <span class="n">beta_s2</span><span class="p">,</span> <span class="n">beta_s3</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span>
                                                                                       <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">sphum</span><span class="p">)</span>
    <span class="n">rh</span> <span class="o">=</span> <span class="n">sphum</span> <span class="o">/</span> <span class="n">q_sat_surf</span>

    <span class="c1"># Record coefficients of each term in equation for delta T_s(x)</span>
    <span class="c1"># label is anomaly that causes variation with x.</span>

    <span class="n">gamma</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t_mean_change&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;r_mean_change&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;e_mean_change&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;anomaly_change&#39;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="c1"># temp_s_mean_change terms</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;t_mean_change&#39;</span>
    <span class="n">gamma_e0</span> <span class="o">=</span> <span class="n">beta_ft2</span> <span class="o">*</span> <span class="n">beta_s1</span> <span class="o">/</span> <span class="n">beta_ft1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">temp_surf</span> <span class="o">/</span> <span class="n">temp_ft</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e0</span> <span class="o">-</span> <span class="n">beta_s2</span> <span class="o">/</span> <span class="n">beta_s1</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0_r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_s2</span> <span class="o">/</span> <span class="n">beta_s1</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">gamma_e0</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gamma_e0</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha_s</span> <span class="o">*</span> <span class="n">temp_surf</span><span class="p">))</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e0</span>

    <span class="c1"># Anomaly change terms</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;anomaly_change&#39;</span>
    <span class="n">gamma_r_change</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">alpha_s</span> <span class="o">/</span> <span class="n">rh</span>
    <span class="n">gamma_e_change</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta_s1</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span> <span class="o">*</span> <span class="n">alpha_s</span> <span class="o">*</span> <span class="n">temp_surf</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ft&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_ft1</span> <span class="o">/</span> <span class="n">beta_s1</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e_change</span>

    <span class="c1"># r_s_mean change terms</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;r_mean_change&#39;</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span> <span class="o">*</span> <span class="n">gamma_e0</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_s</span> <span class="o">*</span> <span class="n">temp_surf</span> <span class="o">/</span> <span class="n">gamma_e0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0_r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span> <span class="o">*</span> <span class="n">gamma_e0</span> <span class="o">*</span> <span class="n">mu</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span> <span class="o">*</span> <span class="n">gamma_e0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha_s</span> <span class="o">*</span> <span class="n">temp_surf</span><span class="p">)</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_r_change</span> <span class="o">*</span> <span class="n">gamma_e0</span>

    <span class="c1"># epsilon mean change terms</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;e_mean_change&#39;</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e_change</span> <span class="o">*</span> <span class="n">gamma_e0</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;t0_r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e_change</span> <span class="o">*</span> <span class="n">gamma_e0</span> <span class="o">*</span> <span class="n">mu</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e_change</span> <span class="o">*</span> <span class="n">gamma_e0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha_s</span> <span class="o">*</span> <span class="n">temp_surf</span><span class="p">)</span>
    <span class="n">gamma</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_e_change</span> <span class="o">*</span> <span class="n">gamma_e0</span>
    <span class="k">return</span> <span class="n">gamma</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_p_x" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_p_x</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">temp_ft_p</span><span class="p">,</span> <span class="n">quant_p</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the quantile of <code>temp</code> in the <code>temp_ft_p</code> dataset, which is defined such that <code>temp_ft_p[i]</code> is
the <code>quant_p[i]</code><span class="arithmatex">\(^{th}\)</span> quantile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
Temperatures to find quantile for in <code>temp_ft_p</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_p</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant_p]</code></br>
Array of temperatures defined such that <code>temp_ft_p[i]</code> is the <code>quant_p[i]</code><span class="arithmatex">\(^{th}\)</span> quantile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quant_p</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant_p]</code></br>
Corresponding quantiles to <code>temp_ft_p</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>p_x</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
<code>p_x[i]</code> is the quantile of <code>temp[i]</code> in <code>temp_ft_p</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>p_x_ind</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>int [n_temp]</code></br>
<code>p_x_ind[i]</code> is the index of value in <code>quant_p</code> closest to <code>p_x[i]</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_p_x</span><span class="p">(</span><span class="n">temp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">temp_ft_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">quant_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the quantile of `temp` in the `temp_ft_p` dataset, which is defined such that `temp_ft_p[i]` is</span>
<span class="sd">    the `quant_p[i]`$^{th}$ quantile.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp: `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Temperatures to find quantile for in `temp_ft_p`.</span>
<span class="sd">        temp_ft_p: `float [n_quant_p]`&lt;/br&gt;</span>
<span class="sd">            Array of temperatures defined such that `temp_ft_p[i]` is the `quant_p[i]`$^{th}$ quantile.</span>
<span class="sd">        quant_p: `float [n_quant_p]`&lt;/br&gt;</span>
<span class="sd">            Corresponding quantiles to `temp_ft_p`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        p_x: `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            `p_x[i]` is the quantile of `temp[i]` in `temp_ft_p`.</span>
<span class="sd">        p_x_ind: `int [n_temp]`&lt;/br&gt;</span>
<span class="sd">            `p_x_ind[i]` is the index of value in `quant_p` closest to `p_x[i]`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">temp_ft_p</span><span class="p">,</span> <span class="n">quant_p</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="n">interp_func</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">p_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">quant_p</span> <span class="o">-</span> <span class="n">p_x</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">quant_p</span> <span class="o">-</span> <span class="n">p_x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p_x</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_scaling_factor_theory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scaling_factor_theory</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">,</span> <span class="n">temp_surf_quant</span><span class="p">,</span> <span class="n">sphum_mean</span><span class="p">,</span> <span class="n">sphum_quant</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">,</span> <span class="n">z_ft_mean</span><span class="p">,</span> <span class="n">z_ft_quant</span><span class="p">,</span> <span class="n">non_linear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">z_form</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_temp_adiabat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict_conv_eqb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculates the theoretical near-surface temperature change for percentile <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(\delta T_s(x)\)</span>, relative
to the mean temperature change, <span class="arithmatex">\(\overline{\delta T_s}\)</span>. In the most complicated case, with <code>non_linear = True</code>,
this is:</p>
<div class="arithmatex">\[
\begin{align}
\begin{split}
&amp;\left(1 + \mu(x)\frac{\delta r_s(x)}{r_s(x)}\right)\frac{\delta T_s(x)}{\overline{\delta T_s}} \approx
1 + \overline{\mu} \frac{\delta \overline{r_s}}{\overline{r_s}} + \\
&amp;\left[\gamma_{T}\frac{\Delta T_s(x)}{\overline{T_s}} -
\gamma_{Tr}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
- \gamma_{r} \frac{\Delta r_s(x)}{\overline{r_s}}-
\gamma_{\epsilon} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\left(1 + \overline{\mu} \frac{\delta \overline{r_s}}{\overline{r_s}}\right) +\\
&amp;\left[-\gamma_{T\delta r}\frac{\Delta T_s(x)}{\overline{T_s}} +
\gamma_{Tr\delta r}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
+ \gamma_{r\delta r} \frac{\Delta r_s(x)}{\overline{r_s}}-
\gamma_{\epsilon \delta r} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\frac{\delta \overline{r_s}}{\delta \overline{T_s}} +\\
&amp;\left[-\gamma_{T\delta \epsilon}\frac{\Delta T_s(x)}{\overline{T_s}} -
\gamma_{Tr\delta \epsilon}\frac{\Delta T_s(x)}{\overline{T_s}}\frac{\Delta r_s(x)}{\overline{r_s}}
- \gamma_{r\delta \epsilon} \frac{\Delta r_s(x)}{\overline{r_s}}+
\gamma_{\epsilon \delta \epsilon} \frac{\Delta \epsilon(x)}{\overline{\beta_{s1}}\overline{T_s}}\right]
\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}} +\\
&amp;- \gamma_{\delta \Delta r} \frac{\delta \Delta r_s(x)}{\delta \overline{T_s}} -
\gamma_{T \delta \Delta r} \frac{\Delta T_s(x)}{\overline{T_s}}\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}
+ \gamma_{FT} \frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}} +     \gamma_{\delta \Delta \epsilon} \frac{\delta \Delta \epsilon(x)}{\delta \overline{T_s}}
\end{split}
\end{align}
\]</div>
<p>If <code>z_form = True</code>, then all <span class="arithmatex">\(\gamma\)</span> and <span class="arithmatex">\(\mu\)</span> parameters are multiplied by
<span class="arithmatex">\(\frac{\overline{\beta_{s1}}}{\overline{\beta_{s1}} + \beta_{FT1}}\)</span>, and <span class="arithmatex">\(\delta \Delta T_{FT}(x)\)</span> is replaced
with <span class="arithmatex">\(\frac{g}{R^{\dagger}}\delta \Delta z_{FT}(x)\)</span>.</p>
<p>If <code>non_linear = False</code>, then <span class="arithmatex">\(\overline{\mu}\)</span> and <span class="arithmatex">\(\mu(x)\)</span> are set to zero.</p>
<p>If <code>use_temp_adiabat = True</code>, then the mean adiabatic temperature, <span class="arithmatex">\(\overline{T_A}\)</span>, is used in the computation of
the <span class="arithmatex">\(\gamma\)</span> parameters (and <span class="arithmatex">\(\beta_{FT1}\)</span> if <code>z_form=True</code>), rather than the mean free tropospheric temperature,
<span class="arithmatex">\(\overline{T_{FT}}\)</span> if it is <code>False</code>.</p>
<p>If <code>simple = True</code>, will return:</p>
<div class="arithmatex">\[
\begin{align}
\begin{split}
&amp;\left(1 + \mu(x)\frac{\delta r_s(x)}{r_s(x)}\right)\frac{\delta T_s(x)}{\overline{\delta T_s}}
\approx \\
&amp;\left(\gamma_{T}\frac{\Delta T_s(x)}{\overline{T_s}}
- \gamma_{r} \frac{\Delta r_s(x)}{\overline{r_s}} -
\gamma_{\delta \Delta r} \frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}
+ \gamma_{FT} \frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}}\right)
\left(1 + \overline{\mu} \frac{\delta \overline{r_s}}{\overline{r_s}}\right)
\end{split}
\end{align}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average (can use mean or median) near surface temperature of each simulation, corresponding to a different
optical depth, <span class="arithmatex">\(\kappa\)</span>. Units: <em>K</em>. We assume <code>n_exp=2</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>temp_surf_quant[i, j]</code> is the percentile <code>quant_use[j]</code> of near surface temperature of
experiment <code>i</code>. Units: <em>K</em>.</br>
Note that <code>quant_use</code> is not provided as not needed by this function, but is likely to be
<code>np.arange(1, 100)</code> - leave out <code>x=0</code> as doesn't really make sense to consider <span class="arithmatex">\(0^{th}\)</span> percentile
of a quantity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average near surface specific humidity of each simulation. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>sphum_quant[i, j]</code> is near-surface specific humidity, averaged over all days with near-surface temperature
 corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>temp_ft_quant[i, j]</code> is temperature at <code>pressure_ft</code>, averaged over all days with near-surface temperature
 corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_ft_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average geopotential height at <code>pressure_ft</code> in <em>m</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_ft_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>z_ft_quant[i, j]</code> is geopotential height at <code>pressure_ft</code>, averaged over all days with near-surface
temperature corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>m</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>non_linear</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, will also include <span class="arithmatex">\(\mu\delta r\)</span> terms in theory.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_form</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, will return <span class="arithmatex">\(z\)</span> version of theory.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_temp_adiabat</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, then the mean adiabatic temperature, <span class="arithmatex">\(\overline{T_A}\)</span>, is used in the computation
of the <span class="arithmatex">\(\gamma\)</span> parameters, rather than the mean free tropospheric temperature, <span class="arithmatex">\(\overline{T_{FT}}\)</span>
if it is <code>False</code>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strict_conv_eqb</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, will ignore all <span class="arithmatex">\(\epsilon\)</span> terms in theory</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simple</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, will exclude no-linear <span class="arithmatex">\(\Delta T_s \Delta r_s\)</span> and <span class="arithmatex">\(\Delta T_s \delta \Delta r_s\)</span> terms.
Will also exclude <span class="arithmatex">\(\frac{\delta \overline{r_s}}{\delta \overline{T_s}}\)</span> and
<span class="arithmatex">\(\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}\)</span> terms. Will not affect value of <span class="arithmatex">\(\mu\)</span> though.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>scaling_factor</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant]</code></br>
<code>scaling_factor[i]</code> refers to the theoretical temperature difference between experiments
for percentile <code>quant_use[i]</code>, relative to the mean temperature change, <span class="arithmatex">\(\delta \overline{T_s}\)</span>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_coef</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The linear theory is a sum of 16 terms. The first four don't have any change (<span class="arithmatex">\(\delta\)</span>)
factor, these are recorded in <code>info_coef['temp_mean_change']</code>.
The next four preceed <span class="arithmatex">\(\frac{\delta \overline{r_s}}{\delta \overline{T_s}}\)</span>, these are recorded in
<code>info_coef['r_mean_change']</code>.
The next four preceed <span class="arithmatex">\(\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}\)</span>, these are recorded in
<code>info_coef['e_mean_change']</code>.
The final four all preceed <span class="arithmatex">\(\delta \Delta\)</span> quantities and are recorded in <code>info_coef['anomaly_change']</code>.
<code>info_coef</code> is independent of the value of <code>non_linear</code> used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_change</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Complementary dictionary to <code>info_coef</code> with same keys that gives the relavent change to a
quantity i.e. <code>info_change['r_mean_change']</code> is <span class="arithmatex">\(\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}\)</span>.
<code>info_change['anomaly_change']</code> is a dictionary of the four <span class="arithmatex">\(\delta \Delta\)</span> changes.
If <code>non_linear = True</code>, each value in <code>info_change</code> is divided by
<span class="arithmatex">\(\left(1 + \mu(x)\frac{\delta r_s(x)}{r_s(x)}\right)\)</span>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_cont</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing same keys as <code>info_coef</code>. Each term is <code>info_coef</code> $   imes$ <code>info_change</code>
so it gives the contribution in <span class="arithmatex">\(K/K\)</span> to the scaling factor for each of the 16 terms.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>mu_factor</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_quant]</code></br>
The quantity <span class="arithmatex">\(1 + \mu(x)\frac{\delta r_s(x)}{r_s(x)}\)</span>. Will be 1 if <code>non_linear = False</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_scaling_factor_theory</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_surf_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sphum_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                              <span class="n">sphum_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                              <span class="n">temp_ft_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">z_ft_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                              <span class="n">z_ft_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">non_linear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">z_form</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">use_temp_adiabat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">strict_conv_eqb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">simple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the theoretical near-surface temperature change for percentile $x$, $\delta T_s(x)$, relative</span>
<span class="sd">    to the mean temperature change, $\overline{\delta T_s}$. In the most complicated case, with `non_linear = True`,</span>
<span class="sd">    this is:</span>

<span class="sd">    $$</span>
<span class="sd">    \\begin{align}</span>
<span class="sd">    \\begin{split}</span>
<span class="sd">    &amp;\\left(1 + \mu(x)\\frac{\delta r_s(x)}{r_s(x)}\\right)\\frac{\delta T_s(x)}{\overline{\delta T_s}} \\approx</span>
<span class="sd">    1 + \overline{\mu} \\frac{\delta \overline{r_s}}{\overline{r_s}} + \\\\</span>
<span class="sd">    &amp;\\left[\gamma_{T}\\frac{\Delta T_s(x)}{\overline{T_s}} -</span>
<span class="sd">    \gamma_{Tr}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    - \gamma_{r} \\frac{\Delta r_s(x)}{\overline{r_s}}-</span>
<span class="sd">    \gamma_{\epsilon} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\left(1 + \overline{\mu} \\frac{\delta \overline{r_s}}{\overline{r_s}}\\right) +\\\\</span>
<span class="sd">    &amp;\\left[-\gamma_{T\delta r}\\frac{\Delta T_s(x)}{\overline{T_s}} +</span>
<span class="sd">    \gamma_{Tr\delta r}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    + \gamma_{r\delta r} \\frac{\Delta r_s(x)}{\overline{r_s}}-</span>
<span class="sd">    \gamma_{\epsilon \delta r} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\frac{\delta \overline{r_s}}{\delta \overline{T_s}} +\\\\</span>
<span class="sd">    &amp;\\left[-\gamma_{T\delta \epsilon}\\frac{\Delta T_s(x)}{\overline{T_s}} -</span>
<span class="sd">    \gamma_{Tr\delta \epsilon}\\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\Delta r_s(x)}{\overline{r_s}}</span>
<span class="sd">    - \gamma_{r\delta \epsilon} \\frac{\Delta r_s(x)}{\overline{r_s}}+</span>
<span class="sd">    \gamma_{\epsilon \delta \epsilon} \\frac{\Delta \epsilon(x)}{\overline{\\beta_{s1}}\overline{T_s}}\\right]</span>
<span class="sd">    \\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}} +\\\\</span>
<span class="sd">    &amp;- \gamma_{\delta \Delta r} \\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}} -</span>
<span class="sd">    \gamma_{T \delta \Delta r} \\frac{\Delta T_s(x)}{\overline{T_s}}\\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}</span>
<span class="sd">    + \gamma_{FT} \\frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}} + \</span>
<span class="sd">    \gamma_{\delta \Delta \epsilon} \\frac{\delta \Delta \epsilon(x)}{\delta \overline{T_s}}</span>
<span class="sd">    \\end{split}</span>
<span class="sd">    \\end{align}</span>
<span class="sd">    $$</span>

<span class="sd">    If `z_form = True`, then all $\gamma$ and $\mu$ parameters are multiplied by</span>
<span class="sd">    $\\frac{\overline{\\beta_{s1}}}{\overline{\\beta_{s1}} + \\beta_{FT1}}$, and $\delta \Delta T_{FT}(x)$ is replaced</span>
<span class="sd">    with $\\frac{g}{R^{\dagger}}\delta \Delta z_{FT}(x)$.</span>

<span class="sd">    If `non_linear = False`, then $\overline{\mu}$ and $\mu(x)$ are set to zero.</span>

<span class="sd">    If `use_temp_adiabat = True`, then the mean adiabatic temperature, $\overline{T_A}$, is used in the computation of</span>
<span class="sd">    the $\gamma$ parameters (and $\\beta_{FT1}$ if `z_form=True`), rather than the mean free tropospheric temperature,</span>
<span class="sd">    $\overline{T_{FT}}$ if it is `False`.</span>

<span class="sd">    If `simple = True`, will return:</span>

<span class="sd">    $$</span>
<span class="sd">    \\begin{align}</span>
<span class="sd">    \\begin{split}</span>
<span class="sd">    &amp;\\left(1 + \mu(x)\\frac{\delta r_s(x)}{r_s(x)}\\right)\\frac{\delta T_s(x)}{\overline{\delta T_s}}</span>
<span class="sd">    \\approx \\\\</span>
<span class="sd">    &amp;\\left(\gamma_{T}\\frac{\Delta T_s(x)}{\overline{T_s}}</span>
<span class="sd">    - \gamma_{r} \\frac{\Delta r_s(x)}{\overline{r_s}} -</span>
<span class="sd">    \gamma_{\delta \Delta r} \\frac{\delta \Delta r_s(x)}{\delta \overline{T_s}}</span>
<span class="sd">    + \gamma_{FT} \\frac{\delta \Delta T_{FT}(x)}{\delta \overline{T_s}}\\right)</span>
<span class="sd">    \\left(1 + \overline{\mu} \\frac{\delta \overline{r_s}}{\overline{r_s}}\\right)</span>
<span class="sd">    \\end{split}</span>
<span class="sd">    \\end{align}</span>
<span class="sd">    $$</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average (can use mean or median) near surface temperature of each simulation, corresponding to a different</span>
<span class="sd">            optical depth, $\kappa$. Units: *K*. We assume `n_exp=2`.</span>
<span class="sd">        temp_surf_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `temp_surf_quant[i, j]` is the percentile `quant_use[j]` of near surface temperature of</span>
<span class="sd">            experiment `i`. Units: *K*.&lt;/br&gt;</span>
<span class="sd">            Note that `quant_use` is not provided as not needed by this function, but is likely to be</span>
<span class="sd">            `np.arange(1, 100)` - leave out `x=0` as doesn&#39;t really make sense to consider $0^{th}$ percentile</span>
<span class="sd">            of a quantity.</span>
<span class="sd">        sphum_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average near surface specific humidity of each simulation. Units: *kg/kg*.</span>
<span class="sd">        sphum_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `sphum_quant[i, j]` is near-surface specific humidity, averaged over all days with near-surface temperature</span>
<span class="sd">             corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *kg/kg*.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        temp_ft_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        temp_ft_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `temp_ft_quant[i, j]` is temperature at `pressure_ft`, averaged over all days with near-surface temperature</span>
<span class="sd">             corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *kg/kg*.</span>
<span class="sd">        z_ft_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average geopotential height at `pressure_ft` in *m*.</span>
<span class="sd">        z_ft_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `z_ft_quant[i, j]` is geopotential height at `pressure_ft`, averaged over all days with near-surface</span>
<span class="sd">            temperature corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *m*.</span>
<span class="sd">        non_linear: If `True`, will also include $\mu\delta r$ terms in theory.</span>
<span class="sd">        z_form: If `True`, will return $z$ version of theory.</span>
<span class="sd">        use_temp_adiabat: If `True`, then the mean adiabatic temperature, $\overline{T_A}$, is used in the computation</span>
<span class="sd">            of the $\gamma$ parameters, rather than the mean free tropospheric temperature, $\overline{T_{FT}}$</span>
<span class="sd">            if it is `False`.</span>
<span class="sd">        strict_conv_eqb: If `True`, will ignore all $\epsilon$ terms in theory</span>
<span class="sd">        simple: If `True`, will exclude no-linear $\Delta T_s \Delta r_s$ and $\Delta T_s \delta \Delta r_s$ terms.</span>
<span class="sd">            Will also exclude $\\frac{\delta \overline{r_s}}{\delta \overline{T_s}}$ and</span>
<span class="sd">            $\\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}$ terms. Will not affect value of $\mu$ though.</span>

<span class="sd">    Returns:</span>
<span class="sd">        scaling_factor: `float [n_quant]`&lt;/br&gt;</span>
<span class="sd">            `scaling_factor[i]` refers to the theoretical temperature difference between experiments</span>
<span class="sd">            for percentile `quant_use[i]`, relative to the mean temperature change, $\delta \overline{T_s}$.</span>
<span class="sd">        info_coef: The linear theory is a sum of 16 terms. The first four don&#39;t have any change ($\delta$)</span>
<span class="sd">            factor, these are recorded in `info_coef[&#39;temp_mean_change&#39;]`.</span>
<span class="sd">            The next four preceed $\\frac{\delta \overline{r_s}}{\delta \overline{T_s}}$, these are recorded in</span>
<span class="sd">            `info_coef[&#39;r_mean_change&#39;]`.</span>
<span class="sd">            The next four preceed $\\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}$, these are recorded in</span>
<span class="sd">            `info_coef[&#39;e_mean_change&#39;]`.</span>
<span class="sd">            The final four all preceed $\delta \Delta$ quantities and are recorded in `info_coef[&#39;anomaly_change&#39;]`.</span>
<span class="sd">            `info_coef` is independent of the value of `non_linear` used.</span>
<span class="sd">        info_change: Complementary dictionary to `info_coef` with same keys that gives the relavent change to a</span>
<span class="sd">            quantity i.e. `info_change[&#39;r_mean_change&#39;]` is $\\frac{\delta \overline{\epsilon}}{\delta \overline{T_s}}$.</span>
<span class="sd">            `info_change[&#39;anomaly_change&#39;]` is a dictionary of the four $\delta \Delta$ changes.</span>
<span class="sd">            If `non_linear = True`, each value in `info_change` is divided by</span>
<span class="sd">            $\\left(1 + \mu(x)\\frac{\delta r_s(x)}{r_s(x)}\\right)$.</span>
<span class="sd">        info_cont: Dictionary containing same keys as `info_coef`. Each term is `info_coef` $\times$ `info_change`</span>
<span class="sd">            so it gives the contribution in $K/K$ to the scaling factor for each of the 16 terms.</span>
<span class="sd">        mu_factor: `float` or `float [n_quant]`&lt;/br&gt;</span>
<span class="sd">            The quantity $1 + \mu(x)\\frac{\delta r_s(x)}{r_s(x)}$. Will be 1 if `non_linear = False`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute relative humidities</span>
    <span class="n">r_mean</span> <span class="o">=</span> <span class="n">sphum_mean</span> <span class="o">/</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">)</span>
    <span class="n">r_quant</span> <span class="o">=</span> <span class="n">sphum_quant</span> <span class="o">/</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf_quant</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">)</span>
    <span class="n">r_anom</span> <span class="o">=</span> <span class="n">r_quant</span> <span class="o">-</span> <span class="n">r_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># Compute epsilon</span>
    <span class="c1"># Quantify deviation from convective equilibrium in MSE space</span>
    <span class="n">epsilon_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">,</span> <span class="n">sphum_mean</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
                    <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">z_ft_mean</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">epsilon_quant</span> <span class="o">=</span> <span class="p">(</span><span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_surf_quant</span><span class="p">,</span> <span class="n">sphum_quant</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
                     <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft_quant</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft_quant</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">z_ft_quant</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">epsilon_anom</span> <span class="o">=</span> <span class="n">epsilon_quant</span> <span class="o">-</span> <span class="n">epsilon_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># Get factors needed for theory</span>
    <span class="k">if</span> <span class="n">use_temp_adiabat</span><span class="p">:</span>
        <span class="c1"># use adiabatic temperature for current climate to compute gamma params so only depends on surface quantities</span>
        <span class="n">temp_mean_ft_beta_use</span> <span class="o">=</span> <span class="n">get_temp_adiabat</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sphum_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_mean_ft_beta_use</span> <span class="o">=</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">get_gamma_factors</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sphum_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_mean_ft_beta_use</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_s</span><span class="p">,</span> <span class="n">beta_s1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span>
                                                                 <span class="n">sphum_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">non_linear</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_s_x</span><span class="p">,</span> <span class="n">beta_s1_x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_surf_quant</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span>
                                                                         <span class="n">sphum_quant</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mu_x</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">alpha_s_x</span> <span class="o">*</span> <span class="n">sphum_quant</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta_s1_x</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">alpha_s</span> <span class="o">*</span> <span class="n">sphum_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta_s1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mu_x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">z_form</span><span class="p">:</span>
        <span class="n">R_mod</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">beta_ft1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_mean_ft_beta_use</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>
        <span class="n">temp_ft_anom_change</span> <span class="o">=</span> <span class="n">g</span> <span class="o">/</span> <span class="n">R_mod</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_ft_quant</span> <span class="o">-</span> <span class="n">z_ft_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Need to multiply all mu and gamma factors by beta_s1/(beta_s1+beta_ft1) if z form of theory</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">beta_s1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta_s1</span> <span class="o">+</span> <span class="n">beta_ft1</span><span class="p">)</span>
        <span class="n">mu_x</span> <span class="o">=</span> <span class="n">mu_x</span> <span class="o">*</span> <span class="n">beta_s1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta_s1</span> <span class="o">+</span> <span class="n">beta_ft1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">]:</span>
                <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">beta_s1</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta_s1</span> <span class="o">+</span> <span class="n">beta_ft1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_ft_anom_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">temp_ft_quant</span> <span class="o">-</span> <span class="n">temp_ft_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mu_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">r_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mu_factor_x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">mu_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_quant</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_quant</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">r_quant</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">anom_norm0</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">temp_surf_quant</span> <span class="o">-</span> <span class="n">temp_surf_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="s1">&#39;r0&#39;</span><span class="p">:</span> <span class="n">r_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">r_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;e0&#39;</span><span class="p">:</span> <span class="n">epsilon_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta_s1</span> <span class="o">*</span> <span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
    <span class="n">anom_norm0</span><span class="p">[</span><span class="s1">&#39;t0_r0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anom_norm0</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">anom_norm0</span><span class="p">[</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span>

    <span class="c1"># Record the sign of each term, and also normalize relative humidity change terms by climatological mean</span>
    <span class="c1"># relative humidity</span>
    <span class="n">coef_sign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t_mean_change&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">key2</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;t0&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="s1">&#39;t_mean_change&#39;</span><span class="p">]},</span>
                 <span class="s1">&#39;r_mean_change&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">key2</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">key2</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
                                   <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="s1">&#39;r_mean_change&#39;</span><span class="p">]},</span>
                 <span class="s1">&#39;e_mean_change&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">key2</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;e0&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="s1">&#39;e_mean_change&#39;</span><span class="p">]},</span>
                 <span class="s1">&#39;anomaly_change&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">key2</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">key2</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="s1">&#39;anomaly_change&#39;</span><span class="p">]}}</span>

    <span class="c1"># Each term is a coefficient evaluated in the current climate, multiplied by a change between climates.</span>
    <span class="c1"># Record the climatological coefficient in info_coef</span>
    <span class="n">info_coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;anomaly&#39;</span> <span class="ow">in</span> <span class="n">key1</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;t0&#39;</span> <span class="ow">in</span> <span class="n">key2</span><span class="p">:</span>
                    <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef_sign</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">anom_norm0</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef_sign</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef_sign</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">anom_norm0</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">strict_conv_eqb</span><span class="p">:</span>
        <span class="c1"># Ignore effect of epsilon</span>
        <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;e_mean&#39;</span> <span class="ow">in</span> <span class="n">key1</span> <span class="ow">or</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span> <span class="ow">or</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;e0&#39;</span><span class="p">:</span>
                    <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;r_mean&#39;</span> <span class="ow">in</span> <span class="n">key1</span> <span class="ow">or</span> <span class="s1">&#39;e_mean&#39;</span> <span class="ow">in</span> <span class="n">key1</span><span class="p">:</span>
                    <span class="c1"># only keep temp mean changes</span>
                    <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="s1">&#39;t0_r&#39;</span> <span class="ow">in</span> <span class="n">key2</span><span class="p">:</span>
                    <span class="c1"># remove non-linear terms</span>
                    <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Record the change between climates in info_change</span>
    <span class="n">info_change</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t_mean_change&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">mu_factor</span><span class="p">,</span>
                   <span class="s1">&#39;r_mean_change&#39;</span><span class="p">:</span> <span class="n">r_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;e_mean_change&#39;</span><span class="p">:</span> <span class="n">epsilon_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;anomaly_change&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="s1">&#39;t0_r&#39;</span><span class="p">:</span> <span class="n">r_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="s1">&#39;ft&#39;</span><span class="p">:</span> <span class="n">temp_ft_anom_change</span><span class="p">,</span>
                                      <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="n">epsilon_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]}}</span>

    <span class="c1"># info_change - Normalise by mean temp change to get scale factor estimate</span>
    <span class="c1"># info_cont - Multiply coef by change to get overall contribution of each term</span>
    <span class="n">info_cont</span> <span class="o">=</span> <span class="p">{</span><span class="n">key1</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">key1</span><span class="p">:</span>
            <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">mu_factor_x</span>
        <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">[</span><span class="n">key1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">key1</span><span class="p">:</span>
                <span class="n">info_cont</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_surf_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                                                     <span class="p">)</span> <span class="o">/</span> <span class="n">mu_factor_x</span>
                <span class="n">info_cont</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">*</span> <span class="n">info_change</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span>

    <span class="n">final_answer</span> <span class="o">=</span> <span class="n">mu_factor</span> <span class="o">/</span> <span class="n">mu_factor_x</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">info_cont</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">info_coef</span><span class="p">[</span><span class="n">key1</span><span class="p">]])</span>
                                                  <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">info_coef</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">final_answer</span><span class="p">,</span> <span class="n">info_coef</span><span class="p">,</span> <span class="n">info_change</span><span class="p">,</span> <span class="n">info_cont</span><span class="p">,</span> <span class="n">mu_factor_x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_temp_adiabat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_adiabat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">guess_temp_adiabat</span><span class="o">=</span><span class="mi">273</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This returns the adiabatic temperature at <code>pressure_ft</code>, <span class="arithmatex">\(T_{A, FT}\)</span>, such that surface moist static
energy equals free troposphere saturated moist static energy
(plus any additional CAPE, quantified through <span class="arithmatex">\(\epsilon\)</span>):</p>
<p><span class="arithmatex">\(h(T_s, q_s, p_{FT}) = h^*(T_{A}, p_{FT}) + \epsilon\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature at <code>pressure_surf</code> in Kelvin. If array, must be same size as <code>sphum_surf</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific humidity at <code>pressure_surf</code> in <em>kg/kg</em>. If array, must be same size as <code>temp_surf</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>. Either single value or one for each <code>temp_surf</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>. Either single value or one for each <code>temp_surf</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guess_temp_adiabat</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial guess for what adiabatic temperature at <code>pressure_ft</code> should be.</p>
              </div>
            </td>
            <td>
                  <code>273</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(h_s-h^*_{FT}\)</span> in <em>kJ/kg</em>. Quantifies how much larger near-surface MSE is than free tropospheric saturated.
If array, must be same size as <code>temp_surf</code> and <code>sphum_surf</code>.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Adiabatic temperature at <code>pressure_ft</code> in Kelvin. If array, will be same size as <code>temp_surf</code> and <code>sphum_surf</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_adiabat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">sphum_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                     <span class="n">pressure_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                     <span class="n">guess_temp_adiabat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">273</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This returns the adiabatic temperature at `pressure_ft`, $T_{A, FT}$, such that surface moist static</span>
<span class="sd">    energy equals free troposphere saturated moist static energy</span>
<span class="sd">    (plus any additional CAPE, quantified through $\epsilon$):</span>

<span class="sd">    $h(T_s, q_s, p_{FT}) = h^*(T_{A}, p_{FT}) + \epsilon$.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf:</span>
<span class="sd">            Temperature at `pressure_surf` in Kelvin. If array, must be same size as `sphum_surf`</span>
<span class="sd">        sphum_surf:</span>
<span class="sd">            Specific humidity at `pressure_surf` in *kg/kg*. If array, must be same size as `temp_surf`</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*. Either single value or one for each `temp_surf`.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*. Either single value or one for each `temp_surf`.</span>
<span class="sd">        guess_temp_adiabat:</span>
<span class="sd">            Initial guess for what adiabatic temperature at `pressure_ft` should be.</span>
<span class="sd">        epsilon:</span>
<span class="sd">            $h_s-h^*_{FT}$ in *kJ/kg*. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</span>
<span class="sd">            If array, must be same size as `temp_surf` and `sphum_surf`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Adiabatic temperature at `pressure_ft` in Kelvin. If array, will be same size as `temp_surf` and `sphum_surf`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
        <span class="c1"># Need [0] to make it a float</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">temp_adiabat_fit_func</span><span class="p">,</span> <span class="n">guess_temp_adiabat</span><span class="p">,</span>
                                           <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">temp_adiabat_fit_func</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">guess_temp_adiabat</span><span class="p">),</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid value for `temp_surf`: must be float or np.ndarray&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_temp_adiabat_surf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_adiabat_surf</span><span class="p">(</span><span class="n">humidity_surf</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">rh_form</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">guess_temp_surf</span><span class="o">=</span><span class="mi">283</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This returns the temperature at <code>pressure_surf</code>, <span class="arithmatex">\(T_s\)</span>, such that near-surface moist static
energy equals free troposphere saturated moist static energy
(plus any additional CAPE quantified through <span class="arithmatex">\(\epsilon\)</span>):</p>
<p><span class="arithmatex">\(h(T_s, q_s, p_{FT}) = h^*(T_{FT}, p_{FT}) + \epsilon\)</span></p>
<p>given the near-surface specific humidity <span class="arithmatex">\(q_s\)</span> or relative humidity <span class="arithmatex">\(r_s\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>humidity_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific humidity in <em>kg/kg</em> or relative humidity at <code>pressure_surf</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_ft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geopotential height at <code>pressure_ft</code> in <em>m</em>. If <code>None</code> will approximate as
<span class="arithmatex">\(z_{FT} \approx \frac{R^{\dagger}}{g}(T_s + T_A)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_form</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code> (recommended), will return surface temperature for a given relative humidity.
Otherwise, will return for a given specific humidity.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guess_temp_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial guess for what adiabatic temperature at <code>pressure_surf</code> should be.</p>
              </div>
            </td>
            <td>
                  <code>283</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proxy for CAPE in <em>kJ/kg</em>. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convectively maintained temperature at <code>pressure_surf</code> in Kelvin.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_adiabat_surf</span><span class="p">(</span><span class="n">humidity_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                          <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rh_form</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">guess_temp_surf</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">283</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This returns the temperature at `pressure_surf`, $T_s$, such that near-surface moist static</span>
<span class="sd">    energy equals free troposphere saturated moist static energy</span>
<span class="sd">    (plus any additional CAPE quantified through $\epsilon$):</span>

<span class="sd">    $h(T_s, q_s, p_{FT}) = h^*(T_{FT}, p_{FT}) + \epsilon$</span>

<span class="sd">    given the near-surface specific humidity $q_s$ or relative humidity $r_s$.</span>

<span class="sd">    Args:</span>
<span class="sd">        humidity_surf:</span>
<span class="sd">            Specific humidity in *kg/kg* or relative humidity at `pressure_surf`.</span>
<span class="sd">        temp_ft:</span>
<span class="sd">            Temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        z_ft:</span>
<span class="sd">            Geopotential height at `pressure_ft` in *m*. If `None` will approximate as</span>
<span class="sd">            $z_{FT} \\approx \\frac{R^{\\dagger}}{g}(T_s + T_A)$.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        rh_form:</span>
<span class="sd">            If `True` (recommended), will return surface temperature for a given relative humidity.</span>
<span class="sd">            Otherwise, will return for a given specific humidity.</span>
<span class="sd">        guess_temp_surf:</span>
<span class="sd">            Initial guess for what adiabatic temperature at `pressure_surf` should be.</span>
<span class="sd">        epsilon:</span>
<span class="sd">            Proxy for CAPE in *kJ/kg*. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Convectively maintained temperature at `pressure_surf` in Kelvin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rh_form</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">solve_temp_adiabat</span><span class="p">(</span><span class="n">temp_guess</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">humidity_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">z_ft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Solve for surface temperature satisfying the adiabatic moist static energy balance.&quot;&quot;&quot;</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">temp_adiabat_surf_fit_func</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">temp_guess</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">humidity_surf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">solve_temp_adiabat_with_z</span><span class="p">(</span><span class="n">temp_guess</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">humidity_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                      <span class="n">z_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                      <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Solve for surface temperature satisfying the adiabatic moist static energy balance.&quot;&quot;&quot;</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">temp_adiabat_surf_fit_func</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">temp_guess</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">humidity_surf</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">T_solved</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span>
            <span class="n">solve_temp_adiabat</span> <span class="k">if</span> <span class="n">z_ft</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">solve_temp_adiabat_with_z</span><span class="p">,</span>
            <span class="n">guess_temp_surf</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">,</span> <span class="n">humidity_surf</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span>
            <span class="n">input_core_dims</span><span class="o">=</span><span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span>  <span class="c1"># all scalar-like per location</span>
            <span class="n">output_core_dims</span><span class="o">=</span><span class="p">[[]],</span>
            <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># broadcast over all non-core dims (lat, lon)</span>
            <span class="n">dask</span><span class="o">=</span><span class="s2">&quot;parallelized&quot;</span><span class="p">,</span>  <span class="c1"># if arrays are Dask-backed</span>
            <span class="n">output_dtypes</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">T_solved</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">z_ft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">R_mod</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pressure_surf</span> <span class="o">/</span> <span class="n">pressure_ft</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">mse_ft_sat</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                             <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">+</span> <span class="n">R_mod</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">mse_ft_sat</span> <span class="o">-</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">humidity_surf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c_p</span> <span class="o">-</span> <span class="n">R_mod</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mse_ft_sat</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">z_ft</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> \
                         <span class="n">epsilon</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">mse_ft_sat</span> <span class="o">-</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">humidity_surf</span><span class="p">)</span> <span class="o">/</span> <span class="n">c_p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_theory_prefactor_terms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">sphum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns prefactors to do modified moist static energy, <span class="arithmatex">\(\delta h^{\dagger}\)</span> taylor expansions.</p>
<p>Note units of returned variables are in <em>J</em> rather than <em>kJ</em> unlike most MSE stuff.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
Temperatures to compute prefactor terms for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface, <span class="arithmatex">\(p_s\)</span> in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level, <span class="arithmatex">\(p_{FT}\)</span> in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If given, will return surface prefactor terms, otherwise will return free troposphere values.</br>
<code>float</code> or <code>float [n_temp]</code></br>
Specific humidity corresponding to the temperature i.e. specific humidity conditioned on same
days as temperature given.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>R_mod</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modified gas constant, <span class="arithmatex">\(R^{\dagger} = R\ln(p_s/p_{FT})/2\)</span></br>
Units: <em>J/kg/K</em></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>q_sat</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
Saturated specific humidity. <span class="arithmatex">\(q^*(T, p_s)\)</span> if <code>sphum</code> given, otherwise <span class="arithmatex">\(q^*(T, p_{FT})\)</span></br>
Units: <em>kg/kg</em></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>alpha</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
Clausius clapeyron parameter. <span class="arithmatex">\(\alpha(T, p_s)\)</span> if <code>sphum</code> given, otherwise <span class="arithmatex">\(\alpha(T, p_{FT})\)</span></br>
Units: K<span class="arithmatex">\(^{-1}\)</span></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>beta_1</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
<span class="arithmatex">\(\frac{d(h^{\dagger}+\epsilon)}{dT_s}(T, p_s)\)</span> if <code>sphum</code> given, otherwise
<span class="arithmatex">\(\frac{h^{\dagger}}{dT_{FT}}(T, p_{FT})\)</span>.</br>
Units: <em>J/kg/K</em></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>beta_2</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
<span class="arithmatex">\(T_s\frac{d^2(h^{\dagger}+\epsilon)}{dT_s^2}(T, p_s)\)</span> if <code>sphum</code> given, otherwise
<span class="arithmatex">\(T_{FT}\frac{d^2h^{\dagger}}{dT_{FT}^2}(T, p_{FT})\)</span>.</br>
Units: <em>J/kg/K</em></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>beta_3</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
<span class="arithmatex">\(T_s^2\frac{d^3(h^{\dagger}+\epsilon)}{dT_s^3}(T, p_s)\)</span> if <code>sphum</code> given, otherwise
<span class="arithmatex">\(T_{FT}^2\frac{d^3h^{\dagger}}{dT_{FT}^3}(T, p_{FT})\)</span>.</br>
Units: <em>J/kg/K</em></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>mu</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_temp]</code></br>
<span class="arithmatex">\(\mu = 1 - \frac{c_p - R^{\dagger}}{c_p - R^{\dagger} + L_v \alpha_s q_s} =
\frac{L_v \alpha_s q_s}{\beta_{s1}}\)</span></br>
If <code>sphum</code> is not given, will set to <code>np.nan</code>.</br></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sphum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns prefactors to do modified moist static energy, $\delta h^{\dagger}$ taylor expansions.</span>

<span class="sd">    Note units of returned variables are in *J* rather than *kJ* unlike most MSE stuff.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Temperatures to compute prefactor terms for.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface, $p_s$ in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level, $p_{FT}$ in *Pa*.</span>
<span class="sd">        sphum: If given, will return surface prefactor terms, otherwise will return free troposphere values.&lt;/br&gt;</span>
<span class="sd">            `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Specific humidity corresponding to the temperature i.e. specific humidity conditioned on same</span>
<span class="sd">            days as temperature given.</span>

<span class="sd">    Returns:</span>
<span class="sd">        R_mod: Modified gas constant, $R^{\dagger} = R\\ln(p_s/p_{FT})/2$&lt;/br&gt;</span>
<span class="sd">            Units: *J/kg/K*</span>
<span class="sd">        q_sat: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Saturated specific humidity. $q^*(T, p_s)$ if `sphum` given, otherwise $q^*(T, p_{FT})$&lt;/br&gt;</span>
<span class="sd">            Units: *kg/kg*</span>
<span class="sd">        alpha: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Clausius clapeyron parameter. $\\alpha(T, p_s)$ if `sphum` given, otherwise $\\alpha(T, p_{FT})$&lt;/br&gt;</span>
<span class="sd">            Units: K$^{-1}$</span>
<span class="sd">        beta_1: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            $\\frac{d(h^{\\dagger}+\epsilon)}{dT_s}(T, p_s)$ if `sphum` given, otherwise</span>
<span class="sd">            $\\frac{h^{\\dagger}}{dT_{FT}}(T, p_{FT})$.&lt;/br&gt;</span>
<span class="sd">            Units: *J/kg/K*</span>
<span class="sd">        beta_2: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            $T_s\\frac{d^2(h^{\\dagger}+\epsilon)}{dT_s^2}(T, p_s)$ if `sphum` given, otherwise</span>
<span class="sd">            $T_{FT}\\frac{d^2h^{\\dagger}}{dT_{FT}^2}(T, p_{FT})$.&lt;/br&gt;</span>
<span class="sd">            Units: *J/kg/K*</span>
<span class="sd">        beta_3: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            $T_s^2\\frac{d^3(h^{\\dagger}+\epsilon)}{dT_s^3}(T, p_s)$ if `sphum` given, otherwise</span>
<span class="sd">            $T_{FT}^2\\frac{d^3h^{\\dagger}}{dT_{FT}^3}(T, p_{FT})$.&lt;/br&gt;</span>
<span class="sd">            Units: *J/kg/K*</span>
<span class="sd">        mu: `float` or `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            $\\mu = 1 - \\frac{c_p - R^{\\dagger}}{c_p - R^{\\dagger} + L_v \\alpha_s q_s} =</span>
<span class="sd">            \\frac{L_v \\alpha_s q_s}{\\beta_{s1}}$&lt;/br&gt;</span>
<span class="sd">            If `sphum` is not given, will set to `np.nan`.&lt;/br&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R_mod</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pressure_surf</span> <span class="o">/</span> <span class="n">pressure_ft</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">sphum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># if sphum not given, then free troposphere used</span>
        <span class="n">c_p_use</span> <span class="o">=</span> <span class="n">c_p</span> <span class="o">+</span> <span class="n">R_mod</span>
        <span class="n">pressure_use</span> <span class="o">=</span> <span class="n">pressure_ft</span>
        <span class="n">sphum</span> <span class="o">=</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">pressure_use</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">sphum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_p_use</span> <span class="o">=</span> <span class="n">c_p</span> <span class="o">-</span> <span class="n">R_mod</span>
        <span class="n">pressure_use</span> <span class="o">=</span> <span class="n">pressure_surf</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># set so compute later</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">clausius_clapeyron_factor</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">pressure_use</span><span class="p">)</span>
    <span class="n">beta_1</span> <span class="o">=</span> <span class="n">c_p_use</span> <span class="o">+</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">sphum</span>
    <span class="n">beta_2</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">sphum</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">beta_3</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">sphum</span> <span class="o">*</span> <span class="p">((</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">q_sat</span> <span class="o">=</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">pressure_use</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">sphum</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">beta_1</span>
    <span class="k">return</span> <span class="n">R_mod</span><span class="p">,</span> <span class="n">q_sat</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta_1</span><span class="p">,</span> <span class="n">beta_2</span><span class="p">,</span> <span class="n">beta_3</span><span class="p">,</span> <span class="n">mu</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.get_z_ft_approx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_z_ft_approx</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">z_surf</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns an approximation for geopotential height, <span class="arithmatex">\(z_{FT}\)</span> at pressure <span class="arithmatex">\(p_{FT}\)</span> according to:</p>
<div class="arithmatex">\[z_{FT} \approx \frac{R^{\dagger}}{g}(T_s + T_{FT}) + z_s\]</div>
<p>where <span class="arithmatex">\(R^{\dagger} = \ln(p_s/p_{FT})/2\)</span> and <span class="arithmatex">\(s\)</span> refers to the surface. This assumes hydrostatic balance
and fixed lapse rate between the surface and <span class="arithmatex">\(p_{FT}\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
Temperature at <code>pressure_surf</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
Temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_surf</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
Geopotential height at <code>pressure_surf</code> in <em>m</em>. Can also give <code>0</code> to ignore this contribution.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_temp]</code></br>
Geopotential height at <code>pressure_ft</code> in <em>m</em>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_z_ft_approx</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                    <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">z_surf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an approximation for geopotential height, $z_{FT}$ at pressure $p_{FT}$ according to:</span>

<span class="sd">    $$z_{FT} \\approx \\frac{R^{\\dagger}}{g}(T_s + T_{FT}) + z_s$$</span>

<span class="sd">    where $R^{\dagger} = \\ln(p_s/p_{FT})/2$ and $s$ refers to the surface. This assumes hydrostatic balance</span>
<span class="sd">    and fixed lapse rate between the surface and $p_{FT}$.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Temperature at `pressure_surf` in Kelvin.</span>
<span class="sd">        temp_ft: `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        z_surf: `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Geopotential height at `pressure_surf` in *m*. Can also give `0` to ignore this contribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `float [n_temp]`&lt;/br&gt;</span>
<span class="sd">            Geopotential height at `pressure_ft` in *m*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R_mod</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pressure_surf</span> <span class="o">/</span> <span class="n">pressure_ft</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">R_mod</span> <span class="o">/</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_surf</span> <span class="o">+</span> <span class="n">temp_ft</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_surf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.mse_mod_anom_change_ft_expansion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mse_mod_anom_change_ft_expansion</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">taylor_terms</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">mse_mod_mean_change</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_ft_anom0</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function returns an approximation in the change in modified MSE anomaly,
<span class="arithmatex">\(\delta \Delta h^{\dagger} = \delta (h^{\dagger}(x) - \overline{h^{\dagger}})\)</span>, with warming -
the basis of a theory for <span class="arithmatex">\(\delta T_s(x)\)</span>.</p>
<p>Doing a second order taylor expansion of <span class="arithmatex">\(h^{\dagger}\)</span> in the base climate,
about free tropospheric temperature <span class="arithmatex">\(\overline{T_{FT}}\)</span>, we can get:</p>
<div class="arithmatex">\[\Delta h^{\dagger}(x) \approx \beta_{FT1} \Delta T_{FT} + \frac{1}{2\overline{T_{FT}}}
\beta_{FT2} \Delta T_{FT}^2\]</div>


<details class="terms-in-equation" open>
  <summary>Terms in equation</summary>
  <ul>
<li><span class="arithmatex">\(h^{\dagger} = h^*_{FT} - R^{\dagger}T_s - gz_s \approx \left(c_p + R^{\dagger}\right) T_{FT} + L_v q^*_{FT}\)</span>
where we used an approximate relation to replace <span class="arithmatex">\(z_{FT}\)</span> in <span class="arithmatex">\(h^*_{FT}\)</span>.</li>
<li><span class="arithmatex">\(R^{\dagger} = R\ln(p_s/p_{FT})/2\)</span></li>
<li><span class="arithmatex">\(\Delta T_{FT} = T_{FT}(x) - \overline{T_{FT}}\)</span></li>
<li><span class="arithmatex">\(\beta_{FT1} = \frac{d\overline{h^{\dagger}}}{d\overline{T_{FT}}} =
c_p + R^{\dagger} + L_v \alpha_{FT} q_{FT}^*\)</span></li>
<li><span class="arithmatex">\(\beta_{FT2} = \overline{T_{FT}} \frac{d^2\overline{h^{\dagger}}}{d\overline{T_{FT}}^2} =
 \overline{T_{FT}}\frac{d\beta_{FT1}}{d\overline{T_{FT}}} =
 L_v \alpha_{FT} q_{FT}^*(\alpha_{FT} \overline{T_{FT}} - 2)\)</span></li>
<li>All terms on RHS are evaluated at the free tropospheric adiabatic temperature, <span class="arithmatex">\(T_{FT}\)</span>. I.e.
<span class="arithmatex">\(q_{FT}^* = q^*(T_{FT}, p_{FT})\)</span> where <span class="arithmatex">\(p_{FT}\)</span> is the free tropospheric pressure.</li>
</ul>
</details>        <p>Doing a second taylor expansion on this equation for a change with warming between simulations, <span class="arithmatex">\(\delta\)</span>, we can
decompose <span class="arithmatex">\(\delta \Delta h^{\dagger}(x)\)</span> into terms involving <span class="arithmatex">\(\delta \Delta T_{FT}\)</span> and
<span class="arithmatex">\(\delta \overline{T_{FT}}\)</span></p>
<p>We can then use a third taylor expansion to relate <span class="arithmatex">\(\delta \overline{T_{FT}}\)</span> to <span class="arithmatex">\(\delta \overline{h^{\dagger}}\)</span>:</p>
<div class="arithmatex">\[\delta \overline{T_{FT}} \approx \frac{\delta \overline{h^{\dagger}}}{\beta_{FT1}} -
\frac{1}{2} \frac{\beta_{FT2}}{\beta_{FT1}^3 \overline{T_{FT}}} (\delta \overline{h^{\dagger}})^2\]</div>
<p>Overall, we get <span class="arithmatex">\(\delta \Delta h^{\dagger}\)</span> as a function of <span class="arithmatex">\(\delta \Delta T_{FT}\)</span>,
<span class="arithmatex">\(\delta \overline{h^{\dagger}}\)</span> and quantities evaluated at the base climate.
The <code>taylor_terms</code> variable can be used to specify how many terms we want to keep.</p>
<p>The simplest equation with <code>taylor_terms = 'linear'</code> is:</p>
<div class="arithmatex">\[\delta \Delta h^{\dagger} \approx \beta_{FT1} \delta \Delta T_{FT} +
\frac{\beta_{FT2}}{\beta_{FT1}}\frac{\Delta T_{FT}}{\overline{T_{FT}}} \delta \overline{h^{\dagger}}\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_mean</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Average free tropospheric temperature of each simulation, corresponding to a different
optical depth, <span class="arithmatex">\(\kappa\)</span>. Units: <em>K</em>. We assume <code>n_exp=2</code>.
Could also use adiabatic temperature, <span class="arithmatex">\(\overline{T_A}\)</span>, instead if want to assume
strict convective equilibrium.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_quant</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp, n_quant]</code></br>
<code>temp_ft_quant[i, j]</code> is free tropospheric temperature, averaged over all days with near-surface temperature
corresponding to the quantile <code>quant_use[j]</code>, for experiment <code>i</code>. Units: <em>K</em>.</br>
Note that <code>quant_use</code> is not provided as not needed by this function, but is likely to be
<code>np.arange(1, 100)</code> - leave out <code>x=0</code> as doesn't really make sense to consider <span class="arithmatex">\(0^{th}\)</span> percentile
of a quantity.
Could also use adiabatic temperature, <span class="arithmatex">\(T_A(x)\)</span>, instead if want to assume
strict convective equilibrium.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taylor_terms</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The approximations in this equation arise from the three taylor series mentioned above, we can specify
how many terms we want to keep, with one of the 3 options below:</p>
<ul>
<li><code>linear</code>: Only keep the two terms which are linear in all three taylor series i.e.
<span class="arithmatex">\(\delta \Delta h^{\dagger} \approx \beta_{FT1} \delta \Delta T_{FT} +
\frac{\beta_{FT2}}{\beta_{FT1}}\frac{\Delta T_{FT}}{\overline{T_{FT}}}
\delta \overline{h^{\dagger}}\)</span></li>
<li><code>non_linear</code>: Keep <em>LL</em>, <em>LLL</em> and <em>LNL</em> terms.</li>
<li><code>squared_0</code>: Keep terms linear and squared in first expansion and then just linear terms:
<em>LL</em>, <em>LLL</em>, <em>SL</em>, <em>SLL</em>.</li>
<li><code>squared</code>: Keep four additional terms corresponding to <em>LLS</em>, <em>LSL</em>, <em>LNL</em> and <em>SNL</em> terms in the
taylor series. SNL means second order in the first taylor series mentioned above, non-linear
(i.e. <span class="arithmatex">\(\delta \Delta T_{FT}\delta \overline{h^{\dagger}}\)</span> terms)  in the second
and linear in the third. These 5 terms are the most significant non-linear terms.</li>
<li><code>full</code>: In addition to the terms in <code>squared</code>, we keep the usually small <em>LSS</em> and <em>SLS</em> terms.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mse_mod_mean_change</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code></br>
Can provide the <span class="arithmatex">\(\delta \overline{h^{\dagger}}\)</span> in J/kg. Use this if you want to use a particular taylor
approximation for this.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_anom0</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant]</code></br>
Can specify the <span class="arithmatex">\(\Delta T_{FT}\)</span> term to use in the equation. May want to do this, if want to
relate <span class="arithmatex">\(\Delta T_{FT}\)</span> to surface quantities assuming strict convective equilibrium.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>delta_mse_mod_anomaly</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_quant]</code></br>
<span class="arithmatex">\(\delta \Delta h^{\dagger}\)</span> conditioned on each quantile of near-surface temperature. Units: <em>kJ/kg</em>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with 5 keys: <code>temp_ft_anom</code>, <code>mse_mod_mean</code>, <code>mse_mod_mean_squared</code>,
<code>mse_mod_mean_cubed</code>, <code>non_linear</code>.</br>
For each key, a list containing a prefactor computed in the base climate and a change between simulations is
returned. I.e. for <code>info_dict[non_linear][1]</code> would be
<span class="arithmatex">\(\delta \Delta T_{FT}\delta \overline{h^{\dagger}}\)</span>
and the total contribution of non-linear terms to <span class="arithmatex">\(\delta \Delta h^{\dagger}\)</span> would be
<code>info_dict[non_linear][0] * info_dict[non_linear][1]</code>. In the <code>linear</code> case this would be zero,
and <code>info_dict[temp_ft_anom][0]</code><span class="arithmatex">\(=\beta_{FT1}\)</span> and <code>info_dict[mse_mod_mean][0]</code><span class="arithmatex">\(=
\frac{\beta_{FT2}}{\beta_{FT1}}\frac{\Delta T_A}{\overline{T_{FT}}}\)</span> would be the only non-zero
prefactors.
Units of prefactor multiplied by change is <em>kJ/kg</em>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mse_mod_anom_change_ft_expansion</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">temp_ft_quant</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                     <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                     <span class="n">taylor_terms</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">mse_mod_mean_change</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">temp_ft_anom0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns an approximation in the change in modified MSE anomaly,</span>
<span class="sd">    $\delta \Delta h^{\dagger} = \delta (h^{\dagger}(x) - \overline{h^{\dagger}})$, with warming -</span>
<span class="sd">    the basis of a theory for $\delta T_s(x)$.</span>

<span class="sd">    Doing a second order taylor expansion of $h^{\dagger}$ in the base climate,</span>
<span class="sd">    about free tropospheric temperature $\overline{T_{FT}}$, we can get:</span>

<span class="sd">    $$\\Delta h^{\\dagger}(x) \\approx \\beta_{FT1} \\Delta T_{FT} + \\frac{1}{2\\overline{T_{FT}}}</span>
<span class="sd">    \\beta_{FT2} \\Delta T_{FT}^2$$</span>

<span class="sd">    Terms in equation:</span>
<span class="sd">        * $h^{\dagger} = h^*_{FT} - R^{\dagger}T_s - gz_s \\approx \\left(c_p + R^{\dagger}\\right) T_{FT} + L_v q^*_{FT}$</span>
<span class="sd">        where we used an approximate relation to replace $z_{FT}$ in $h^*_{FT}$.</span>
<span class="sd">        * $R^{\dagger} = R\\ln(p_s/p_{FT})/2$</span>
<span class="sd">        * $\\Delta T_{FT} = T_{FT}(x) - \overline{T_{FT}}$</span>
<span class="sd">        * $\\beta_{FT1} = \\frac{d\\overline{h^{\\dagger}}}{d\overline{T_{FT}}} =</span>
<span class="sd">        c_p + R^{\dagger} + L_v \\alpha_{FT} q_{FT}^*$</span>
<span class="sd">        * $\\beta_{FT2} = \overline{T_{FT}} \\frac{d^2\\overline{h^{\\dagger}}}{d\overline{T_{FT}}^2} =</span>
<span class="sd">         \overline{T_{FT}}\\frac{d\\beta_{FT1}}{d\overline{T_{FT}}} =</span>
<span class="sd">         L_v \\alpha_{FT} q_{FT}^*(\\alpha_{FT} \\overline{T_{FT}} - 2)$</span>
<span class="sd">        * All terms on RHS are evaluated at the free tropospheric adiabatic temperature, $T_{FT}$. I.e.</span>
<span class="sd">        $q_{FT}^* = q^*(T_{FT}, p_{FT})$ where $p_{FT}$ is the free tropospheric pressure.</span>

<span class="sd">    Doing a second taylor expansion on this equation for a change with warming between simulations, $\delta$, we can</span>
<span class="sd">    decompose $\delta \\Delta h^{\\dagger}(x)$ into terms involving $\delta \Delta T_{FT}$ and</span>
<span class="sd">    $\delta \overline{T_{FT}}$</span>

<span class="sd">    We can then use a third taylor expansion to relate $\delta \overline{T_{FT}}$ to $\delta \overline{h^{\\dagger}}$:</span>

<span class="sd">    $$\\delta \\overline{T_{FT}} \\approx \\frac{\\delta \\overline{h^{\\dagger}}}{\\beta_{FT1}} -</span>
<span class="sd">    \\frac{1}{2} \\frac{\\beta_{FT2}}{\\beta_{FT1}^3 \\overline{T_{FT}}} (\\delta \\overline{h^{\\dagger}})^2$$</span>

<span class="sd">    Overall, we get $\delta \Delta h^{\dagger}$ as a function of $\delta \Delta T_{FT}$,</span>
<span class="sd">    $\delta \overline{h^{\\dagger}}$ and quantities evaluated at the base climate.</span>
<span class="sd">    The `taylor_terms` variable can be used to specify how many terms we want to keep.</span>

<span class="sd">    The simplest equation with `taylor_terms = &#39;linear&#39;` is:</span>

<span class="sd">    $$\\delta \\Delta h^{\\dagger} \\approx \\beta_{FT1} \\delta \\Delta T_{FT} +</span>
<span class="sd">    \\frac{\\beta_{FT2}}{\\beta_{FT1}}\\frac{\\Delta T_{FT}}{\\overline{T_{FT}}} \\delta \\overline{h^{\\dagger}}$$</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_ft_mean: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Average free tropospheric temperature of each simulation, corresponding to a different</span>
<span class="sd">            optical depth, $\kappa$. Units: *K*. We assume `n_exp=2`.</span>
<span class="sd">            Could also use adiabatic temperature, $\overline{T_A}$, instead if want to assume</span>
<span class="sd">            strict convective equilibrium.</span>
<span class="sd">        temp_ft_quant: `float [n_exp, n_quant]`&lt;/br&gt;</span>
<span class="sd">            `temp_ft_quant[i, j]` is free tropospheric temperature, averaged over all days with near-surface temperature</span>
<span class="sd">            corresponding to the quantile `quant_use[j]`, for experiment `i`. Units: *K*.&lt;/br&gt;</span>
<span class="sd">            Note that `quant_use` is not provided as not needed by this function, but is likely to be</span>
<span class="sd">            `np.arange(1, 100)` - leave out `x=0` as doesn&#39;t really make sense to consider $0^{th}$ percentile</span>
<span class="sd">            of a quantity.</span>
<span class="sd">            Could also use adiabatic temperature, $T_A(x)$, instead if want to assume</span>
<span class="sd">            strict convective equilibrium.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        taylor_terms:</span>
<span class="sd">            The approximations in this equation arise from the three taylor series mentioned above, we can specify</span>
<span class="sd">            how many terms we want to keep, with one of the 3 options below:</span>

<span class="sd">            * `linear`: Only keep the two terms which are linear in all three taylor series i.e.</span>
<span class="sd">            $\\delta \\Delta h^{\\dagger} \\approx \\beta_{FT1} \\delta \\Delta T_{FT} +</span>
<span class="sd">            \\frac{\\beta_{FT2}}{\\beta_{FT1}}\\frac{\\Delta T_{FT}}{\\overline{T_{FT}}}</span>
<span class="sd">            \\delta \\overline{h^{\\dagger}}$</span>
<span class="sd">            * `non_linear`: Keep *LL*, *LLL* and *LNL* terms.</span>
<span class="sd">            * `squared_0`: Keep terms linear and squared in first expansion and then just linear terms:</span>
<span class="sd">            *LL*, *LLL*, *SL*, *SLL*.</span>
<span class="sd">            * `squared`: Keep four additional terms corresponding to *LLS*, *LSL*, *LNL* and *SNL* terms in the</span>
<span class="sd">            taylor series. SNL means second order in the first taylor series mentioned above, non-linear</span>
<span class="sd">            (i.e. $\\delta \\Delta T_{FT}\\delta \\overline{h^{\\dagger}}$ terms)  in the second</span>
<span class="sd">            and linear in the third. These 5 terms are the most significant non-linear terms.</span>
<span class="sd">            * `full`: In addition to the terms in `squared`, we keep the usually small *LSS* and *SLS* terms.</span>
<span class="sd">        mse_mod_mean_change: `float [n_exp]`&lt;/br&gt;</span>
<span class="sd">            Can provide the $\\delta \\overline{h^{\\dagger}}$ in J/kg. Use this if you want to use a particular taylor</span>
<span class="sd">            approximation for this.</span>
<span class="sd">        temp_ft_anom0: `float [n_quant]`&lt;/br&gt;</span>
<span class="sd">            Can specify the $\Delta T_{FT}$ term to use in the equation. May want to do this, if want to</span>
<span class="sd">            relate $\Delta T_{FT}$ to surface quantities assuming strict convective equilibrium.</span>

<span class="sd">    Returns:</span>
<span class="sd">        delta_mse_mod_anomaly: `float [n_quant]`&lt;/br&gt;</span>
<span class="sd">            $\delta \Delta h^{\dagger}$ conditioned on each quantile of near-surface temperature. Units: *kJ/kg*.</span>
<span class="sd">        info_dict: Dictionary with 5 keys: `temp_ft_anom`, `mse_mod_mean`, `mse_mod_mean_squared`,</span>
<span class="sd">            `mse_mod_mean_cubed`, `non_linear`.&lt;/br&gt;</span>
<span class="sd">            For each key, a list containing a prefactor computed in the base climate and a change between simulations is</span>
<span class="sd">            returned. I.e. for `info_dict[non_linear][1]` would be</span>
<span class="sd">            $\\delta \\Delta T_{FT}\\delta \\overline{h^{\\dagger}}$</span>
<span class="sd">            and the total contribution of non-linear terms to $\delta \Delta h^{\dagger}$ would be</span>
<span class="sd">            `info_dict[non_linear][0] * info_dict[non_linear][1]`. In the `linear` case this would be zero,</span>
<span class="sd">            and `info_dict[temp_ft_anom][0]`$=\\beta_{FT1}$ and `info_dict[mse_mod_mean][0]`$=</span>
<span class="sd">            \\frac{\\beta_{FT2}}{\\beta_{FT1}}\\frac{\\Delta T_A}{\\overline{T_{FT}}}$ would be the only non-zero</span>
<span class="sd">            prefactors.</span>
<span class="sd">            Units of prefactor multiplied by change is *kJ/kg*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_ft_anom</span> <span class="o">=</span> <span class="n">temp_ft_quant</span> <span class="o">-</span> <span class="n">temp_ft_mean</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">delta_temp_ft_anom</span> <span class="o">=</span> <span class="n">temp_ft_anom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_ft_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">temp_ft_anom0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">temp_ft_anom0</span> <span class="o">=</span> <span class="n">temp_ft_anom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Parameters needed for taylor expansions - most compute using adiabatic temperature in free troposphere.</span>
    <span class="n">R_mod</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">beta_1</span><span class="p">,</span> <span class="n">beta_2</span><span class="p">,</span> <span class="n">beta_3</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">)</span>

    <span class="c1"># Compute modified MSE - need in units of J/kg at the moment hence multiply by 1000</span>
    <span class="k">if</span> <span class="n">mse_mod_mean_change</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mse_mod_mean</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft_mean</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                           <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">+</span> <span class="n">R_mod</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="n">mse_mod_mean_change</span> <span class="o">=</span> <span class="n">mse_mod_mean</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mse_mod_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Decompose Taylor Expansions - 3 in total</span>
    <span class="c1"># l means linear, s means squared and n means non-linear</span>
    <span class="c1"># first index is for Delta expansion i.e. base climate - quantile about mean</span>
    <span class="c1"># second index is for delta expansion i.e. difference between climates</span>
    <span class="c1"># third index is for conversion between delta_temp_adiabat_mean and delta_mse_mod_mean</span>
    <span class="c1"># I neglect all terms that are more than squared in two or more of these taylor expansions</span>
    <span class="k">if</span> <span class="n">taylor_terms</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;non_linear&#39;</span><span class="p">,</span> <span class="s1">&#39;squared_0&#39;</span><span class="p">,</span> <span class="s1">&#39;squared&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;taylor_terms given is </span><span class="si">{</span><span class="n">taylor_terms</span><span class="si">}</span><span class="s1">, but must be linear, squared_0, squared or full.&#39;</span><span class="p">)</span>

    <span class="n">term_ll</span> <span class="o">=</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span>
    <span class="n">term_lll</span> <span class="o">=</span> <span class="n">beta_2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
    <span class="k">if</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;squared_0&#39;</span><span class="p">:</span>
        <span class="c1"># term_sl = beta_2 * temp_adiabat_anom[0] / temp_adiabat_mean[0] * delta_temp_adiabat_anom</span>
        <span class="n">term_sl</span> <span class="o">=</span> <span class="n">beta_2</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span>
        <span class="n">term_sll</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_3</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
        <span class="n">term_lls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_lsl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_lnl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_snl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="s1">&#39;linear&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taylor_terms</span><span class="p">:</span>
        <span class="n">term_sl</span> <span class="o">=</span> <span class="n">beta_2</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span>
        <span class="n">term_sll</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_3</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
        <span class="n">term_lls</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_2</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term_lsl</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_3</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term_lnl</span> <span class="o">=</span> <span class="n">beta_2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
        <span class="n">term_snl</span> <span class="o">=</span> <span class="n">beta_3</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">term_sl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_sll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_lls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_lsl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_lnl</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span> <span class="k">else</span> <span class="n">beta_2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_temp_ft_anom</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span>
        <span class="n">term_snl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Extra squared-squared terms</span>
    <span class="k">if</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
        <span class="n">term_lss</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_3</span> <span class="o">*</span> <span class="n">beta_2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="n">term_sls</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">beta_3</span> <span class="o">*</span> <span class="n">beta_2</span> <span class="o">/</span> <span class="n">beta_1</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">temp_ft_anom0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">temp_ft_mean</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1"># The two below are very small so should exclude</span>
        <span class="c1"># term_ss = 0.5 * beta_2/temp_adiabat_mean[0] * delta_temp_anom**2</span>
        <span class="c1"># term_lns = -0.5 * beta_2**2/beta_1**3/temp_adiabat_mean[0]**2 * delta_temp_anom * delta_mse**2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">term_lss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">term_sls</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Keep track of contribution to different changes</span>
    <span class="c1"># Have a prefactor based on current climate and a change between simulations for each factor.</span>
    <span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temp_ft_anom&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">term_ll</span> <span class="o">+</span> <span class="n">term_sl</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta_temp_ft_anom</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">delta_temp_ft_anom</span><span class="p">],</span>
                 <span class="s1">&#39;mse_mod_mean&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">term_lll</span> <span class="o">+</span> <span class="n">term_sll</span><span class="p">)</span> <span class="o">/</span> <span class="n">mse_mod_mean_change</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">mse_mod_mean_change</span><span class="p">],</span>
                 <span class="s1">&#39;mse_mod_mean_squared&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">term_lls</span> <span class="o">+</span> <span class="n">term_lsl</span> <span class="o">+</span> <span class="n">term_sls</span><span class="p">)</span> <span class="o">/</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                                          <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">2</span><span class="p">],</span>
                 <span class="s1">&#39;mse_mod_mean_cubed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">term_lss</span> <span class="o">/</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">mse_mod_mean_change</span> <span class="o">**</span> <span class="mi">3</span><span class="p">],</span>
                 <span class="s1">&#39;non_linear&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">term_lnl</span> <span class="o">+</span> <span class="n">term_snl</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta_temp_ft_anom</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                                <span class="n">delta_temp_ft_anom</span> <span class="o">*</span> <span class="n">mse_mod_mean_change</span><span class="p">]</span>
                 <span class="p">}</span>

    <span class="n">final_answer</span> <span class="o">=</span> <span class="n">term_ll</span> <span class="o">+</span> <span class="n">term_lll</span> <span class="o">+</span> <span class="n">term_sl</span> <span class="o">+</span> <span class="n">term_lls</span> <span class="o">+</span> <span class="n">term_sll</span> <span class="o">+</span> <span class="n">term_lsl</span> <span class="o">+</span> <span class="n">term_lnl</span> <span class="o">+</span> <span class="n">term_snl</span> <span class="o">+</span> <span class="n">term_lss</span> <span class="o">+</span> \
                   <span class="n">term_sls</span>
    <span class="n">final_answer</span> <span class="o">=</span> <span class="n">final_answer</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># convert to units of kJ/kg</span>
    <span class="k">return</span> <span class="n">final_answer</span><span class="p">,</span> <span class="n">info_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.mse_mod_change_surf_expansion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mse_mod_change_surf_expansion</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">taylor_terms</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">q_sat_s_linear_term_use</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta_s1_use</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Does a taylor expansion of the change in modified moist static energy, <span class="arithmatex">\(\delta h^{\dagger}\)</span> in terms
of surface quantities. This approximates the change of <span class="arithmatex">\(h^{\dagger} = (c_p - R^{\dagger})T_s + L_v q_s - \epsilon\)</span>
between climates.</p>
<div class="arithmatex">\[\delta h^{\dagger} \approx (c_p - R^{\dagger} + L_v \alpha_s q_s)\delta T_s + L_v q_s^* \delta r_s
- \delta \epsilon + L_v \alpha_s q_s^* \delta T_s \delta r_s  +
0.5 L_v \alpha_s q_s (\alpha_s - 2 / T_s) \delta T_s^2\]</div>
<p>In terms of <span class="arithmatex">\(\beta\)</span> parameters, this can be written as:</p>
<div class="arithmatex">\[\delta h^{\dagger} \approx \beta_{s1} \delta T_s + L_v q_s^* \delta r - \delta \epsilon +
L_v \alpha_s q_s^* \delta T_s \delta r_s + \frac{1}{2 T_s} \beta_{s2} \delta T_s^2\]</div>
<p>The <span class="arithmatex">\(\delta T_s^2\)</span> term is only included if <code>taylor_terms == 'squared'</code>.
The <span class="arithmatex">\(\delta T_s \delta r_s\)</span> term is only included if <code>taylor_terms</code> is <code>squared</code> or <code>non_linear</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code> or <code>float [n_exp, n_quant]</code> </br>
Near surface temperature of each simulation, corresponding to a different
optical depth, <span class="arithmatex">\(\kappa\)</span>. Units: <em>K</em>. We assume <code>n_exp=2</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_surf</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code> or <code>float [n_exp, n_quant]</code> </br>
Near surface specific humidity of each simulation. Units: <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float [n_exp]</code> or <code>float [n_exp, n_quant]</code> </br>
<span class="arithmatex">\(h_s - h^*_{FT}\)</span>. Units: <em>kJ/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taylor_terms</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many taylor series terms to keep in the expansions for changes in modified moist static energy:</p>
<ul>
<li><code>linear</code>: <span class="arithmatex">\(\delta h^{\dagger} \approx (c_p - R^{\dagger} + L_v \alpha_s q_s)\delta T_s +
    L_v \alpha q_s^* \delta r_s - \delta \epsilon\)</span></li>
<li><code>non_linear</code>: Includes the additional term <span class="arithmatex">\(L_v \alpha_s q_s^* \delta T_s \delta r_s\)</span></li>
<li><code>squared</code>: Includes the additional term <span class="arithmatex">\(0.5 L_v \alpha_s q_s (\alpha_s - 2 / T_s) \delta T_s^2\)</span></li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q_sat_s_linear_term_use</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_quant]</code> </br>
Can specify the <span class="arithmatex">\(q^*(T, p_s)\)</span> value in the <span class="arithmatex">\(L_v q^* \delta r\)</span> term. May want to do
this if want to approximate <span class="arithmatex">\(q^*(T(x), p_s) \approx q^*(\overline{T}, p_s)\)</span> for this term, so can combine
<span class="arithmatex">\(\delta r(x)\)</span> and <span class="arithmatex">\(\delta \overline{r}\)</span> terms. If <code>None</code>, then will use
<code>sphum_sat(temp_surf[0], pressure_surf)</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_s1_use</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_quant]</code> </br>
Can specify the <span class="arithmatex">\(\beta_{s1} = (c_p - R^{\dagger} + L_v \alpha q)\)</span> factor preceeding the <span class="arithmatex">\(\delta T_s\)</span>
term. May want to do this if want to investigate the approximation
<span class="arithmatex">\(\beta_{s1}(x) \approx \overline{\beta_{s1}}\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>delta_mse_mod</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>float</code> or <code>float [n_quant]</code> </br>
Approximation of <span class="arithmatex">\(\delta h^{\dagger}\)</span>. Units are <em>kJ/kg</em>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info_dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing 5 keys: <code>rh</code>, <code>temp</code>, <code>epsilon</code>, <code>non_linear</code>, <code>temp_squared</code>. </br>
For each key, there is a list with first value being the prefactor and second the change in the expansion.
The sum of all these prefactors multiplied by the changes equals the full theory.
Units of prefactors are <em>kJ/kg</em> divided by units of the change term.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mse_mod_change_surf_expansion</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                  <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taylor_terms</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                  <span class="n">q_sat_s_linear_term_use</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">beta_s1_use</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does a taylor expansion of the change in modified moist static energy, $\delta h^{\dagger}$ in terms</span>
<span class="sd">    of surface quantities. This approximates the change of $h^{\dagger} = (c_p - R^{\\dagger})T_s + L_v q_s - \epsilon$</span>
<span class="sd">    between climates.</span>

<span class="sd">    $$\\delta h^{\\dagger} \\approx (c_p - R^{\\dagger} + L_v \\alpha_s q_s)\\delta T_s + L_v q_s^* \\delta r_s</span>
<span class="sd">    - \delta \epsilon + L_v \\alpha_s q_s^* \delta T_s \\delta r_s  +</span>
<span class="sd">    0.5 L_v \\alpha_s q_s (\\alpha_s - 2 / T_s) \\delta T_s^2$$</span>

<span class="sd">    In terms of $\\beta$ parameters, this can be written as:</span>

<span class="sd">    $$\\delta h^{\\dagger} \\approx \\beta_{s1} \delta T_s + L_v q_s^* \\delta r - \delta \epsilon +</span>
<span class="sd">    L_v \\alpha_s q_s^* \delta T_s \\delta r_s + \\frac{1}{2 T_s} \\beta_{s2} \delta T_s^2$$</span>

<span class="sd">    The $\delta T_s^2$ term is only included if `taylor_terms == &#39;squared&#39;`.</span>
<span class="sd">    The $\delta T_s \delta r_s$ term is only included if `taylor_terms` is `squared` or `non_linear`.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf: `float [n_exp]` or `float [n_exp, n_quant]` &lt;/br&gt;</span>
<span class="sd">            Near surface temperature of each simulation, corresponding to a different</span>
<span class="sd">            optical depth, $\kappa$. Units: *K*. We assume `n_exp=2`.</span>
<span class="sd">        sphum_surf: `float [n_exp]` or `float [n_exp, n_quant]` &lt;/br&gt;</span>
<span class="sd">            Near surface specific humidity of each simulation. Units: *kg/kg*.</span>
<span class="sd">        epsilon: `float [n_exp]` or `float [n_exp, n_quant]` &lt;/br&gt;</span>
<span class="sd">            $h_s - h^*_{FT}$. Units: *kJ/kg*.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        taylor_terms:</span>
<span class="sd">            How many taylor series terms to keep in the expansions for changes in modified moist static energy:</span>

<span class="sd">            * `linear`: $\\delta h^{\\dagger} \\approx (c_p - R^{\\dagger} + L_v \\alpha_s q_s)\\delta T_s +</span>
<span class="sd">                L_v \\alpha q_s^* \\delta r_s - \delta \epsilon$</span>
<span class="sd">            * `non_linear`: Includes the additional term $L_v \\alpha_s q_s^* \delta T_s \\delta r_s$</span>
<span class="sd">            * `squared`: Includes the additional term $0.5 L_v \\alpha_s q_s (\\alpha_s - 2 / T_s) \\delta T_s^2$</span>
<span class="sd">        q_sat_s_linear_term_use: `float` or `float [n_quant]` &lt;/br&gt;</span>
<span class="sd">            Can specify the $q^*(T, p_s)$ value in the $L_v q^* \\delta r$ term. May want to do</span>
<span class="sd">            this if want to approximate $q^*(T(x), p_s) \\approx q^*(\overline{T}, p_s)$ for this term, so can combine</span>
<span class="sd">            $\\delta r(x)$ and $\\delta \overline{r}$ terms. If `None`, then will use</span>
<span class="sd">            `sphum_sat(temp_surf[0], pressure_surf)`.</span>
<span class="sd">        beta_s1_use: `float` or `float [n_quant]` &lt;/br&gt;</span>
<span class="sd">            Can specify the $\\beta_{s1} = (c_p - R^{\\dagger} + L_v \\alpha q)$ factor preceeding the $\delta T_s$</span>
<span class="sd">            term. May want to do this if want to investigate the approximation</span>
<span class="sd">            $\\beta_{s1}(x) \\approx \overline{\\beta_{s1}}$.</span>

<span class="sd">    Returns:</span>
<span class="sd">        delta_mse_mod: `float` or `float [n_quant]` &lt;/br&gt;</span>
<span class="sd">            Approximation of $\delta h^{\\dagger}$. Units are *kJ/kg*.</span>
<span class="sd">        info_dict: Dictionary containing 5 keys: `rh`, `temp`, `epsilon`, `non_linear`, `temp_squared`. &lt;/br&gt;</span>
<span class="sd">            For each key, there is a list with first value being the prefactor and second the change in the expansion.</span>
<span class="sd">            The sum of all these prefactors multiplied by the changes equals the full theory.</span>
<span class="sd">            Units of prefactors are *kJ/kg* divided by units of the change term.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">beta_s1</span><span class="p">,</span> <span class="n">beta_s2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_theory_prefactor_terms</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span>
                                                                 <span class="n">sphum_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">delta_temp</span> <span class="o">=</span> <span class="n">temp_surf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rh</span> <span class="o">=</span> <span class="n">sphum_surf</span> <span class="o">/</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">)</span>
    <span class="n">delta_rh</span> <span class="o">=</span> <span class="n">rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">delta_epsilon</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">q_sat_s</span> <span class="o">=</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">)</span>
    <span class="n">alpha_s</span> <span class="o">=</span> <span class="n">clausius_clapeyron_factor</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_surf</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">q_sat_s_linear_term_use</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coef_rh</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">q_sat_s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coef_rh</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">q_sat_s_linear_term_use</span>
    <span class="n">coef_temp</span> <span class="o">=</span> <span class="n">beta_s1</span> <span class="k">if</span> <span class="n">beta_s1_use</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta_s1_use</span>

    <span class="k">if</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;squared&#39;</span><span class="p">:</span>
        <span class="c1"># Add extra term in taylor expansion of delta_mse_mod if requested</span>
        <span class="n">coef_non_linear</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">q_sat_s</span> <span class="o">*</span> <span class="n">alpha_s</span>
        <span class="n">coef_temp_squared</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_s2</span> <span class="o">/</span> <span class="n">temp_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;non_linear&#39;</span><span class="p">:</span>
        <span class="n">coef_non_linear</span> <span class="o">=</span> <span class="n">L_v</span> <span class="o">*</span> <span class="n">q_sat_s</span> <span class="o">*</span> <span class="n">alpha_s</span>
        <span class="n">coef_temp_squared</span> <span class="o">=</span> <span class="n">sphum_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">taylor_terms</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">coef_non_linear</span> <span class="o">=</span> <span class="n">sphum_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">0</span>
        <span class="n">coef_temp_squared</span> <span class="o">=</span> <span class="n">sphum_surf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">0</span>  <span class="c1"># set to 0 for all values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;taylor_terms given is </span><span class="si">{</span><span class="n">taylor_terms</span><span class="si">}</span><span class="s2">, but must be &#39;linear&#39;, &#39;non_linear&#39; or &#39;squared&#39;&quot;</span><span class="p">)</span>

    <span class="n">final_answer</span> <span class="o">=</span> <span class="p">(</span><span class="n">coef_rh</span> <span class="o">*</span> <span class="n">delta_rh</span> <span class="o">+</span> <span class="n">coef_temp</span> <span class="o">*</span> <span class="n">delta_temp</span> <span class="o">+</span> <span class="n">coef_non_linear</span> <span class="o">*</span> <span class="n">delta_rh</span> <span class="o">*</span> <span class="n">delta_temp</span> <span class="o">+</span>
                    <span class="n">coef_temp_squared</span> <span class="o">*</span> <span class="n">delta_temp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">-</span> <span class="n">delta_epsilon</span>
    <span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rh&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">coef_rh</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">delta_rh</span><span class="p">],</span> <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">coef_temp</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">delta_temp</span><span class="p">],</span>
                 <span class="s1">&#39;epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta_epsilon</span><span class="p">],</span>
                 <span class="s1">&#39;non_linear&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">coef_non_linear</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">delta_temp</span> <span class="o">*</span> <span class="n">delta_rh</span><span class="p">],</span>
                 <span class="s1">&#39;temp_squared&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">coef_temp_squared</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">delta_temp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">final_answer</span><span class="p">,</span> <span class="n">info_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.temp_adiabat_fit_func" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">temp_adiabat_fit_func</span><span class="p">(</span><span class="n">temp_ft_adiabat</span><span class="p">,</span> <span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adiabatic Free Troposphere temperature, <span class="arithmatex">\(T_{A,FT}\)</span>, is defined such that surface moist static energy, <span class="arithmatex">\(h\)</span>
is equal to the saturated moist static energy, <span class="arithmatex">\(h^*\)</span>, evaluated at <span class="arithmatex">\(T_A\)</span> and free troposphere pressure,
<span class="arithmatex">\(p_{FT}\)</span> i.e. <span class="arithmatex">\(h(T_s, q_s, p_s) = h^*(T_{A}, p_{FT})\)</span>.</p>
<p>This develops this to the more general case, to find <span class="arithmatex">\(T_A\)</span> such that
<span class="arithmatex">\(h(T_s, q_s, p_s) = h^*(T_{A}, p_{FT}) + \epsilon\)</span>, where <span class="arithmatex">\(\epsilon\)</span> quantifies the CAPE.</p>
<p>Using the following approximate relationship between <span class="arithmatex">\(z_A\)</span> and <span class="arithmatex">\(T_A\)</span>:</p>
<div class="arithmatex">\[z_A - z_s \approx \frac{R^{\dagger}}{g}(T_s + T_A)\]</div>
<p>where <span class="arithmatex">\(R^{\dagger} = \ln(p_s/p_{FT})/2\)</span>, we can obtain <span class="arithmatex">\(T_A\)</span>
by solving the following equation for modified MSE, <span class="arithmatex">\(h^{\dagger}\)</span>:</p>
<div class="arithmatex">\[h^{\dagger} = (c_p - R^{\dagger})T_s + L_v q_s - \epsilon \approx
(c_p + R^{\dagger})T_A + L_vq^*(T_A, p_{FT})\]</div>
<p>Where the temperature differs from the adiabatic temperature if <span class="arithmatex">\(\epsilon \neq 0\)</span>.
This function returns the LHS minus the RHS of this equation to then give to <code>scipy.optimize.fsolve</code> to find
<span class="arithmatex">\(T_A\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft_adiabat</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
Adiabatic temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual temperature at <code>pressure_surf</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sphum_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual specific humidity at <code>pressure_surf</code> in <em>kg/kg</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proxy for CAPE in <em>kJ/kg</em>. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MSE discrepancy: difference between surface and free troposphere saturated adiabatic MSE.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">temp_adiabat_fit_func</span><span class="p">(</span><span class="n">temp_ft_adiabat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                          <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adiabatic Free Troposphere temperature, $T_{A,FT}$, is defined such that surface moist static energy, $h$</span>
<span class="sd">    is equal to the saturated moist static energy, $h^*$, evaluated at $T_A$ and free troposphere pressure,</span>
<span class="sd">    $p_{FT}$ i.e. $h(T_s, q_s, p_s) = h^*(T_{A}, p_{FT})$.</span>

<span class="sd">    This develops this to the more general case, to find $T_A$ such that</span>
<span class="sd">    $h(T_s, q_s, p_s) = h^*(T_{A}, p_{FT}) + \epsilon$, where $\epsilon$ quantifies the CAPE.</span>

<span class="sd">    Using the following approximate relationship between $z_A$ and $T_A$:</span>

<span class="sd">    $$z_A - z_s \\approx \\frac{R^{\\dagger}}{g}(T_s + T_A)$$</span>

<span class="sd">    where $R^{\dagger} = \\ln(p_s/p_{FT})/2$, we can obtain $T_A$</span>
<span class="sd">    by solving the following equation for modified MSE, $h^{\\dagger}$:</span>

<span class="sd">    $$h^{\\dagger} = (c_p - R^{\\dagger})T_s + L_v q_s - \epsilon \\approx</span>
<span class="sd">    (c_p + R^{\\dagger})T_A + L_vq^*(T_A, p_{FT})$$</span>

<span class="sd">    Where the temperature differs from the adiabatic temperature if $\epsilon \\neq 0$.</span>
<span class="sd">    This function returns the LHS minus the RHS of this equation to then give to `scipy.optimize.fsolve` to find</span>
<span class="sd">    $T_A$.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_ft_adiabat: float</span>
<span class="sd">            Adiabatic temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        temp_surf:</span>
<span class="sd">            Actual temperature at `pressure_surf` in Kelvin.</span>
<span class="sd">        sphum_surf:</span>
<span class="sd">            Actual specific humidity at `pressure_surf` in *kg/kg*.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        epsilon:</span>
<span class="sd">            Proxy for CAPE in *kJ/kg*. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MSE discrepancy: difference between surface and free troposphere saturated adiabatic MSE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R_mod</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pressure_surf</span> <span class="o">/</span> <span class="n">pressure_ft</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">mse_mod_surf</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_surf</span><span class="p">,</span> <span class="n">sphum_surf</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">-</span> <span class="n">R_mod</span><span class="p">)</span> <span class="o">-</span> <span class="n">epsilon</span>
    <span class="n">mse_mod_ft</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft_adiabat</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft_adiabat</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">+</span> <span class="n">R_mod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mse_mod_surf</span> <span class="o">-</span> <span class="n">mse_mod_ft</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="isca_tools.thesis.adiabat_theory.temp_adiabat_surf_fit_func" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">temp_adiabat_surf_fit_func</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">,</span> <span class="n">rh_surf</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adiabatic Near-surface temperature, <span class="arithmatex">\(T_{A,s}\)</span>, is defined such that surface moist static energy, <span class="arithmatex">\(h\)</span>
evaluated at <span class="arithmatex">\(T_{A, s}\)</span> is equal to the saturated free tropospheric moist static energy, <span class="arithmatex">\(h^*\)</span>,
and free troposphere pressure, <span class="arithmatex">\(p_{FT}\)</span> i.e. <span class="arithmatex">\(h(T_{A,s}, r_s, p_s) = h^*(T_{FT}, z_{FT}, p_{FT})\)</span>.</p>
<p>This develops this to the more general case, to find <span class="arithmatex">\(T_{A, s}\)</span> such that
<span class="arithmatex">\(h(T_{A,s}, r_s, p_s) = h^*(T_{FT}, z_{FT}, p_{FT}) + \epsilon\)</span>, where <span class="arithmatex">\(\epsilon\)</span> quantifies the CAPE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_surf_adiabat</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
Adiabatic temperature at <code>pressure_surf</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temp_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual temperature at <code>pressure_ft</code> in Kelvin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rh_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual relative humidity at <code>pressure_surf</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_surf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at near-surface in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pressure_ft</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at free troposphere level in <em>Pa</em>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proxy for CAPE in <em>kJ/kg</em>. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MSE discrepancy: difference between adiabatic surface and free troposphere saturated MSE.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>isca_tools/thesis/adiabat_theory.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">temp_adiabat_surf_fit_func</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temp_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rh_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">z_ft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                               <span class="n">pressure_surf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adiabatic Near-surface temperature, $T_{A,s}$, is defined such that surface moist static energy, $h$</span>
<span class="sd">    evaluated at $T_{A, s}$ is equal to the saturated free tropospheric moist static energy, $h^*$,</span>
<span class="sd">    and free troposphere pressure, $p_{FT}$ i.e. $h(T_{A,s}, r_s, p_s) = h^*(T_{FT}, z_{FT}, p_{FT})$.</span>

<span class="sd">    This develops this to the more general case, to find $T_{A, s}$ such that</span>
<span class="sd">    $h(T_{A,s}, r_s, p_s) = h^*(T_{FT}, z_{FT}, p_{FT}) + \epsilon$, where $\epsilon$ quantifies the CAPE.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_surf_adiabat: float</span>
<span class="sd">            Adiabatic temperature at `pressure_surf` in Kelvin.</span>
<span class="sd">        temp_ft:</span>
<span class="sd">            Actual temperature at `pressure_ft` in Kelvin.</span>
<span class="sd">        rh_surf:</span>
<span class="sd">            Actual relative humidity at `pressure_surf`.</span>
<span class="sd">        pressure_surf:</span>
<span class="sd">            Pressure at near-surface in *Pa*.</span>
<span class="sd">        pressure_ft:</span>
<span class="sd">            Pressure at free troposphere level in *Pa*.</span>
<span class="sd">        epsilon:</span>
<span class="sd">            Proxy for CAPE in *kJ/kg*. Quantifies how much larger near-surface MSE is than free tropospheric saturated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MSE discrepancy: difference between adiabatic surface and free troposphere saturated MSE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">z_ft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Compute z_ft using from temperatures</span>
        <span class="n">R_mod</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pressure_surf</span> <span class="o">/</span> <span class="n">pressure_ft</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">mse_surf</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">,</span> <span class="n">rh_surf</span> <span class="o">*</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">),</span>
                                       <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">-</span> <span class="n">R_mod</span><span class="p">)</span>
        <span class="n">mse_sat_ft</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">c_p_const</span><span class="o">=</span><span class="n">c_p</span> <span class="o">+</span> <span class="n">R_mod</span><span class="p">)</span> <span class="o">+</span> <span class="n">epsilon</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mse_surf</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">,</span> <span class="n">rh_surf</span> <span class="o">*</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_surf_adiabat</span><span class="p">,</span> <span class="n">pressure_surf</span><span class="p">),</span>
                                       <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mse_sat_ft</span> <span class="o">=</span> <span class="n">moist_static_energy</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">sphum_sat</span><span class="p">(</span><span class="n">temp_ft</span><span class="p">,</span> <span class="n">pressure_ft</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">z_ft</span><span class="p">)</span> <span class="o">+</span> <span class="n">epsilon</span>
    <span class="k">return</span> <span class="n">mse_surf</span> <span class="o">-</span> <span class="n">mse_sat_ft</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/jduffield65/Isca" target="_blank" rel="noopener" title="Github Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.expand", "content.tabs.link", "navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>